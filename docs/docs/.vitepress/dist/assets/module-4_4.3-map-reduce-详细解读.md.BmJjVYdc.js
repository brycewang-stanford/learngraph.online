import{_ as i,c as a,o as n,ag as e}from"./chunks/framework.Cf3FQAeg.js";const o=JSON.parse('{"title":"LangGraph Map-Reduce è¯¦ç»†è§£è¯»","description":"","frontmatter":{},"headers":[],"relativePath":"module-4/4.3-map-reduce-è¯¦ç»†è§£è¯».md","filePath":"module-4/4.3-map-reduce-è¯¦ç»†è§£è¯».md","lastUpdated":1760223716000}'),l={name:"module-4/4.3-map-reduce-è¯¦ç»†è§£è¯».md"};function t(p,s,h,k,r,d){return n(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="langgraph-map-reduce-è¯¦ç»†è§£è¯»" tabindex="-1">LangGraph Map-Reduce è¯¦ç»†è§£è¯» <a class="header-anchor" href="#langgraph-map-reduce-è¯¦ç»†è§£è¯»" aria-label="Permalink to &quot;LangGraph Map-Reduce è¯¦ç»†è§£è¯»&quot;">â€‹</a></h1><h2 id="ğŸ“š-æ¦‚è¿°" tabindex="-1">ğŸ“š æ¦‚è¿° <a class="header-anchor" href="#ğŸ“š-æ¦‚è¿°" aria-label="Permalink to &quot;ğŸ“š æ¦‚è¿°&quot;">â€‹</a></h2><p>æœ¬æ–‡æ¡£è¯¦ç»†è§£è¯» LangGraph ä¸­çš„ <strong>Map-Reduce</strong> æ¨¡å¼ã€‚è¿™æ˜¯ä¸€ç§ç»å…¸çš„åˆ†å¸ƒå¼è®¡ç®—æ¨¡å¼ï¼Œåœ¨ LangGraph ä¸­ç”¨äºé«˜æ•ˆçš„ä»»åŠ¡åˆ†è§£å’Œå¹¶è¡Œå¤„ç†ã€‚é€šè¿‡ Map-Reduceï¼Œæˆ‘ä»¬å¯ä»¥å°†å¤æ‚ä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå­ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œç„¶åèšåˆç»“æœã€‚</p><h2 id="ğŸ¯-æ ¸å¿ƒæ¦‚å¿µ" tabindex="-1">ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ <a class="header-anchor" href="#ğŸ¯-æ ¸å¿ƒæ¦‚å¿µ" aria-label="Permalink to &quot;ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ&quot;">â€‹</a></h2><h3 id="ä»€ä¹ˆæ˜¯-map-reduce" tabindex="-1">ä»€ä¹ˆæ˜¯ Map-Reduceï¼Ÿ <a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-map-reduce" aria-label="Permalink to &quot;ä»€ä¹ˆæ˜¯ Map-Reduceï¼Ÿ&quot;">â€‹</a></h3><p>Map-Reduce æ˜¯ä¸€ç§ç¼–ç¨‹æ¨¡å‹ï¼ŒåŒ…å«ä¸¤ä¸ªé˜¶æ®µï¼š</p><ol><li><p><strong>Mapï¼ˆæ˜ å°„ï¼‰é˜¶æ®µ</strong></p><ul><li>å°†å¤§ä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªå°çš„å­ä»»åŠ¡</li><li>å¹¶è¡Œå¤„ç†æ¯ä¸ªå­ä»»åŠ¡</li><li>æ¯ä¸ªå­ä»»åŠ¡ç‹¬ç«‹æ‰§è¡Œï¼Œäº’ä¸å½±å“</li></ul></li><li><p><strong>Reduceï¼ˆå½’çº¦ï¼‰é˜¶æ®µ</strong></p><ul><li>æ”¶é›†æ‰€æœ‰å­ä»»åŠ¡çš„ç»“æœ</li><li>å¯¹ç»“æœè¿›è¡Œèšåˆã€æ±‡æ€»æˆ–ç­›é€‰</li><li>äº§ç”Ÿæœ€ç»ˆè¾“å‡º</li></ul></li></ol><h3 id="ç»å…¸åº”ç”¨åœºæ™¯" tabindex="-1">ç»å…¸åº”ç”¨åœºæ™¯ <a class="header-anchor" href="#ç»å…¸åº”ç”¨åœºæ™¯" aria-label="Permalink to &quot;ç»å…¸åº”ç”¨åœºæ™¯&quot;">â€‹</a></h3><ul><li><strong>æ–‡æ¡£å¤„ç†</strong>ï¼šåˆ†æ®µå¤„ç†é•¿æ–‡æ¡£ï¼Œç„¶åæ±‡æ€»æ‘˜è¦</li><li><strong>æ•°æ®åˆ†æ</strong>ï¼šå¹¶è¡Œåˆ†æå¤šä¸ªæ•°æ®æºï¼Œèšåˆç»Ÿè®¡ç»“æœ</li><li><strong>å†…å®¹ç”Ÿæˆ</strong>ï¼šç”Ÿæˆå¤šä¸ªå€™é€‰å†…å®¹ï¼Œé€‰æ‹©æœ€ä½³ç»“æœ</li><li><strong>å¤šæºæŸ¥è¯¢</strong>ï¼šå¹¶è¡ŒæŸ¥è¯¢å¤šä¸ª APIï¼Œåˆå¹¶ç»“æœ</li></ul><hr><h2 id="ğŸ­-å®æˆ˜æ¡ˆä¾‹-ç¬‘è¯ç”Ÿæˆç³»ç»Ÿ" tabindex="-1">ğŸ­ å®æˆ˜æ¡ˆä¾‹ï¼šç¬‘è¯ç”Ÿæˆç³»ç»Ÿ <a class="header-anchor" href="#ğŸ­-å®æˆ˜æ¡ˆä¾‹-ç¬‘è¯ç”Ÿæˆç³»ç»Ÿ" aria-label="Permalink to &quot;ğŸ­ å®æˆ˜æ¡ˆä¾‹ï¼šç¬‘è¯ç”Ÿæˆç³»ç»Ÿ&quot;">â€‹</a></h2><p>æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªæ™ºèƒ½ç¬‘è¯ç”Ÿæˆç³»ç»Ÿï¼Œæ¼”ç¤º Map-Reduce çš„å®Œæ•´æµç¨‹ï¼š</p><p><strong>éœ€æ±‚ï¼š</strong></p><ol><li><strong>Map é˜¶æ®µ</strong>ï¼šæ ¹æ®ä¸€ä¸ªä¸»é¢˜ï¼ˆå¦‚&quot;åŠ¨ç‰©&quot;ï¼‰ï¼Œç”Ÿæˆå¤šä¸ªå­ä¸»é¢˜çš„ç¬‘è¯</li><li><strong>Reduce é˜¶æ®µ</strong>ï¼šä»æ‰€æœ‰ç”Ÿæˆçš„ç¬‘è¯ä¸­ï¼Œé€‰å‡ºæœ€å¥½çš„ä¸€ä¸ª</li></ol><h3 id="ç³»ç»Ÿæ¶æ„å›¾" tabindex="-1">ç³»ç»Ÿæ¶æ„å›¾ <a class="header-anchor" href="#ç³»ç»Ÿæ¶æ„å›¾" aria-label="Permalink to &quot;ç³»ç»Ÿæ¶æ„å›¾&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç”¨æˆ·è¾“å…¥ä¸»é¢˜ &quot;animals&quot;</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>   [generate_topics] ç”Ÿæˆå­ä¸»é¢˜: [mammals, reptiles, birds]</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>    (Send API åŠ¨æ€åˆ†å‘)</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>   â†“        â†“        â†“        â†“</span></span>
<span class="line"><span>[joke-1] [joke-2] [joke-3]  (Map é˜¶æ®µï¼šå¹¶è¡Œç”Ÿæˆ)</span></span>
<span class="line"><span>   â†“        â†“        â†“</span></span>
<span class="line"><span>   â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>             â†“</span></span>
<span class="line"><span>        [best_joke]  (Reduce é˜¶æ®µï¼šé€‰æ‹©æœ€ä½³)</span></span>
<span class="line"><span>             â†“</span></span>
<span class="line"><span>         è¿”å›ç»“æœ</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><hr><h2 id="ğŸ”§-ä»£ç å®ç°è¯¦è§£" tabindex="-1">ğŸ”§ ä»£ç å®ç°è¯¦è§£ <a class="header-anchor" href="#ğŸ”§-ä»£ç å®ç°è¯¦è§£" aria-label="Permalink to &quot;ğŸ”§ ä»£ç å®ç°è¯¦è§£&quot;">â€‹</a></h2><h3 id="_1-å®šä¹‰æç¤ºè¯å’Œæ¨¡å‹" tabindex="-1">1. å®šä¹‰æç¤ºè¯å’Œæ¨¡å‹ <a class="header-anchor" href="#_1-å®šä¹‰æç¤ºè¯å’Œæ¨¡å‹" aria-label="Permalink to &quot;1. å®šä¹‰æç¤ºè¯å’Œæ¨¡å‹&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langchain_openai </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ChatOpenAI</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä¸‰ä¸ªå…³é”®æç¤ºè¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subjects_prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;&quot;Generate a list of 3 sub-topics that are all related to this overall topic: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{topic}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">joke_prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;&quot;Generate a joke about </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{subject}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">best_joke_prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;&quot;Below are a bunch of jokes about </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{topic}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">. Select the best one! Return the ID of the best one, starting 0 as the ID for the first joke. Jokes: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n\\n</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  {jokes}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆå§‹åŒ– LLM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ChatOpenAI(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt-4o&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>è¯´æ˜ï¼š</strong></p><ul><li><code>subjects_prompt</code>ï¼šå°†ä¸»é¢˜æ‹†åˆ†ä¸º 3 ä¸ªå­ä¸»é¢˜</li><li><code>joke_prompt</code>ï¼šä¸ºå•ä¸ªå­ä¸»é¢˜ç”Ÿæˆç¬‘è¯</li><li><code>best_joke_prompt</code>ï¼šä»å¤šä¸ªç¬‘è¯ä¸­é€‰æ‹©æœ€å¥½çš„</li></ul><hr><h3 id="_2-å®šä¹‰çŠ¶æ€-state" tabindex="-1">2. å®šä¹‰çŠ¶æ€ï¼ˆStateï¼‰ <a class="header-anchor" href="#_2-å®šä¹‰çŠ¶æ€-state" aria-label="Permalink to &quot;2. å®šä¹‰çŠ¶æ€ï¼ˆStateï¼‰&quot;">â€‹</a></h3><p>è¿™æ˜¯ Map-Reduce çš„å…³é”®ï¼æˆ‘ä»¬éœ€è¦ä¸¤ç§çŠ¶æ€ï¼š</p><h4 id="å…¨å±€çŠ¶æ€-overallstate" tabindex="-1">å…¨å±€çŠ¶æ€ï¼ˆOverallStateï¼‰ <a class="header-anchor" href="#å…¨å±€çŠ¶æ€-overallstate" aria-label="Permalink to &quot;å…¨å±€çŠ¶æ€ï¼ˆOverallStateï¼‰&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> operator</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> typing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Annotated</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> typing_extensions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TypedDict</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pydantic </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BaseModel</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Subjects</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subjects: list[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BestJoke</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OverallState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    topic: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                                  # ç”¨æˆ·è¾“å…¥çš„ä¸»é¢˜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subjects: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                               # ç”Ÿæˆçš„å­ä¸»é¢˜åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    jokes: Annotated[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, operator.add]        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ”¶é›†çš„ç¬‘è¯ï¼ˆæ”¯æŒå¹¶è¡Œè¿½åŠ ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    best_selected_joke: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                     # æœ€ç»ˆé€‰å‡ºçš„æœ€ä½³ç¬‘è¯</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>å…³é”®ç‚¹ï¼š</strong></p><ul><li><code>jokes</code> ä½¿ç”¨ <code>operator.add</code> reducerï¼Œå…è®¸å¤šä¸ªå¹¶è¡ŒèŠ‚ç‚¹åŒæ—¶å†™å…¥</li><li>è¿™ä¸ä¹‹å‰å­¦ä¹ çš„ parallelization çŸ¥è¯†ä¸€è‡´</li></ul><h4 id="å±€éƒ¨çŠ¶æ€-jokestate" tabindex="-1">å±€éƒ¨çŠ¶æ€ï¼ˆJokeStateï¼‰ <a class="header-anchor" href="#å±€éƒ¨çŠ¶æ€-jokestate" aria-label="Permalink to &quot;å±€éƒ¨çŠ¶æ€ï¼ˆJokeStateï¼‰&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JokeState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subject: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # å•ä¸ªç¬‘è¯ç”ŸæˆèŠ‚ç‚¹åªéœ€è¦çŸ¥é“ä¸»é¢˜</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Joke</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    joke: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>Python çŸ¥è¯†ç‚¹ï¼šPydantic BaseModel</strong></p><p><code>BaseModel</code> æ˜¯ Pydantic åº“çš„æ ¸å¿ƒç±»ï¼Œç”¨äºï¼š</p><ul><li>æ•°æ®éªŒè¯</li><li>ç±»å‹æ£€æŸ¥</li><li>ç»“æ„åŒ–è¾“å‡º</li></ul><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨ç¤ºä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Joke</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    joke: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># LLM ä¼šè¿”å›ç¬¦åˆè¿™ä¸ªç»“æ„çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model.with_structured_output(Joke).invoke(prompt)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># response.joke å°±æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„ç¬‘è¯å†…å®¹</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><hr><h3 id="_3-map-é˜¶æ®µ-ç”Ÿæˆå­ä¸»é¢˜" tabindex="-1">3. Map é˜¶æ®µï¼šç”Ÿæˆå­ä¸»é¢˜ <a class="header-anchor" href="#_3-map-é˜¶æ®µ-ç”Ÿæˆå­ä¸»é¢˜" aria-label="Permalink to &quot;3. Map é˜¶æ®µï¼šç”Ÿæˆå­ä¸»é¢˜&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generate_topics</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: OverallState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subjects_prompt.format(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">topic</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;topic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model.with_structured_output(Subjects).invoke(prompt)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;subjects&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: response.subjects}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>åŠŸèƒ½ï¼š</strong> å°†ç”¨æˆ·è¾“å…¥çš„ä¸»é¢˜ï¼ˆå¦‚ &quot;animals&quot;ï¼‰åˆ†è§£ä¸º 3 ä¸ªå­ä¸»é¢˜ï¼ˆå¦‚ [&quot;mammals&quot;, &quot;reptiles&quot;, &quot;birds&quot;]ï¼‰</p><hr><h3 id="_4-åŠ¨æ€ä»»åŠ¡åˆ†å‘-send-api-â­" tabindex="-1">4. åŠ¨æ€ä»»åŠ¡åˆ†å‘ï¼šSend API â­ <a class="header-anchor" href="#_4-åŠ¨æ€ä»»åŠ¡åˆ†å‘-send-api-â­" aria-label="Permalink to &quot;4. åŠ¨æ€ä»»åŠ¡åˆ†å‘ï¼šSend API â­&quot;">â€‹</a></h3><p>è¿™æ˜¯ Map-Reduce çš„<strong>æ ¸å¿ƒé­”æ³•</strong>ï¼</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langgraph.types </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Send</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> continue_to_jokes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: OverallState):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ä¸ºæ¯ä¸ªå­ä¸»é¢˜åˆ›å»ºä¸€ä¸ª Send ä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [Send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;subject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: s}) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;subjects&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>Send API è¯¦è§£ï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;subject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: s})</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#    ^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#    ç›®æ ‡èŠ‚ç‚¹åç§°      å‘é€çš„çŠ¶æ€æ•°æ®</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>é‡è¦ç‰¹æ€§ï¼š</strong></p><ol><li><strong>åŠ¨æ€å¹¶è¡ŒåŒ–</strong>ï¼šè‡ªåŠ¨ä¸ºåˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ åˆ›å»ºå¹¶è¡Œä»»åŠ¡</li><li><strong>çŠ¶æ€çµæ´»æ€§</strong>ï¼šå¯ä»¥å‘é€ä»»æ„çŠ¶æ€ï¼Œä¸éœ€è¦ä¸ <code>OverallState</code> å®Œå…¨åŒ¹é…</li><li><strong>è‡ªåŠ¨æ‰©å±•</strong>ï¼šæ— è®ºæœ‰ 3 ä¸ªè¿˜æ˜¯ 300 ä¸ªå­ä¸»é¢˜ï¼Œéƒ½èƒ½è‡ªåŠ¨å¹¶è¡Œå¤„ç†</li></ol><p><strong>ä¸ºä»€ä¹ˆå¼ºå¤§ï¼Ÿ</strong></p><p>ä¼ ç»Ÿæ–¹å¼éœ€è¦é¢„å…ˆçŸ¥é“æœ‰å¤šå°‘ä¸ªå¹¶è¡Œä»»åŠ¡ï¼Œè€Œ <code>Send</code> å¯ä»¥æ ¹æ®è¿è¡Œæ—¶æ•°æ®åŠ¨æ€åˆ›å»ºä»»åŠ¡ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¦‚æœæœ‰ 3 ä¸ªä¸»é¢˜ï¼ŒSend ä¼šåˆ›å»º 3 ä¸ªå¹¶è¡Œä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subjects </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mammals&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;reptiles&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;birds&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç›¸å½“äºï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - Send(&quot;generate_joke&quot;, {&quot;subject&quot;: &quot;mammals&quot;})</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - Send(&quot;generate_joke&quot;, {&quot;subject&quot;: &quot;reptiles&quot;})</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - Send(&quot;generate_joke&quot;, {&quot;subject&quot;: &quot;birds&quot;})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¦‚æœæœ‰ 10 ä¸ªä¸»é¢˜ï¼Œè‡ªåŠ¨åˆ›å»º 10 ä¸ªå¹¶è¡Œä»»åŠ¡ï¼</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><hr><h3 id="_5-map-é˜¶æ®µ-å¹¶è¡Œç”Ÿæˆç¬‘è¯" tabindex="-1">5. Map é˜¶æ®µï¼šå¹¶è¡Œç”Ÿæˆç¬‘è¯ <a class="header-anchor" href="#_5-map-é˜¶æ®µ-å¹¶è¡Œç”Ÿæˆç¬‘è¯" aria-label="Permalink to &quot;5. Map é˜¶æ®µï¼šå¹¶è¡Œç”Ÿæˆç¬‘è¯&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generate_joke</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: JokeState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> joke_prompt.format(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">subject</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;subject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model.with_structured_output(Joke).invoke(prompt)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;jokes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [response.joke]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>å…³é”®ç»†èŠ‚ï¼š</strong></p><ul><li>è¾“å…¥ï¼š<code>JokeState</code>ï¼ˆåªåŒ…å« <code>subject</code>ï¼‰</li><li>è¾“å‡ºï¼š<code>{&quot;jokes&quot;: [response.joke]}</code>ï¼ˆæ³¨æ„æ˜¯åˆ—è¡¨ï¼ï¼‰</li><li>è¿”å›çš„æ•°æ®ä¼šè¢«å†™å› <code>OverallState</code> çš„ <code>jokes</code> å­—æ®µ</li><li>ç”±äº <code>jokes</code> æœ‰ <code>operator.add</code> reducerï¼Œå¤šä¸ªå¹¶è¡ŒèŠ‚ç‚¹çš„è¾“å‡ºä¼šè‡ªåŠ¨æ‹¼æ¥</li></ul><p><strong>æ‰§è¡Œæµç¨‹ç¤ºæ„ï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>generate_joke(subject=&quot;mammals&quot;)  â†’ è¿”å› {&quot;jokes&quot;: [&quot;joke1&quot;]}</span></span>
<span class="line"><span>generate_joke(subject=&quot;reptiles&quot;) â†’ è¿”å› {&quot;jokes&quot;: [&quot;joke2&quot;]}</span></span>
<span class="line"><span>generate_joke(subject=&quot;birds&quot;)    â†’ è¿”å› {&quot;jokes&quot;: [&quot;joke3&quot;]}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æœ€ç»ˆ OverallState.jokes = [&quot;joke1&quot;, &quot;joke2&quot;, &quot;joke3&quot;]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr><h3 id="_6-reduce-é˜¶æ®µ-é€‰æ‹©æœ€ä½³ç¬‘è¯" tabindex="-1">6. Reduce é˜¶æ®µï¼šé€‰æ‹©æœ€ä½³ç¬‘è¯ <a class="header-anchor" href="#_6-reduce-é˜¶æ®µ-é€‰æ‹©æœ€ä½³ç¬‘è¯" aria-label="Permalink to &quot;6. Reduce é˜¶æ®µï¼šé€‰æ‹©æœ€ä½³ç¬‘è¯&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> best_joke</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: OverallState):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å°†æ‰€æœ‰ç¬‘è¯åˆå¹¶ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    jokes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.join(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;jokes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è®© LLM é€‰æ‹©æœ€å¥½çš„ç¬‘è¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> best_joke_prompt.format(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">topic</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;topic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">jokes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">jokes)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model.with_structured_output(BestJoke).invoke(prompt)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è¿”å›è¢«é€‰ä¸­çš„ç¬‘è¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;best_selected_joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;jokes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][response.id]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>åŠŸèƒ½ï¼š</strong></p><ul><li>æ¥æ”¶æ‰€æœ‰å¹¶è¡Œç”Ÿæˆçš„ç¬‘è¯</li><li>ä½¿ç”¨ LLM è¯„ä¼°å¹¶é€‰æ‹©æœ€ä½³ç¬‘è¯</li><li><code>BestJoke</code> æ¨¡å‹è¿”å›æœ€ä½³ç¬‘è¯çš„ç´¢å¼•ï¼ˆidï¼‰</li><li>æ ¹æ®ç´¢å¼•ä» <code>state[&quot;jokes&quot;]</code> ä¸­å–å‡ºæœ€ä½³ç¬‘è¯</li></ul><hr><h3 id="_7-æ„å»ºå›¾" tabindex="-1">7. æ„å»ºå›¾ <a class="header-anchor" href="#_7-æ„å»ºå›¾" aria-label="Permalink to &quot;7. æ„å»ºå›¾&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langgraph.graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, StateGraph, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">START</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ›å»ºå›¾</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StateGraph(OverallState)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ·»åŠ èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_topics&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, generate_topics)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, generate_joke)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;best_joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, best_joke)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ·»åŠ è¾¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph.add_edge(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">START</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_topics&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¡ä»¶è¾¹ï¼šä½¿ç”¨ Send åŠ¨æ€åˆ†å‘ä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph.add_conditional_edges(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_topics&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, continue_to_jokes, [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;best_joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;best_joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¼–è¯‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.compile()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong>LangGraph çŸ¥è¯†ç‚¹ï¼šæ¡ä»¶è¾¹ä¸ Send</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph.add_conditional_edges(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_topics&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, continue_to_jokes, [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#                          ^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#                          æºèŠ‚ç‚¹             æ¡ä»¶å‡½æ•°             å¯èƒ½çš„ç›®æ ‡èŠ‚ç‚¹</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>continue_to_jokes</code> è¿”å› <code>Send</code> å¯¹è±¡åˆ—è¡¨</li><li>LangGraph ä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ª <code>Send</code> åˆ›å»ºä¸€ä¸ªåˆ° <code>generate_joke</code> çš„å¹¶è¡Œè·¯å¾„</li><li>æ‰€æœ‰å¹¶è¡Œä»»åŠ¡å®Œæˆåï¼Œè‡ªåŠ¨è¿›å…¥ <code>best_joke</code> èŠ‚ç‚¹</li></ul><hr><h3 id="_8-æ‰§è¡Œå›¾" tabindex="-1">8. æ‰§è¡Œå›¾ <a class="header-anchor" href="#_8-æ‰§è¡Œå›¾" aria-label="Permalink to &quot;8. æ‰§è¡Œå›¾&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> app.stream({</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;topic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;animals&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(s)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>è¾“å‡ºç¤ºä¾‹ï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;generate_topics&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;subjects&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;mammals&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;reptiles&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;birds&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]}}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;generate_joke&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;jokes&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Why don&#39;t mammals ever get lost? Because they always follow their &#39;instincts&#39;!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]}}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;generate_joke&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;jokes&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Why don&#39;t alligators like fast food? Because they can&#39;t catch it!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]}}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;generate_joke&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;jokes&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Why do birds fly south for the winter? Because it&#39;s too far to walk!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]}}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;best_joke&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;best_selected_joke&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Why don&#39;t alligators like fast food? Because they can&#39;t catch it!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>è§‚å¯Ÿè¦ç‚¹ï¼š</strong></p><ol><li>é¦–å…ˆç”Ÿæˆ 3 ä¸ªå­ä¸»é¢˜</li><li>ç„¶åå¹¶è¡Œç”Ÿæˆ 3 ä¸ªç¬‘è¯ï¼ˆæ³¨æ„è¾“å‡ºé¡ºåºå¯èƒ½ä¸åŒï¼‰</li><li>æœ€åé€‰å‡ºæœ€ä½³ç¬‘è¯</li></ol><hr><h2 id="ğŸ“-æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“" tabindex="-1">ğŸ“ æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“ <a class="header-anchor" href="#ğŸ“-æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“" aria-label="Permalink to &quot;ğŸ“ æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“&quot;">â€‹</a></h2><h3 id="langgraph-ç‰¹æœ‰æ¦‚å¿µ" tabindex="-1">LangGraph ç‰¹æœ‰æ¦‚å¿µ <a class="header-anchor" href="#langgraph-ç‰¹æœ‰æ¦‚å¿µ" aria-label="Permalink to &quot;LangGraph ç‰¹æœ‰æ¦‚å¿µ&quot;">â€‹</a></h3><h4 id="_1-send-api" tabindex="-1">1. Send API <a class="header-anchor" href="#_1-send-api" aria-label="Permalink to &quot;1. Send API&quot;">â€‹</a></h4><p><strong>ä½œç”¨ï¼š</strong> åŠ¨æ€åˆ›å»ºå¹¶è¡Œä»»åŠ¡</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Send(node_name, state_dict)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li>è¿è¡Œæ—¶åŠ¨æ€å†³å®šå¹¶è¡Œæ•°é‡</li><li>å¯ä»¥å‘é€è‡ªå®šä¹‰çŠ¶æ€ï¼ˆä¸å¿…æ˜¯å®Œæ•´çš„å›¾çŠ¶æ€ï¼‰</li><li>è‡ªåŠ¨å¤„ç†å¹¶è¡Œæ‰§è¡Œå’Œç»“æœèšåˆ</li></ul><h4 id="_2-map-reduce-æ¨¡å¼" tabindex="-1">2. Map-Reduce æ¨¡å¼ <a class="header-anchor" href="#_2-map-reduce-æ¨¡å¼" aria-label="Permalink to &quot;2. Map-Reduce æ¨¡å¼&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>é˜¶æ®µ</th><th>ä½œç”¨</th><th>èŠ‚ç‚¹æ•°é‡</th><th>æ‰§è¡Œæ–¹å¼</th></tr></thead><tbody><tr><td><strong>Map</strong></td><td>åˆ†è§£ä»»åŠ¡ï¼Œç”Ÿæˆç»“æœ</td><td>åŠ¨æ€ï¼ˆæ ¹æ®æ•°æ®ï¼‰</td><td>å¹¶è¡Œ</td></tr><tr><td><strong>Reduce</strong></td><td>èšåˆç»“æœ</td><td>1 ä¸ª</td><td>ä¸²è¡Œï¼ˆç­‰å¾…æ‰€æœ‰ Map å®Œæˆï¼‰</td></tr></tbody></table><h4 id="_3-å¤šçŠ¶æ€è®¾è®¡" tabindex="-1">3. å¤šçŠ¶æ€è®¾è®¡ <a class="header-anchor" href="#_3-å¤šçŠ¶æ€è®¾è®¡" aria-label="Permalink to &quot;3. å¤šçŠ¶æ€è®¾è®¡&quot;">â€‹</a></h4><ul><li><strong>OverallState</strong>ï¼šå…¨å±€çŠ¶æ€ï¼Œè´¯ç©¿æ•´ä¸ªå›¾</li><li><strong>JokeState</strong>ï¼šå±€éƒ¨çŠ¶æ€ï¼Œåªç”¨äºç‰¹å®šèŠ‚ç‚¹</li><li>é€šè¿‡ <code>Send</code> å¯ä»¥åœ¨ä¸åŒçŠ¶æ€ä¹‹é—´ä¼ é€’æ•°æ®</li></ul><h4 id="_4-æ¡ä»¶è¾¹-send" tabindex="-1">4. æ¡ä»¶è¾¹ + Send <a class="header-anchor" href="#_4-æ¡ä»¶è¾¹-send" aria-label="Permalink to &quot;4. æ¡ä»¶è¾¹ + Send&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph.add_conditional_edges(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;source_node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æºèŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    condition_function,      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¿”å› Send åˆ—è¡¨çš„å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;target_node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç›®æ ‡èŠ‚ç‚¹ï¼ˆSend æŒ‡å‘çš„èŠ‚ç‚¹ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="python-ç‰¹æœ‰çŸ¥è¯†ç‚¹" tabindex="-1">Python ç‰¹æœ‰çŸ¥è¯†ç‚¹ <a class="header-anchor" href="#python-ç‰¹æœ‰çŸ¥è¯†ç‚¹" aria-label="Permalink to &quot;Python ç‰¹æœ‰çŸ¥è¯†ç‚¹&quot;">â€‹</a></h3><h4 id="_1-pydantic-basemodel" tabindex="-1">1. Pydantic BaseModel <a class="header-anchor" href="#_1-pydantic-basemodel" aria-label="Permalink to &quot;1. Pydantic BaseModel&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pydantic </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BaseModel</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Joke</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    joke: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç”¨äº LLM ç»“æ„åŒ–è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model.with_structured_output(Joke).invoke(prompt)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>ä¼˜åŠ¿ï¼š</strong></p><ul><li>è‡ªåŠ¨ç±»å‹éªŒè¯</li><li>æ¸…æ™°çš„æ•°æ®ç»“æ„</li><li>ä¸ LangChain æ— ç¼é›†æˆ</li></ul><h4 id="_2-typeddict-vs-basemodel" tabindex="-1">2. TypedDict vs BaseModel <a class="header-anchor" href="#_2-typeddict-vs-basemodel" aria-label="Permalink to &quot;2. TypedDict vs BaseModel&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>ç‰¹æ€§</th><th>TypedDict</th><th>BaseModel</th></tr></thead><tbody><tr><td>ç±»å‹æ£€æŸ¥</td><td>é™æ€ï¼ˆIDE æç¤ºï¼‰</td><td>è¿è¡Œæ—¶éªŒè¯</td></tr><tr><td>éªŒè¯</td><td>æ— </td><td>æœ‰</td></tr><tr><td>ç”¨é€”</td><td>çŠ¶æ€å®šä¹‰</td><td>æ•°æ®æ¨¡å‹ã€API è¾“å‡º</td></tr><tr><td>æ€§èƒ½</td><td>æ›´å¿«ï¼ˆæ— éªŒè¯ï¼‰</td><td>ç¨æ…¢ï¼ˆæœ‰éªŒè¯ï¼‰</td></tr></tbody></table><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># TypedDict - ç”¨äº State</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OverallState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    topic: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># BaseModel - ç”¨äºç»“æ„åŒ–è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Joke</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    joke: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_3-åˆ—è¡¨æ¨å¯¼å¼-send" tabindex="-1">3. åˆ—è¡¨æ¨å¯¼å¼ + Send <a class="header-anchor" href="#_3-åˆ—è¡¨æ¨å¯¼å¼-send" aria-label="Permalink to &quot;3. åˆ—è¡¨æ¨å¯¼å¼ + Send&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ›å»ºå¤šä¸ª Send ä»»åŠ¡çš„ä¼˜é›…æ–¹å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;subject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: s}) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subjects]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç­‰ä»·äºï¼š</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subjects:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    result.append(Send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;subject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: s}))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><hr><h2 id="ğŸ’¡-æœ€ä½³å®è·µ" tabindex="-1">ğŸ’¡ æœ€ä½³å®è·µ <a class="header-anchor" href="#ğŸ’¡-æœ€ä½³å®è·µ" aria-label="Permalink to &quot;ğŸ’¡ æœ€ä½³å®è·µ&quot;">â€‹</a></h2><h3 id="_1-ä½•æ—¶ä½¿ç”¨-map-reduce" tabindex="-1">1. ä½•æ—¶ä½¿ç”¨ Map-Reduceï¼Ÿ <a class="header-anchor" href="#_1-ä½•æ—¶ä½¿ç”¨-map-reduce" aria-label="Permalink to &quot;1. ä½•æ—¶ä½¿ç”¨ Map-Reduceï¼Ÿ&quot;">â€‹</a></h3><p>âœ… <strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p><ul><li>éœ€è¦å¯¹å¤šä¸ªæ•°æ®é¡¹æ‰§è¡Œç›¸åŒæ“ä½œï¼ˆå¦‚æ‰¹é‡ç¿»è¯‘ã€æ‰¹é‡æ‘˜è¦ï¼‰</li><li>ä»»åŠ¡å¯ä»¥è‡ªç„¶åˆ†è§£ä¸ºç‹¬ç«‹å­ä»»åŠ¡ï¼ˆå¦‚åˆ†æ®µå¤„ç†æ–‡æ¡£ï¼‰</li><li>éœ€è¦ä»å¤šä¸ªå€™é€‰ç»“æœä¸­ç­›é€‰ï¼ˆå¦‚ç”Ÿæˆå¤šä¸ªç­”æ¡ˆé€‰æœ€ä½³ï¼‰</li><li>æ•°æ®é‡å¤§ï¼Œéœ€è¦å¹¶è¡ŒåŠ é€Ÿï¼ˆå¦‚åˆ†æå¤šä¸ªæ•°æ®æºï¼‰</li></ul><p>âŒ <strong>ä¸é€‚ç”¨åœºæ™¯ï¼š</strong></p><ul><li>å­ä»»åŠ¡ä¹‹é—´æœ‰ä¾èµ–å…³ç³»</li><li>æ— æ³•è‡ªç„¶åˆ†è§£çš„ä»»åŠ¡</li><li>å•ä¸€æ•°æ®æºçš„ç®€å•æŸ¥è¯¢</li></ul><h3 id="_2-send-api-ä½¿ç”¨æŠ€å·§" tabindex="-1">2. Send API ä½¿ç”¨æŠ€å·§ <a class="header-anchor" href="#_2-send-api-ä½¿ç”¨æŠ€å·§" aria-label="Permalink to &quot;2. Send API ä½¿ç”¨æŠ€å·§&quot;">â€‹</a></h3><h4 id="æŠ€å·§-1-åŠ¨æ€æ§åˆ¶å¹¶è¡Œæ•°é‡" tabindex="-1">æŠ€å·§ 1ï¼šåŠ¨æ€æ§åˆ¶å¹¶è¡Œæ•°é‡ <a class="header-anchor" href="#æŠ€å·§-1-åŠ¨æ€æ§åˆ¶å¹¶è¡Œæ•°é‡" aria-label="Permalink to &quot;æŠ€å·§ 1ï¼šåŠ¨æ€æ§åˆ¶å¹¶è¡Œæ•°é‡&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> continue_to_jokes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: OverallState):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å¯ä»¥æ ¹æ®æ¡ä»¶è¿‡æ»¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subjects </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;subjects&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(s) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [Send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;subject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: s}) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subjects]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="æŠ€å·§-2-å‘é€é¢å¤–ä¸Šä¸‹æ–‡" tabindex="-1">æŠ€å·§ 2ï¼šå‘é€é¢å¤–ä¸Šä¸‹æ–‡ <a class="header-anchor" href="#æŠ€å·§-2-å‘é€é¢å¤–ä¸Šä¸‹æ–‡" aria-label="Permalink to &quot;æŠ€å·§ 2ï¼šå‘é€é¢å¤–ä¸Šä¸‹æ–‡&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> continue_to_jokes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: OverallState):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;subject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: s,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;original_topic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;topic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä¼ é€’é¢å¤–ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;style&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;family-friendly&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        })</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;subjects&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="æŠ€å·§-3-æ¡ä»¶æ€§å‘é€" tabindex="-1">æŠ€å·§ 3ï¼šæ¡ä»¶æ€§å‘é€ <a class="header-anchor" href="#æŠ€å·§-3-æ¡ä»¶æ€§å‘é€" aria-label="Permalink to &quot;æŠ€å·§ 3ï¼šæ¡ä»¶æ€§å‘é€&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> continue_to_jokes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: OverallState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sends </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i, s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> enumerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;subjects&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æœ€å¤šåªå¤„ç†å‰ 5 ä¸ª</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            sends.append(Send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;subject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: s}))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sends</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_3-çŠ¶æ€è®¾è®¡åŸåˆ™" tabindex="-1">3. çŠ¶æ€è®¾è®¡åŸåˆ™ <a class="header-anchor" href="#_3-çŠ¶æ€è®¾è®¡åŸåˆ™" aria-label="Permalink to &quot;3. çŠ¶æ€è®¾è®¡åŸåˆ™&quot;">â€‹</a></h3><h4 id="åŸåˆ™-1-æœ€å°åŒ–å±€éƒ¨çŠ¶æ€" tabindex="-1">åŸåˆ™ 1ï¼šæœ€å°åŒ–å±€éƒ¨çŠ¶æ€ <a class="header-anchor" href="#åŸåˆ™-1-æœ€å°åŒ–å±€éƒ¨çŠ¶æ€" aria-label="Permalink to &quot;åŸåˆ™ 1ï¼šæœ€å°åŒ–å±€éƒ¨çŠ¶æ€&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># âœ… å¥½çš„è®¾è®¡ - åªåŒ…å«å¿…éœ€å­—æ®µ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JokeState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subject: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># âŒ ä¸å¥½çš„è®¾è®¡ - åŒ…å«ä¸éœ€è¦çš„å­—æ®µ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JokeState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subject: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    topic: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # generate_joke ä¸éœ€è¦è¿™ä¸ª</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    jokes: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # ä¹Ÿä¸éœ€è¦è¿™ä¸ª</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="åŸåˆ™-2-ä½¿ç”¨-reducer-èšåˆç»“æœ" tabindex="-1">åŸåˆ™ 2ï¼šä½¿ç”¨ Reducer èšåˆç»“æœ <a class="header-anchor" href="#åŸåˆ™-2-ä½¿ç”¨-reducer-èšåˆç»“æœ" aria-label="Permalink to &quot;åŸåˆ™ 2ï¼šä½¿ç”¨ Reducer èšåˆç»“æœ&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Map èŠ‚ç‚¹çš„è¾“å‡ºå­—æ®µå¿…é¡»æœ‰ reducer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> OverallState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    jokes: Annotated[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, operator.add]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># âœ… æ­£ç¡®</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # jokes: list  # âŒ é”™è¯¯ï¼å¹¶è¡Œæ›´æ–°ä¼šå†²çª</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="åŸåˆ™-3-æ¸…æ™°çš„çŠ¶æ€æµè½¬" tabindex="-1">åŸåˆ™ 3ï¼šæ¸…æ™°çš„çŠ¶æ€æµè½¬ <a class="header-anchor" href="#åŸåˆ™-3-æ¸…æ™°çš„çŠ¶æ€æµè½¬" aria-label="Permalink to &quot;åŸåˆ™ 3ï¼šæ¸…æ™°çš„çŠ¶æ€æµè½¬&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">OverallState (å®Œæ•´çŠ¶æ€)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    â†“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Send â†’ JokeState (å­é›†)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    â†“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">è¿”å› â†’ OverallState.jokes (éƒ¨åˆ†æ›´æ–°)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr><h2 id="ğŸš€-è¿›é˜¶æŠ€å·§" tabindex="-1">ğŸš€ è¿›é˜¶æŠ€å·§ <a class="header-anchor" href="#ğŸš€-è¿›é˜¶æŠ€å·§" aria-label="Permalink to &quot;ğŸš€ è¿›é˜¶æŠ€å·§&quot;">â€‹</a></h2><h3 id="_1-å¤šå±‚-map-reduce" tabindex="-1">1. å¤šå±‚ Map-Reduce <a class="header-anchor" href="#_1-å¤šå±‚-map-reduce" aria-label="Permalink to &quot;1. å¤šå±‚ Map-Reduce&quot;">â€‹</a></h3><p>å¯ä»¥åµŒå¥—å¤šä¸ª Map-Reduce å±‚æ¬¡ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ä¸»é¢˜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> â†“ Map</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">å­ä¸»é¢˜ (Level </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> â†“ Map</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">è¯¦ç»†ä¸»é¢˜ (Level </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> â†“ Reduce</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">æ±‡æ€»å­ä¸»é¢˜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> â†“ Reduce</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">æœ€ç»ˆç»“æœ</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_2-å¸¦é”™è¯¯å¤„ç†çš„-map-reduce" tabindex="-1">2. å¸¦é”™è¯¯å¤„ç†çš„ Map-Reduce <a class="header-anchor" href="#_2-å¸¦é”™è¯¯å¤„ç†çš„-map-reduce" aria-label="Permalink to &quot;2. å¸¦é”™è¯¯å¤„ç†çš„ Map-Reduce&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generate_joke</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: JokeState):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> joke_prompt.format(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">subject</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;subject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> model.with_structured_output(Joke).invoke(prompt)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;jokes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [response.joke]}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    except</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # è¿”å›é”™è¯¯æ ‡è®°æˆ–é»˜è®¤å€¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;jokes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Error generating joke for </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;subject&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-é™åˆ¶å¹¶è¡Œåº¦" tabindex="-1">3. é™åˆ¶å¹¶è¡Œåº¦ <a class="header-anchor" href="#_3-é™åˆ¶å¹¶è¡Œåº¦" aria-label="Permalink to &quot;3. é™åˆ¶å¹¶è¡Œåº¦&quot;">â€‹</a></h3><p>è™½ç„¶ <code>Send</code> ä¼šè‡ªåŠ¨å¹¶è¡Œï¼Œä½†æœ‰æ—¶éœ€è¦é™åˆ¶åŒæ—¶æ‰§è¡Œçš„ä»»åŠ¡æ•°ï¼ˆå¦‚ API é€Ÿç‡é™åˆ¶ï¼‰ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ–¹æ³• 1ï¼šåœ¨æ¡ä»¶å‡½æ•°ä¸­é™åˆ¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> continue_to_jokes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: OverallState):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # åªå‘é€å‰ N ä¸ª</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    max_parallel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    subjects </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;subjects&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][:max_parallel]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [Send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;subject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: s}) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> subjects]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ–¹æ³• 2ï¼šåˆ†æ‰¹å¤„ç†ï¼ˆéœ€è¦æ›´å¤æ‚çš„å›¾è®¾è®¡ï¼‰</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><hr><h2 id="ğŸ“Š-map-reduce-vs-ç®€å•å¹¶è¡Œ" tabindex="-1">ğŸ“Š Map-Reduce vs ç®€å•å¹¶è¡Œ <a class="header-anchor" href="#ğŸ“Š-map-reduce-vs-ç®€å•å¹¶è¡Œ" aria-label="Permalink to &quot;ğŸ“Š Map-Reduce vs ç®€å•å¹¶è¡Œ&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>ç‰¹æ€§</th><th>Map-Reduce (Send)</th><th>ç®€å•å¹¶è¡Œ (Fan-out)</th></tr></thead><tbody><tr><td>å¹¶è¡Œæ•°é‡</td><td>åŠ¨æ€ï¼ˆè¿è¡Œæ—¶å†³å®šï¼‰</td><td>é™æ€ï¼ˆè®¾è®¡æ—¶å›ºå®šï¼‰</td></tr><tr><td>çŠ¶æ€ä¼ é€’</td><td>çµæ´»ï¼ˆå¯è‡ªå®šä¹‰ï¼‰</td><td>å›ºå®šï¼ˆä½¿ç”¨å›¾çŠ¶æ€ï¼‰</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>åˆ—è¡¨å¤„ç†ã€æ‰¹é‡ä»»åŠ¡</td><td>å›ºå®šæ•°é‡çš„å¹¶è¡Œè·¯å¾„</td></tr><tr><td>å¤æ‚åº¦</td><td>ä¸­ç­‰</td><td>ä½</td></tr><tr><td>æ‰©å±•æ€§</td><td>é«˜</td><td>ä½</td></tr></tbody></table><p><strong>ç¤ºä¾‹å¯¹æ¯”ï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç®€å•å¹¶è¡Œ - å›ºå®š 3 ä¸ªè·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;task1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;task2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;task3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Map-Reduce - åŠ¨æ€ N ä¸ªä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> send_tasks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [Send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;task&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: d}) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;data_list&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_conditional_edges(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, send_tasks, [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;task&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><hr><h2 id="ğŸ¯-å®é™…åº”ç”¨æ¡ˆä¾‹" tabindex="-1">ğŸ¯ å®é™…åº”ç”¨æ¡ˆä¾‹ <a class="header-anchor" href="#ğŸ¯-å®é™…åº”ç”¨æ¡ˆä¾‹" aria-label="Permalink to &quot;ğŸ¯ å®é™…åº”ç”¨æ¡ˆä¾‹&quot;">â€‹</a></h2><h3 id="æ¡ˆä¾‹-1-æ–‡æ¡£æ‘˜è¦" tabindex="-1">æ¡ˆä¾‹ 1ï¼šæ–‡æ¡£æ‘˜è¦ <a class="header-anchor" href="#æ¡ˆä¾‹-1-æ–‡æ¡£æ‘˜è¦" aria-label="Permalink to &quot;æ¡ˆä¾‹ 1ï¼šæ–‡æ¡£æ‘˜è¦&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Map: ä¸ºæ¯ä¸ªæ®µè½ç”Ÿæˆæ‘˜è¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> summarize_chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: ChunkState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    summary </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.invoke(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Summarize: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;chunk&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;summaries&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [summary]}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Reduce: åˆå¹¶æ‰€æœ‰æ®µè½æ‘˜è¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> combine_summaries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: OverallState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    all_summaries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.join(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;summaries&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    final </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.invoke(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Create final summary: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">all_summaries</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;final_summary&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: final}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="æ¡ˆä¾‹-2-å¤šè¯­è¨€ç¿»è¯‘" tabindex="-1">æ¡ˆä¾‹ 2ï¼šå¤šè¯­è¨€ç¿»è¯‘ <a class="header-anchor" href="#æ¡ˆä¾‹-2-å¤šè¯­è¨€ç¿»è¯‘" aria-label="Permalink to &quot;æ¡ˆä¾‹ 2ï¼šå¤šè¯­è¨€ç¿»è¯‘&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Map: ç¿»è¯‘åˆ°å¤šç§è¯­è¨€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> send_to_translate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    languages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;es&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;fr&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;de&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;zh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [Send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;translate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lang&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: lang, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lang </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> languages]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Reduce: æ”¶é›†æ‰€æœ‰ç¿»è¯‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> collect_translations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;all_translations&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;translations&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="æ¡ˆä¾‹-3-å¤šè§’åº¦åˆ†æ" tabindex="-1">æ¡ˆä¾‹ 3ï¼šå¤šè§’åº¦åˆ†æ <a class="header-anchor" href="#æ¡ˆä¾‹-3-å¤šè§’åº¦åˆ†æ" aria-label="Permalink to &quot;æ¡ˆä¾‹ 3ï¼šå¤šè§’åº¦åˆ†æ&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Map: ä»ä¸åŒè§’åº¦åˆ†ææ–‡æœ¬</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> send_to_analyze</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    perspectives </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;technical&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;business&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;security&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [Send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;analyze&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;perspective&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: p, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> perspectives]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Reduce: ç»¼åˆæ‰€æœ‰åˆ†æ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> synthesize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    combined </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.invoke(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Synthesize these analyses: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;analyses&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;final_analysis&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: combined}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><hr><h2 id="ğŸ“–-æ‰©å±•é˜…è¯»" tabindex="-1">ğŸ“– æ‰©å±•é˜…è¯» <a class="header-anchor" href="#ğŸ“–-æ‰©å±•é˜…è¯»" aria-label="Permalink to &quot;ğŸ“– æ‰©å±•é˜…è¯»&quot;">â€‹</a></h2><ul><li><a href="https://langchain-ai.github.io/langgraph/how-tos/map-reduce/" target="_blank" rel="noreferrer">LangGraph Map-Reduce å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://langchain-ai.github.io/langgraph/concepts/low_level/#send" target="_blank" rel="noreferrer">Send API è¯¦ç»†è¯´æ˜</a></li><li><a href="https://docs.pydantic.dev/" target="_blank" rel="noreferrer">Pydantic å®˜æ–¹æ–‡æ¡£</a></li></ul><hr><h2 id="ğŸ”-å¸¸è§é—®é¢˜" tabindex="-1">ğŸ” å¸¸è§é—®é¢˜ <a class="header-anchor" href="#ğŸ”-å¸¸è§é—®é¢˜" aria-label="Permalink to &quot;ğŸ” å¸¸è§é—®é¢˜&quot;">â€‹</a></h2><h3 id="q1-send-å’Œæ™®é€šè¾¹æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1">Q1: Send å’Œæ™®é€šè¾¹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ <a class="header-anchor" href="#q1-send-å’Œæ™®é€šè¾¹æœ‰ä»€ä¹ˆåŒºåˆ«" aria-label="Permalink to &quot;Q1: Send å’Œæ™®é€šè¾¹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&quot;">â€‹</a></h3><p><strong>æ™®é€šè¾¹ï¼š</strong> é™æ€è·¯ç”±ï¼Œè®¾è®¡æ—¶ç¡®å®š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;B&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># A æ€»æ˜¯æµå‘ B</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>Sendï¼š</strong> åŠ¨æ€è·¯ç”±ï¼Œè¿è¡Œæ—¶ç¡®å®š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ ¹æ®æ•°æ®åŠ¨æ€åˆ›å»ºå¤šä¸ªå¹¶è¡Œä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [Send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;B&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, data) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dynamic_data]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="q2-ä¸ºä»€ä¹ˆ-generate-joke-è¿”å›-jokes-joke-è€Œä¸æ˜¯-jokes-joke" tabindex="-1">Q2: ä¸ºä»€ä¹ˆ generate_joke è¿”å› <code>{&quot;jokes&quot;: [joke]}</code> è€Œä¸æ˜¯ <code>{&quot;jokes&quot;: joke}</code>ï¼Ÿ <a class="header-anchor" href="#q2-ä¸ºä»€ä¹ˆ-generate-joke-è¿”å›-jokes-joke-è€Œä¸æ˜¯-jokes-joke" aria-label="Permalink to &quot;Q2: ä¸ºä»€ä¹ˆ generate_joke è¿”å› \`{&quot;jokes&quot;: [joke]}\` è€Œä¸æ˜¯ \`{&quot;jokes&quot;: joke}\`ï¼Ÿ&quot;">â€‹</a></h3><p>å› ä¸º <code>OverallState.jokes</code> ä½¿ç”¨äº† <code>operator.add</code> reducerï¼Œå®ƒæœŸæœ›æ“ä½œåˆ—è¡¨ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ­£ç¡® âœ…</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">operator.add([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;joke1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;joke2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># â†’ [&quot;joke1&quot;, &quot;joke2&quot;]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é”™è¯¯ âŒ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">operator.add(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;joke1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;joke2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># â†’ &quot;joke1joke2&quot; (å­—ç¬¦ä¸²æ‹¼æ¥)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="q3-å¯ä»¥åœ¨-send-ä¸­å‘é€å®Œå…¨ä¸åŒçš„çŠ¶æ€å—" tabindex="-1">Q3: å¯ä»¥åœ¨ Send ä¸­å‘é€å®Œå…¨ä¸åŒçš„çŠ¶æ€å—ï¼Ÿ <a class="header-anchor" href="#q3-å¯ä»¥åœ¨-send-ä¸­å‘é€å®Œå…¨ä¸åŒçš„çŠ¶æ€å—" aria-label="Permalink to &quot;Q3: å¯ä»¥åœ¨ Send ä¸­å‘é€å®Œå…¨ä¸åŒçš„çŠ¶æ€å—ï¼Ÿ&quot;">â€‹</a></h3><p>å¯ä»¥ï¼<code>Send</code> å‘é€çš„çŠ¶æ€ä¸éœ€è¦ä¸ <code>OverallState</code> åŒ¹é…ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># OverallState æœ‰ topic, subjects, jokes</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½† Send å¯ä»¥å‘é€ä»»æ„ç»“æ„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;generate_joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;subject&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cats&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;style&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;silly&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>åªè¦ç›®æ ‡èŠ‚ç‚¹ï¼ˆ<code>generate_joke</code>ï¼‰èƒ½å¤„ç†è¿™ä¸ªçŠ¶æ€å³å¯ã€‚</p><hr><p><strong>æ€»ç»“</strong>ï¼šMap-Reduce æ˜¯ LangGraph ä¸­å¤„ç†æ‰¹é‡ã€å¹¶è¡Œä»»åŠ¡çš„å¼ºå¤§æ¨¡å¼ã€‚é€šè¿‡ <code>Send</code> APIï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€åˆ›å»ºä»»æ„æ•°é‡çš„å¹¶è¡Œä»»åŠ¡ï¼Œç„¶åç”¨ reducer ä¼˜é›…åœ°èšåˆç»“æœã€‚è¿™æ˜¯æ„å»ºå¯æ‰©å±•ã€é«˜æ€§èƒ½ AI åº”ç”¨çš„å…³é”®æŠ€æœ¯ï¼</p>`,162)])])}const c=i(l,[["render",t]]);export{o as __pageData,c as default};
