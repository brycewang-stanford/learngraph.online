import{_ as i,c as a,o as n,ag as l}from"./chunks/framework.Cf3FQAeg.js";const c=JSON.parse('{"title":"LangGraph ç ”ç©¶åŠ©æ‰‹æ¡ˆä¾‹è¯¦ç»†è§£è¯»","description":"","frontmatter":{},"headers":[],"relativePath":"module-4/4.4-research-assistant-è¯¦ç»†è§£è¯».md","filePath":"module-4/4.4-research-assistant-è¯¦ç»†è§£è¯».md","lastUpdated":1760223716000}'),p={name:"module-4/4.4-research-assistant-è¯¦ç»†è§£è¯».md"};function e(t,s,h,k,r,E){return n(),a("div",null,[...s[0]||(s[0]=[l(`<h1 id="langgraph-ç ”ç©¶åŠ©æ‰‹æ¡ˆä¾‹è¯¦ç»†è§£è¯»" tabindex="-1">LangGraph ç ”ç©¶åŠ©æ‰‹æ¡ˆä¾‹è¯¦ç»†è§£è¯» <a class="header-anchor" href="#langgraph-ç ”ç©¶åŠ©æ‰‹æ¡ˆä¾‹è¯¦ç»†è§£è¯»" aria-label="Permalink to &quot;LangGraph ç ”ç©¶åŠ©æ‰‹æ¡ˆä¾‹è¯¦ç»†è§£è¯»&quot;">â€‹</a></h1><h2 id="ğŸ“‹-æ¡ˆä¾‹æ¦‚è§ˆ" tabindex="-1">ğŸ“‹ æ¡ˆä¾‹æ¦‚è§ˆ <a class="header-anchor" href="#ğŸ“‹-æ¡ˆä¾‹æ¦‚è§ˆ" aria-label="Permalink to &quot;ğŸ“‹ æ¡ˆä¾‹æ¦‚è§ˆ&quot;">â€‹</a></h2><p>è¿™ä¸ªæ¡ˆä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ LangGraph æ„å»ºä¸€ä¸ª<strong>æ™ºèƒ½ç ”ç©¶åŠ©æ‰‹ç³»ç»Ÿ</strong>ï¼Œå®ƒèƒ½å¤Ÿï¼š</p><ol><li>æ ¹æ®ç ”ç©¶ä¸»é¢˜è‡ªåŠ¨ç”Ÿæˆå¤šä¸ªä¸“ä¸šåˆ†æå¸ˆ</li><li>æ¯ä¸ªåˆ†æå¸ˆå¯¹ç‰¹å®šå­ä¸»é¢˜è¿›è¡Œæ·±åº¦è®¿è°ˆ</li><li>å¹¶è¡Œæ‰§è¡Œå¤šä¸ªè®¿è°ˆä»¥æé«˜æ•ˆç‡</li><li>æœ€ç»ˆå°†æ‰€æœ‰è®¿è°ˆæ•´åˆæˆä¸€ä»½å®Œæ•´çš„ç ”ç©¶æŠ¥å‘Š</li></ol><h3 id="æ ¸å¿ƒæŠ€æœ¯ç‚¹" tabindex="-1">æ ¸å¿ƒæŠ€æœ¯ç‚¹ <a class="header-anchor" href="#æ ¸å¿ƒæŠ€æœ¯ç‚¹" aria-label="Permalink to &quot;æ ¸å¿ƒæŠ€æœ¯ç‚¹&quot;">â€‹</a></h3><ul><li><strong>äººæœºåä½œ</strong>ï¼ˆHuman-in-the-Loopï¼‰ï¼šç”¨æˆ·å¯ä»¥å®¡æ ¸å¹¶ä¿®æ”¹ç”Ÿæˆçš„åˆ†æå¸ˆå›¢é˜Ÿ</li><li><strong>ç»“æ„åŒ–è¾“å‡º</strong>ï¼šä½¿ç”¨ Pydantic æ¨¡å‹ç¡®ä¿æ•°æ®æ ¼å¼ä¸€è‡´</li><li><strong>å­å›¾åµŒå¥—</strong>ï¼šè®¿è°ˆæµç¨‹ä½œä¸ºç‹¬ç«‹å­å›¾åµŒå…¥ä¸»å›¾</li><li><strong>å¹¶è¡Œæ‰§è¡Œ</strong>ï¼ˆMap-Reduceï¼‰ï¼šä½¿ç”¨ <code>Send()</code> API åŒæ—¶è¿è¡Œå¤šä¸ªè®¿è°ˆ</li><li><strong>æ£€æŸ¥ç‚¹æœºåˆ¶</strong>ï¼šæ”¯æŒä¸­æ–­å’Œæ¢å¤æ‰§è¡Œæµç¨‹</li></ul><hr><h2 id="ğŸ—ºï¸-æ•´ä½“æ¶æ„å›¾" tabindex="-1">ğŸ—ºï¸ æ•´ä½“æ¶æ„å›¾ <a class="header-anchor" href="#ğŸ—ºï¸-æ•´ä½“æ¶æ„å›¾" aria-label="Permalink to &quot;ğŸ—ºï¸ æ•´ä½“æ¶æ„å›¾&quot;">â€‹</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç”¨æˆ·è¾“å…¥ç ”ç©¶ä¸»é¢˜</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  ç¬¬ä¸€é˜¶æ®µï¼šç”Ÿæˆåˆ†æå¸ˆå›¢é˜Ÿ                â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚  create_analysts â†’ human_feedback       â”‚</span></span>
<span class="line"><span>â”‚         â†‘                â†“               â”‚</span></span>
<span class="line"><span>â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚</span></span>
<span class="line"><span>â”‚      ï¼ˆå¯å¾ªç¯ä¿®æ”¹ç›´åˆ°æ»¡æ„ï¼‰               â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  ç¬¬äºŒé˜¶æ®µï¼šå¹¶è¡Œæ‰§è¡Œè®¿è°ˆï¼ˆMapï¼‰           â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚  åˆ†æå¸ˆ1 â†’ è®¿è°ˆå­å›¾ â†’ ç”Ÿæˆç« èŠ‚           â”‚</span></span>
<span class="line"><span>â”‚  åˆ†æå¸ˆ2 â†’ è®¿è°ˆå­å›¾ â†’ ç”Ÿæˆç« èŠ‚           â”‚</span></span>
<span class="line"><span>â”‚  åˆ†æå¸ˆ3 â†’ è®¿è°ˆå­å›¾ â†’ ç”Ÿæˆç« èŠ‚           â”‚</span></span>
<span class="line"><span>â”‚         ï¼ˆæ‰€æœ‰è®¿è°ˆåŒæ—¶è¿›è¡Œï¼‰             â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚  ç¬¬ä¸‰é˜¶æ®µï¼šæ±‡æ€»æŠ¥å‘Šï¼ˆReduceï¼‰            â”‚</span></span>
<span class="line"><span>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span></span>
<span class="line"><span>â”‚  write_introduction â”                   â”‚</span></span>
<span class="line"><span>â”‚  write_report       â”œâ†’ finalize_report  â”‚</span></span>
<span class="line"><span>â”‚  write_conclusion   â”˜                   â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>    â†“</span></span>
<span class="line"><span>  æœ€ç»ˆæŠ¥å‘Š</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><hr><h2 id="ğŸ“š-ä»£ç åˆ†æ®µè¯¦è§£" tabindex="-1">ğŸ“š ä»£ç åˆ†æ®µè¯¦è§£ <a class="header-anchor" href="#ğŸ“š-ä»£ç åˆ†æ®µè¯¦è§£" aria-label="Permalink to &quot;ğŸ“š ä»£ç åˆ†æ®µè¯¦è§£&quot;">â€‹</a></h2><h3 id="ç¬¬ä¸€éƒ¨åˆ†-å®šä¹‰æ•°æ®ç»“æ„" tabindex="-1">ç¬¬ä¸€éƒ¨åˆ†ï¼šå®šä¹‰æ•°æ®ç»“æ„ <a class="header-anchor" href="#ç¬¬ä¸€éƒ¨åˆ†-å®šä¹‰æ•°æ®ç»“æ„" aria-label="Permalink to &quot;ç¬¬ä¸€éƒ¨åˆ†ï¼šå®šä¹‰æ•°æ®ç»“æ„&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Analyst</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    affiliation: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # æ‰€å±æœºæ„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         # å§“å</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    role: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         # è§’è‰²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    description: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # æè¿°</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>ä½œç”¨</strong>ï¼šè¿™æ˜¯ä¸€ä¸ª Pydantic æ¨¡å‹ï¼Œå®šä¹‰äº†&quot;åˆ†æå¸ˆ&quot;çš„æ ‡å‡†æ ¼å¼ã€‚</p><p><strong>ä¸ºä»€ä¹ˆé‡è¦</strong>ï¼Ÿ</p><ul><li>ä½¿ç”¨ç»“æ„åŒ–æ•°æ®æ¨¡å‹å¯ä»¥ç¡®ä¿ LLM è¾“å‡ºçš„æ ¼å¼ä¸€è‡´</li><li><code>@property</code> è£…é¥°å™¨åˆ›å»ºäº† <code>persona</code> å±æ€§ï¼Œå°†æ‰€æœ‰ä¿¡æ¯ç»„åˆæˆä¸€ä¸ªå­—ç¬¦ä¸²</li><li>LangGraph å¯ä»¥åŸºäºè¿™ä¸ªæ¨¡å‹è‡ªåŠ¨éªŒè¯æ•°æ®</li></ul><hr><h3 id="ç¬¬äºŒéƒ¨åˆ†-ç”Ÿæˆåˆ†æå¸ˆ-ç¬¬ä¸€ä¸ªå›¾" tabindex="-1">ç¬¬äºŒéƒ¨åˆ†ï¼šç”Ÿæˆåˆ†æå¸ˆï¼ˆç¬¬ä¸€ä¸ªå›¾ï¼‰ <a class="header-anchor" href="#ç¬¬äºŒéƒ¨åˆ†-ç”Ÿæˆåˆ†æå¸ˆ-ç¬¬ä¸€ä¸ªå›¾" aria-label="Permalink to &quot;ç¬¬äºŒéƒ¨åˆ†ï¼šç”Ÿæˆåˆ†æå¸ˆï¼ˆç¬¬ä¸€ä¸ªå›¾ï¼‰&quot;">â€‹</a></h3><h4 id="çŠ¶æ€å®šä¹‰" tabindex="-1">çŠ¶æ€å®šä¹‰ <a class="header-anchor" href="#çŠ¶æ€å®šä¹‰" aria-label="Permalink to &quot;çŠ¶æ€å®šä¹‰&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GenerateAnalystsState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    topic: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    # ç ”ç©¶ä¸»é¢˜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    max_analysts: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             # æœ€å¤§åˆ†æå¸ˆæ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    human_analyst_feedback: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # ç”¨æˆ·åé¦ˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    analysts: List[Analyst]       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç”Ÿæˆçš„åˆ†æå¸ˆåˆ—è¡¨</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>å…³é”®æ¦‚å¿µ</strong>ï¼šçŠ¶æ€ï¼ˆStateï¼‰æ˜¯ LangGraph ä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒåƒä¸€ä¸ª&quot;å…±äº«å†…å­˜&quot;ï¼Œåœ¨å„ä¸ªèŠ‚ç‚¹ä¹‹é—´ä¼ é€’æ•°æ®ã€‚</p><hr><h4 id="èŠ‚ç‚¹å‡½æ•°" tabindex="-1">èŠ‚ç‚¹å‡½æ•° <a class="header-anchor" href="#èŠ‚ç‚¹å‡½æ•°" aria-label="Permalink to &quot;èŠ‚ç‚¹å‡½æ•°&quot;">â€‹</a></h4><p><strong>1. create_analysts èŠ‚ç‚¹</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> create_analysts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: GenerateAnalystsState):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ä½¿ç”¨ structured_output ç¡®ä¿ LLM è¿”å›ç¬¦åˆ Perspectives æ ¼å¼çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    structured_llm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.with_structured_output(Perspectives)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ„å»ºç³»ç»Ÿæç¤ºè¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    system_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> analyst_instructions.format(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        topic</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">topic,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        human_analyst_feedback</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">human_analyst_feedback,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        max_analysts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">max_analysts</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è°ƒç”¨ LLM ç”Ÿæˆåˆ†æå¸ˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    analysts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> structured_llm.invoke([SystemMessage(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;analysts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: analysts.analysts}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>æŠ€æœ¯äº®ç‚¹</strong>ï¼š</p><ul><li><code>with_structured_output()</code> å¼ºåˆ¶ LLM è¿”å›ç¬¦åˆ <code>Perspectives</code> æ¨¡å‹çš„ JSON</li><li>æç¤ºè¯ä¸­åŒ…å«äº†ä¸»é¢˜ã€ç”¨æˆ·åé¦ˆå’Œæ•°é‡é™åˆ¶</li><li>è¿”å›çš„å­—å…¸ä¼š<strong>æ›´æ–°</strong>çŠ¶æ€ä¸­çš„ <code>analysts</code> å­—æ®µ</li></ul><hr><p><strong>2. human_feedback èŠ‚ç‚¹</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> human_feedback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: GenerateAnalystsState):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pass</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # ç©ºæ“ä½œèŠ‚ç‚¹</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ç©ºèŠ‚ç‚¹ï¼Ÿ</strong></p><ul><li>è¿™æ˜¯ä¸€ä¸ª&quot;ä¸­æ–­ç‚¹&quot;ï¼ˆinterrupt pointï¼‰</li><li>å½“æ‰§è¡Œåˆ°è¿™é‡Œæ—¶ï¼Œå›¾ä¼šæš‚åœï¼Œç­‰å¾…ç”¨æˆ·è¾“å…¥</li><li>ç”¨æˆ·å¯ä»¥é€šè¿‡ <code>graph.update_state()</code> ä¿®æ”¹çŠ¶æ€</li></ul><hr><p><strong>3. should_continue æ¡ä»¶è¾¹</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> should_continue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: GenerateAnalystsState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    human_analyst_feedback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;human_analyst_feedback&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> human_analyst_feedback:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;create_analysts&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # æœ‰åé¦ˆï¼Œé‡æ–°ç”Ÿæˆ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> END</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # æ— åé¦ˆï¼Œç»“æŸ</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>é€»è¾‘è¯´æ˜</strong>ï¼š</p><ul><li>æ£€æŸ¥çŠ¶æ€ä¸­æ˜¯å¦æœ‰ <code>human_analyst_feedback</code></li><li>å¦‚æœæœ‰ â†’ å›åˆ° <code>create_analysts</code> é‡æ–°ç”Ÿæˆ</li><li>å¦‚æœæ²¡æœ‰ â†’ ç»“æŸè¿™ä¸ªé˜¶æ®µ</li></ul><hr><h4 id="å›¾çš„æ„å»º" tabindex="-1">å›¾çš„æ„å»º <a class="header-anchor" href="#å›¾çš„æ„å»º" aria-label="Permalink to &quot;å›¾çš„æ„å»º&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StateGraph(GenerateAnalystsState)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;create_analysts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, create_analysts)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;human_feedback&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, human_feedback)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¾¹çš„è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">START</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;create_analysts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;create_analysts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;human_feedback&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_conditional_edges(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;human_feedback&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, should_continue,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;create_analysts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¼–è¯‘å›¾</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder.compile(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    interrupt_before</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;human_feedback&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åœ¨æ­¤èŠ‚ç‚¹å‰ä¸­æ–­</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    checkpointer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">memory                   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨å†…å­˜ä¿å­˜çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>å…³é”®æœºåˆ¶</strong>ï¼š</p><ul><li><code>interrupt_before</code> ä½¿å›¾åœ¨ <code>human_feedback</code> å‰æš‚åœ</li><li><code>checkpointer</code> ä¿å­˜æ‰§è¡ŒçŠ¶æ€ï¼Œæ”¯æŒæ¢å¤</li><li><code>conditional_edges</code> æ ¹æ®å‡½æ•°è¿”å›å€¼å†³å®šä¸‹ä¸€æ­¥</li></ul><hr><h3 id="ç¬¬ä¸‰éƒ¨åˆ†-æ‰§è¡Œè®¿è°ˆ-å­å›¾" tabindex="-1">ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ‰§è¡Œè®¿è°ˆï¼ˆå­å›¾ï¼‰ <a class="header-anchor" href="#ç¬¬ä¸‰éƒ¨åˆ†-æ‰§è¡Œè®¿è°ˆ-å­å›¾" aria-label="Permalink to &quot;ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ‰§è¡Œè®¿è°ˆï¼ˆå­å›¾ï¼‰&quot;">â€‹</a></h3><h4 id="è®¿è°ˆçŠ¶æ€" tabindex="-1">è®¿è°ˆçŠ¶æ€ <a class="header-anchor" href="#è®¿è°ˆçŠ¶æ€" aria-label="Permalink to &quot;è®¿è°ˆçŠ¶æ€&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InterviewState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MessagesState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    max_num_turns: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # æœ€å¤§å¯¹è¯è½®æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    context: Annotated[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, operator.add]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ£€ç´¢åˆ°çš„æ–‡æ¡£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    analyst: Analyst        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å½“å‰åˆ†æå¸ˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    interview: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # è®¿è°ˆè®°å½•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sections: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # ç”Ÿæˆçš„ç« èŠ‚</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>æ³¨æ„</strong>ï¼š<code>context: Annotated[list, operator.add]</code></p><ul><li><code>Annotated</code> æŒ‡å®šäº†å¦‚ä½•åˆå¹¶çŠ¶æ€</li><li><code>operator.add</code> è¡¨ç¤ºæ–°çš„ context ä¼šè¿½åŠ åˆ°ç°æœ‰åˆ—è¡¨ä¸­</li><li>è¿™æ ·å¤šä¸ªæœç´¢ç»“æœå¯ä»¥ç´¯ç§¯</li></ul><hr><h4 id="æ ¸å¿ƒèŠ‚ç‚¹" tabindex="-1">æ ¸å¿ƒèŠ‚ç‚¹ <a class="header-anchor" href="#æ ¸å¿ƒèŠ‚ç‚¹" aria-label="Permalink to &quot;æ ¸å¿ƒèŠ‚ç‚¹&quot;">â€‹</a></h4><p><strong>1. generate_question - åˆ†æå¸ˆæé—®</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generate_question</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: InterviewState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    analyst </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;analyst&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ„å»ºç³»ç»Ÿæç¤º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    system_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> question_instructions.format(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">goals</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">analyst.persona)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # LLM æ ¹æ®åˆ†æå¸ˆçš„è§’è‰²ç”Ÿæˆé—®é¢˜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    question </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.invoke([SystemMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">system_message)] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> messages)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [question]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>å·¥ä½œæµç¨‹</strong>ï¼š</p><ol><li>è·å–åˆ†æå¸ˆçš„äººè®¾ï¼ˆpersonaï¼‰</li><li>ç»“åˆå¯¹è¯å†å²ï¼Œç”Ÿæˆä¸‹ä¸€ä¸ªé—®é¢˜</li><li>é—®é¢˜ä¼šè¿½åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨ä¸­</li></ol><hr><p><strong>2. search_web å’Œ search_wikipedia - å¹¶è¡Œæœç´¢</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> search_web</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: InterviewState):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å°†å¯¹è¯è½¬æ¢ä¸ºæœç´¢æŸ¥è¯¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    structured_llm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.with_structured_output(SearchQuery)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    search_query </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> structured_llm.invoke([search_instructions] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;messages&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ä½¿ç”¨ Tavily æœç´¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    search_docs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tavily_search.invoke(search_query.search_query)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ ¼å¼åŒ–ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    formatted_search_docs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">---</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.join([</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&lt;Document href=&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">doc[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">doc[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;/Document&gt;&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> doc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> search_docs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;context&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [formatted_search_docs]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>æŠ€æœ¯ç»†èŠ‚</strong>ï¼š</p><ul><li>å…ˆç”¨ LLM å°†å¯¹è¯æç‚¼æˆæœç´¢æŸ¥è¯¢</li><li>è°ƒç”¨å¤–éƒ¨æœç´¢å·¥å…·ï¼ˆTavily/Wikipediaï¼‰</li><li>æ ¼å¼åŒ–æˆå¸¦æ¥æºæ ‡æ³¨çš„æ–‡æ¡£</li><li>è¿”å›çš„ context ä¼šè‡ªåŠ¨åˆå¹¶åˆ°çŠ¶æ€ä¸­</li></ul><hr><p><strong>3. generate_answer - ä¸“å®¶å›ç­”</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generate_answer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: InterviewState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    analyst </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;analyst&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;context&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ£€ç´¢åˆ°çš„æ‰€æœ‰æ–‡æ¡£</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ„å»ºåŒ…å«ä¸Šä¸‹æ–‡çš„æç¤º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    system_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> answer_instructions.format(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        goals</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">analyst.persona,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">context</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ç”Ÿæˆç­”æ¡ˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    answer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.invoke([SystemMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">system_message)] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> messages)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    answer.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;expert&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # æ ‡è®°æ¶ˆæ¯æ¥æº</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [answer]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>RAG æ¨¡å¼</strong>ï¼š</p><ul><li>ä½¿ç”¨æ£€ç´¢åˆ°çš„ context ä½œä¸ºçŸ¥è¯†æ¥æº</li><li>LLM åŸºäºè¿™äº›æ–‡æ¡£å›ç­”é—®é¢˜</li><li>ç­”æ¡ˆä¸­åŒ…å«å¼•ç”¨æ ‡æ³¨ï¼ˆå¦‚ [1], [2]ï¼‰</li></ul><hr><p><strong>4. route_messages - è·¯ç”±é€»è¾‘</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> route_messages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: InterviewState, name: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;expert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    max_num_turns </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;max_num_turns&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ç»Ÿè®¡ä¸“å®¶å›ç­”çš„æ¬¡æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    num_responses </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> messages</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isinstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(m, AIMessage) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è¾¾åˆ°ä¸Šé™åˆ™ä¿å­˜è®¿è°ˆ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> num_responses </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> max_num_turns:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;save_interview&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ£€æŸ¥æ˜¯å¦åŒ…å«ç»“æŸè¯­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    last_question </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> messages[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Thank you so much for your help&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> last_question.content:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;save_interview&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ask_question&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # ç»§ç»­æé—®</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>æ§åˆ¶é€»è¾‘</strong>ï¼š</p><ul><li>é™åˆ¶è®¿è°ˆè½®æ•°ï¼Œé˜²æ­¢æ— é™å¾ªç¯</li><li>æ£€æµ‹ç»“æŸä¿¡å·ï¼ˆæ„Ÿè°¢è¯­ï¼‰</li><li>å†³å®šæ˜¯ç»§ç»­æé—®è¿˜æ˜¯ç»“æŸè®¿è°ˆ</li></ul><hr><p><strong>5. write_section - ç”Ÿæˆç« èŠ‚</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> write_section</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: InterviewState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    interview </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;interview&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;context&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    analyst </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;analyst&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    system_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> section_writer_instructions.format(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        focus</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">analyst.description</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    section </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.invoke([</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        SystemMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">system_message),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Use this source to write your section: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">context</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sections&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [section.content]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>æŠ¥å‘Šç”Ÿæˆ</strong>ï¼š</p><ul><li>åŸºäºè®¿è°ˆå†…å®¹å’Œæ£€ç´¢æ–‡æ¡£</li><li>ç”Ÿæˆç»“æ„åŒ–çš„ Markdown ç« èŠ‚</li><li>åŒ…å«æ‘˜è¦å’Œæ¥æºå¼•ç”¨</li></ul><hr><h4 id="å­å›¾æ„å»º" tabindex="-1">å­å›¾æ„å»º <a class="header-anchor" href="#å­å›¾æ„å»º" aria-label="Permalink to &quot;å­å›¾æ„å»º&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interview_builder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StateGraph(InterviewState)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ·»åŠ æ‰€æœ‰èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interview_builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ask_question&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, generate_question)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interview_builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;search_web&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, search_web)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interview_builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;search_wikipedia&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, search_wikipedia)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interview_builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;answer_question&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, generate_answer)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interview_builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;save_interview&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, save_interview)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interview_builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;write_section&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, write_section)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å…³é”®ï¼šå¹¶è¡Œæœç´¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interview_builder.add_edge(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">START</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ask_question&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interview_builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ask_question&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;search_web&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interview_builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ask_question&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;search_wikipedia&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åŒæ—¶è§¦å‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interview_builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;search_web&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;answer_question&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interview_builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;search_wikipedia&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;answer_question&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¡ä»¶è·¯ç”±</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interview_builder.add_conditional_edges(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;answer_question&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, route_messages,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                       [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ask_question&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;save_interview&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interview_builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;save_interview&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;write_section&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interview_builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;write_section&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ask_question</span></span>
<span class="line"><span>    â”œâ”€â†’ search_web â”€â”€â”</span></span>
<span class="line"><span>    â””â”€â†’ search_wikipedia â”€â”€â”¤</span></span>
<span class="line"><span>                           â†“</span></span>
<span class="line"><span>                    answer_question</span></span>
<span class="line"><span>                           â†“</span></span>
<span class="line"><span>            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>            â†“                              â†“</span></span>
<span class="line"><span>       ask_question                 save_interview</span></span>
<span class="line"><span>      ï¼ˆç»§ç»­å¾ªç¯ï¼‰                        â†“</span></span>
<span class="line"><span>                                   write_section</span></span>
<span class="line"><span>                                        â†“</span></span>
<span class="line"><span>                                       END</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><hr><h3 id="ç¬¬å››éƒ¨åˆ†-ä¸»å›¾-map-reduce-æ¨¡å¼" tabindex="-1">ç¬¬å››éƒ¨åˆ†ï¼šä¸»å›¾ - Map-Reduce æ¨¡å¼ <a class="header-anchor" href="#ç¬¬å››éƒ¨åˆ†-ä¸»å›¾-map-reduce-æ¨¡å¼" aria-label="Permalink to &quot;ç¬¬å››éƒ¨åˆ†ï¼šä¸»å›¾ - Map-Reduce æ¨¡å¼&quot;">â€‹</a></h3><h4 id="ä¸»çŠ¶æ€" tabindex="-1">ä¸»çŠ¶æ€ <a class="header-anchor" href="#ä¸»çŠ¶æ€" aria-label="Permalink to &quot;ä¸»çŠ¶æ€&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ResearchGraphState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    topic: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    max_analysts: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    human_analyst_feedback: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    analysts: List[Analyst]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sections: Annotated[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, operator.add]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç´¯ç§¯æ‰€æœ‰ç« èŠ‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    introduction: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conclusion: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    final_report: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><hr><h4 id="initiate-all-interviews-map-æ­¥éª¤" tabindex="-1">initiate_all_interviews - Map æ­¥éª¤ <a class="header-anchor" href="#initiate-all-interviews-map-æ­¥éª¤" aria-label="Permalink to &quot;initiate_all_interviews - Map æ­¥éª¤&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> initiate_all_interviews</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: ResearchGraphState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    human_analyst_feedback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;human_analyst_feedback&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> human_analyst_feedback:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;create_analysts&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # è¿”å›ä¿®æ”¹åˆ†æå¸ˆ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å…³é”®ï¼šä½¿ç”¨ Send() API å¹¶è¡Œå¯åŠ¨å¤šä¸ªå­å›¾</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        topic </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;topic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;conduct_interview&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;analyst&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: analyst,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [HumanMessage(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                    content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;So you said you were writing an article on </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">topic</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                )]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            })</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> analyst </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;analysts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>Send() API çš„é­”åŠ›</strong>ï¼š</p><ul><li>ä¸ºæ¯ä¸ªåˆ†æå¸ˆåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„è®¿è°ˆå­å›¾å®ä¾‹</li><li>æ‰€æœ‰è®¿è°ˆ<strong>å¹¶è¡Œæ‰§è¡Œ</strong></li><li>æ¯ä¸ªå­å›¾çš„ <code>sections</code> è¾“å‡ºä¼šè‡ªåŠ¨åˆå¹¶åˆ°ä¸»çŠ¶æ€</li></ul><p><strong>ç±»æ¯”</strong>ï¼š</p><ul><li>å°±åƒä¸€ä¸ªç»ç†åŒæ—¶æ´¾é£å¤šä¸ªå‘˜å·¥å»ä¸åŒåœ°ç‚¹è°ƒç ”</li><li>æ¯ä¸ªå‘˜å·¥ç‹¬ç«‹å·¥ä½œï¼Œæœ€åæ±‡æŠ¥ç»“æœ</li><li>ç»ç†æ•´åˆæ‰€æœ‰æŠ¥å‘Š</li></ul><hr><h4 id="reduce-æ­¥éª¤" tabindex="-1">Reduce æ­¥éª¤ <a class="header-anchor" href="#reduce-æ­¥éª¤" aria-label="Permalink to &quot;Reduce æ­¥éª¤&quot;">â€‹</a></h4><p><strong>1. write_report - æ•´åˆç« èŠ‚</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> write_report</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: ResearchGraphState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sections </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sections&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åŒ…å«æ‰€æœ‰åˆ†æå¸ˆçš„ç« èŠ‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    topic </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;topic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å°†æ‰€æœ‰ç« èŠ‚åˆå¹¶æˆä¸€ä¸ªå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    formatted_str_sections </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.join([</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">section</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> section </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sections])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # LLM æ•´åˆæˆè¿è´¯çš„æŠ¥å‘Šä¸»ä½“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    system_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> report_writer_instructions.format(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        topic</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">topic,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">formatted_str_sections</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    report </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.invoke([</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        SystemMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">system_message),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Write a report based upon these memos.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: report.content}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><hr><p><strong>2. write_introduction / write_conclusion</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> write_introduction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: ResearchGraphState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sections </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sections&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    formatted_str_sections </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.join([</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">section</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> section </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sections])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    instructions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> intro_conclusion_instructions.format(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        topic</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">topic,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        formatted_str_sections</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">formatted_str_sections</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    intro </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.invoke([instructions, HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Write the report introduction&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;introduction&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: intro.content}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><hr><p><strong>3. finalize_report - ç»„è£…æœ€ç»ˆæŠ¥å‘Š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> finalize_report</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: ResearchGraphState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ¸…ç†å’Œåˆ†ç¦»æ¥æºéƒ¨åˆ†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content.startswith(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;## Insights&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content.strip(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;## Insights&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;## Sources&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        content, sources </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content.split(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">## Sources</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ç»„è£…å®Œæ•´æŠ¥å‘Š</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    final_report </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;introduction&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">---</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">---</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;conclusion&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sources:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        final_report </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">## Sources</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sources</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;final_report&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: final_report}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><hr><h4 id="ä¸»å›¾æ„å»º" tabindex="-1">ä¸»å›¾æ„å»º <a class="header-anchor" href="#ä¸»å›¾æ„å»º" aria-label="Permalink to &quot;ä¸»å›¾æ„å»º&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StateGraph(ResearchGraphState)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¬¬ä¸€é˜¶æ®µï¼šç”Ÿæˆåˆ†æå¸ˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;create_analysts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, create_analysts)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;human_feedback&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, human_feedback)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¬¬äºŒé˜¶æ®µï¼šæ‰§è¡Œè®¿è°ˆï¼ˆå­å›¾ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;conduct_interview&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, interview_builder.compile())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¬¬ä¸‰é˜¶æ®µï¼šç”ŸæˆæŠ¥å‘Š</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;write_report&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, write_report)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;write_introduction&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, write_introduction)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;write_conclusion&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, write_conclusion)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;finalize_report&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, finalize_report)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æµç¨‹æ§åˆ¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">START</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;create_analysts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;create_analysts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;human_feedback&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_conditional_edges(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;human_feedback&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, initiate_all_interviews,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;create_analysts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;conduct_interview&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å…³é”®ï¼šå¹¶è¡Œç”Ÿæˆä»‹ç»ã€ç»“è®ºå’Œä¸»ä½“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;conduct_interview&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;write_report&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;conduct_interview&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;write_introduction&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;conduct_interview&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;write_conclusion&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ±‡æ€»</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;write_conclusion&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;write_report&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;write_introduction&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &quot;finalize_report&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;finalize_report&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¼–è¯‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder.compile(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    interrupt_before</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;human_feedback&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    checkpointer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">memory</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><hr><h2 id="ğŸ”‘-æ ¸å¿ƒæŠ€æœ¯è§£æ" tabindex="-1">ğŸ”‘ æ ¸å¿ƒæŠ€æœ¯è§£æ <a class="header-anchor" href="#ğŸ”‘-æ ¸å¿ƒæŠ€æœ¯è§£æ" aria-label="Permalink to &quot;ğŸ”‘ æ ¸å¿ƒæŠ€æœ¯è§£æ&quot;">â€‹</a></h2><h3 id="_1-äººæœºåä½œ-human-in-the-loop" tabindex="-1">1. äººæœºåä½œï¼ˆHuman-in-the-Loopï¼‰ <a class="header-anchor" href="#_1-äººæœºåä½œ-human-in-the-loop" aria-label="Permalink to &quot;1. äººæœºåä½œï¼ˆHuman-in-the-Loopï¼‰&quot;">â€‹</a></h3><p><strong>å®ç°æ–¹å¼</strong>ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder.compile(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">interrupt_before</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;human_feedback&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">checkpointer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">memory)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>å·¥ä½œæµç¨‹</strong>ï¼š</p><ol><li>å›¾æ‰§è¡Œåˆ° <code>human_feedback</code> å‰æš‚åœ</li><li>ç”¨æˆ·é€šè¿‡ <code>graph.update_state()</code> ä¿®æ”¹çŠ¶æ€</li><li>ç»§ç»­æ‰§è¡Œ <code>graph.stream(None, thread)</code></li></ol><p><strong>å®é™…åº”ç”¨</strong>ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¬¬ä¸€æ¬¡è¿è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.stream(initial_input, thread):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pass</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # åœ¨ human_feedback å‰åœæ­¢</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç”¨æˆ·å®¡æ ¸å¹¶åé¦ˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph.update_state(thread, {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;human_analyst_feedback&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Add a startup CEO&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">as_node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;human_feedback&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç»§ç»­è¿è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> event </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.stream(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, thread):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pass</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # é‡æ–°ç”Ÿæˆåˆ†æå¸ˆ</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><hr><h3 id="_2-send-api-åŠ¨æ€å¹¶è¡Œ" tabindex="-1">2. Send() API - åŠ¨æ€å¹¶è¡Œ <a class="header-anchor" href="#_2-send-api-åŠ¨æ€å¹¶è¡Œ" aria-label="Permalink to &quot;2. Send() API - åŠ¨æ€å¹¶è¡Œ&quot;">â€‹</a></h3><p><strong>ä¼ ç»Ÿæ–¹å¼ vs Send()</strong>ï¼š</p><p>ä¼ ç»Ÿæ–¹å¼ï¼ˆé™æ€ï¼‰ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node_a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node_b&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node_a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node_c&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¿…é¡»é¢„å…ˆçŸ¥é“æœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Send() æ–¹å¼ï¼ˆåŠ¨æ€ï¼‰ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> dynamic_dispatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Send(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;subgraph&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;input&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;items&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ•°é‡åœ¨è¿è¡Œæ—¶ç¡®å®š</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_conditional_edges(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dispatcher&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, dynamic_dispatch)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>æœ¬æ¡ˆä¾‹åº”ç”¨</strong>ï¼š</p><ul><li>åˆ†æå¸ˆæ•°é‡ç”±ç”¨æˆ·è¾“å…¥å’Œ LLM å†³å®š</li><li>æ¯ä¸ªåˆ†æå¸ˆå¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„è®¿è°ˆå­å›¾å®ä¾‹</li><li>æ‰€æœ‰è®¿è°ˆåŒæ—¶è¿è¡Œï¼Œå¤§å¹…æé«˜æ•ˆç‡</li></ul><hr><h3 id="_3-å­å›¾-subgraph" tabindex="-1">3. å­å›¾ï¼ˆSubgraphï¼‰ <a class="header-anchor" href="#_3-å­å›¾-subgraph" aria-label="Permalink to &quot;3. å­å›¾ï¼ˆSubgraphï¼‰&quot;">â€‹</a></h3><p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨å­å›¾ï¼Ÿ</strong></p><ul><li>å°è£…å¤æ‚é€»è¾‘ï¼ˆè®¿è°ˆæµç¨‹ï¼‰</li><li>å¯å¤ç”¨ï¼ˆæ¯ä¸ªåˆ†æå¸ˆå¤ç”¨ç›¸åŒæµç¨‹ï¼‰</li><li>çŠ¶æ€éš”ç¦»ï¼ˆæ¯ä¸ªè®¿è°ˆæœ‰ç‹¬ç«‹çš„æ¶ˆæ¯å†å²ï¼‰</li></ul><p><strong>é›†æˆæ–¹å¼</strong>ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å­å›¾</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">interview_graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> interview_builder.compile()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åµŒå…¥ä¸»å›¾</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;conduct_interview&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, interview_graph)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>çŠ¶æ€ä¼ é€’</strong>ï¼š</p><ul><li>ä¸»å›¾é€šè¿‡ <code>Send()</code> ä¼ é€’åˆå§‹çŠ¶æ€ç»™å­å›¾</li><li>å­å›¾çš„ <code>sections</code> è¾“å‡ºè‡ªåŠ¨åˆå¹¶åˆ°ä¸»å›¾çŠ¶æ€</li></ul><hr><h3 id="_4-ç»“æ„åŒ–è¾“å‡º" tabindex="-1">4. ç»“æ„åŒ–è¾“å‡º <a class="header-anchor" href="#_4-ç»“æ„åŒ–è¾“å‡º" aria-label="Permalink to &quot;4. ç»“æ„åŒ–è¾“å‡º&quot;">â€‹</a></h3><p><strong>Pydantic æ¨¡å‹ + with_structured_output()</strong>ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Analyst</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    role: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ... å…¶ä»–å­—æ®µ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">structured_llm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.with_structured_output(Perspectives)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> structured_llm.invoke(messages)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è‡ªåŠ¨éªŒè¯å’Œè§£æ</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ul><li>ä¿è¯æ•°æ®æ ¼å¼ä¸€è‡´</li><li>è‡ªåŠ¨ç±»å‹æ£€æŸ¥</li><li>æ˜“äºåç»­å¤„ç†</li></ul><hr><h3 id="_5-æ£€æŸ¥ç‚¹-checkpointer" tabindex="-1">5. æ£€æŸ¥ç‚¹ï¼ˆCheckpointerï¼‰ <a class="header-anchor" href="#_5-æ£€æŸ¥ç‚¹-checkpointer" aria-label="Permalink to &quot;5. æ£€æŸ¥ç‚¹ï¼ˆCheckpointerï¼‰&quot;">â€‹</a></h3><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li>ä¿å­˜æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œåçš„çŠ¶æ€</li><li>æ”¯æŒä¸­æ–­å’Œæ¢å¤</li><li>å®ç°æ—¶é—´æ—…è¡Œè°ƒè¯•</li></ul><p><strong>ä½¿ç”¨æ–¹å¼</strong>ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">memory </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MemorySaver()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder.compile(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">checkpointer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">memory)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨ thread_id æ ‡è¯†ä¼šè¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">thread </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;configurable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;thread_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph.stream(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">input</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, thread)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŸ¥çœ‹å½“å‰çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.get_state(thread)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¢å¤æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph.stream(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, thread)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><hr><h2 id="ğŸ’¡-æœ€ä½³å®è·µå’ŒæŠ€å·§" tabindex="-1">ğŸ’¡ æœ€ä½³å®è·µå’ŒæŠ€å·§ <a class="header-anchor" href="#ğŸ’¡-æœ€ä½³å®è·µå’ŒæŠ€å·§" aria-label="Permalink to &quot;ğŸ’¡ æœ€ä½³å®è·µå’ŒæŠ€å·§&quot;">â€‹</a></h2><h3 id="_1-æ§åˆ¶-llm-è¾“å‡ºæ ¼å¼" tabindex="-1">1. æ§åˆ¶ LLM è¾“å‡ºæ ¼å¼ <a class="header-anchor" href="#_1-æ§åˆ¶-llm-è¾“å‡ºæ ¼å¼" aria-label="Permalink to &quot;1. æ§åˆ¶ LLM è¾“å‡ºæ ¼å¼&quot;">â€‹</a></h3><p><strong>é—®é¢˜</strong>ï¼šLLM è¾“å‡ºæ ¼å¼ä¸ç¨³å®š</p><p><strong>è§£å†³</strong>ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®šä¹‰ä¸¥æ ¼çš„ Pydantic æ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Output</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    field1: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Field(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;è¯¦ç»†æè¿°&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    field2: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¼ºåˆ¶ç»“æ„åŒ–è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">structured_llm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.with_structured_output(Output)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> structured_llm.invoke(prompt)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä¿è¯ç¬¦åˆ Output æ ¼å¼</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><hr><h3 id="_2-å¾ªç¯æ§åˆ¶" tabindex="-1">2. å¾ªç¯æ§åˆ¶ <a class="header-anchor" href="#_2-å¾ªç¯æ§åˆ¶" aria-label="Permalink to &quot;2. å¾ªç¯æ§åˆ¶&quot;">â€‹</a></h3><p><strong>é—®é¢˜</strong>ï¼šå¯¹è¯å¯èƒ½æ— é™å¾ªç¯</p><p><strong>è§£å†³</strong>ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> route_messages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    max_turns </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;max_num_turns&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    current_turns </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> count_turns(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;messages&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> current_turns </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> max_turns:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;end_node&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> detect_end_signal(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;messages&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;end_node&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;continue_node&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><hr><h3 id="_3-å¹¶è¡ŒèŠ‚ç‚¹çš„ç»“æœåˆå¹¶" tabindex="-1">3. å¹¶è¡ŒèŠ‚ç‚¹çš„ç»“æœåˆå¹¶ <a class="header-anchor" href="#_3-å¹¶è¡ŒèŠ‚ç‚¹çš„ç»“æœåˆå¹¶" aria-label="Permalink to &quot;3. å¹¶è¡ŒèŠ‚ç‚¹çš„ç»“æœåˆå¹¶&quot;">â€‹</a></h3><p><strong>ä½¿ç”¨ Annotated</strong>ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> typing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Annotated</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> operator</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> State</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    results: Annotated[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, operator.add]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è‡ªåŠ¨è¿½åŠ </span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>æ•ˆæœ</strong>ï¼š</p><ul><li>èŠ‚ç‚¹ A è¿”å› <code>{&quot;results&quot;: [1, 2]}</code></li><li>èŠ‚ç‚¹ B è¿”å› <code>{&quot;results&quot;: [3, 4]}</code></li><li>æœ€ç»ˆçŠ¶æ€ï¼š<code>{&quot;results&quot;: [1, 2, 3, 4]}</code></li></ul><hr><h3 id="_4-æç¤ºè¯å·¥ç¨‹" tabindex="-1">4. æç¤ºè¯å·¥ç¨‹ <a class="header-anchor" href="#_4-æç¤ºè¯å·¥ç¨‹" aria-label="Permalink to &quot;4. æç¤ºè¯å·¥ç¨‹&quot;">â€‹</a></h3><p><strong>åˆ†å±‚æç¤º</strong>ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç³»ç»Ÿçº§æŒ‡ä»¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">system_prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;&quot;You are an expert. Follow these rules:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1. Rule 1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">2. Rule 2</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è§’è‰²çº§æŒ‡ä»¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">role_prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Your role: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">analyst.persona</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä»»åŠ¡çº§æŒ‡ä»¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">task_prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Answer this question: ...&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç»„åˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">llm.invoke([</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SystemMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">system_prompt),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SystemMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">role_prompt),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">task_prompt)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><hr><h2 id="ğŸ¯-å®æˆ˜å»ºè®®" tabindex="-1">ğŸ¯ å®æˆ˜å»ºè®® <a class="header-anchor" href="#ğŸ¯-å®æˆ˜å»ºè®®" aria-label="Permalink to &quot;ğŸ¯ å®æˆ˜å»ºè®®&quot;">â€‹</a></h2><h3 id="å¯¹äºåˆå­¦è€…" tabindex="-1">å¯¹äºåˆå­¦è€… <a class="header-anchor" href="#å¯¹äºåˆå­¦è€…" aria-label="Permalink to &quot;å¯¹äºåˆå­¦è€…&quot;">â€‹</a></h3><ol><li><p><strong>å…ˆç†è§£å•ä¸ªèŠ‚ç‚¹</strong></p><ul><li>ä» <code>create_analysts</code> å¼€å§‹</li><li>å•ç‹¬æµ‹è¯•æ¯ä¸ªå‡½æ•°</li></ul></li><li><p><strong>é€æ­¥æ„å»ºå›¾</strong></p><ul><li>å…ˆæ„å»ºæœ€ç®€å•çš„çº¿æ€§å›¾</li><li>å†æ·»åŠ æ¡ä»¶è¾¹å’Œå¾ªç¯</li></ul></li><li><p><strong>å–„ç”¨å¯è§†åŒ–</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph.get_graph().draw_mermaid_png()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p><strong>ä½¿ç”¨ LangSmith è°ƒè¯•</strong></p><ul><li>æŸ¥çœ‹æ¯ä¸ªèŠ‚ç‚¹çš„è¾“å…¥è¾“å‡º</li><li>è¿½è¸ª LLM è°ƒç”¨</li></ul></li></ol><hr><h3 id="å¯¹äºè¿›é˜¶ä½¿ç”¨" tabindex="-1">å¯¹äºè¿›é˜¶ä½¿ç”¨ <a class="header-anchor" href="#å¯¹äºè¿›é˜¶ä½¿ç”¨" aria-label="Permalink to &quot;å¯¹äºè¿›é˜¶ä½¿ç”¨&quot;">â€‹</a></h3><ol><li><p><strong>ä¼˜åŒ–å¹¶è¡Œæ€§</strong></p><ul><li>è¯†åˆ«å¯ä»¥å¹¶è¡Œçš„èŠ‚ç‚¹</li><li>ä½¿ç”¨ <code>Send()</code> åŠ¨æ€åˆ†å‘</li></ul></li><li><p><strong>æˆæœ¬æ§åˆ¶</strong></p><ul><li>ä½¿ç”¨æ›´å°çš„æ¨¡å‹åšè·¯ç”±</li><li>ç¼“å­˜é‡å¤çš„ LLM è°ƒç”¨</li></ul></li><li><p><strong>é”™è¯¯å¤„ç†</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> safe_node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> process(state)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    except</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e)}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p><strong>æ‰©å±•æ£€ç´¢æº</strong></p><ul><li>æ·»åŠ æ›´å¤šæœç´¢å·¥å…·</li><li>é›†æˆæœ¬åœ°æ–‡æ¡£åº“</li></ul></li></ol><hr><h2 id="ğŸ“Œ-æ€»ç»“" tabindex="-1">ğŸ“Œ æ€»ç»“ <a class="header-anchor" href="#ğŸ“Œ-æ€»ç»“" aria-label="Permalink to &quot;ğŸ“Œ æ€»ç»“&quot;">â€‹</a></h2><p>è¿™ä¸ªæ¡ˆä¾‹æ˜¯ LangGraph çš„ä¸€ä¸ªç»¼åˆç¤ºèŒƒï¼Œå±•ç¤ºäº†ï¼š</p><h3 id="æ¶æ„è®¾è®¡" tabindex="-1">æ¶æ„è®¾è®¡ <a class="header-anchor" href="#æ¶æ„è®¾è®¡" aria-label="Permalink to &quot;æ¶æ„è®¾è®¡&quot;">â€‹</a></h3><ul><li><strong>åˆ†å±‚ç»“æ„</strong>ï¼šä¸»å›¾ + å­å›¾</li><li><strong>æ¸…æ™°èŒè´£</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹åªåšä¸€ä»¶äº‹</li><li><strong>çµæ´»æ§åˆ¶</strong>ï¼šæ¡ä»¶è·¯ç”± + å¾ªç¯æ£€æµ‹</li></ul><h3 id="æŠ€æœ¯è¦ç‚¹" tabindex="-1">æŠ€æœ¯è¦ç‚¹ <a class="header-anchor" href="#æŠ€æœ¯è¦ç‚¹" aria-label="Permalink to &quot;æŠ€æœ¯è¦ç‚¹&quot;">â€‹</a></h3><ul><li><strong>ç»“æ„åŒ–è¾“å‡º</strong>ï¼šç¡®ä¿æ•°æ®è´¨é‡</li><li><strong>äººæœºåä½œ</strong>ï¼šå…³é”®å†³ç­–ç‚¹äººå·¥ä»‹å…¥</li><li><strong>å¹¶è¡Œæ‰§è¡Œ</strong>ï¼šæé«˜ç³»ç»Ÿæ•ˆç‡</li><li><strong>æ£€æŸ¥ç‚¹æœºåˆ¶</strong>ï¼šæ”¯æŒä¸­æ–­æ¢å¤</li></ul><h3 id="åº”ç”¨ä»·å€¼" tabindex="-1">åº”ç”¨ä»·å€¼ <a class="header-anchor" href="#åº”ç”¨ä»·å€¼" aria-label="Permalink to &quot;åº”ç”¨ä»·å€¼&quot;">â€‹</a></h3><ul><li><strong>å¯å®šåˆ¶</strong>ï¼šè½»æ¾è°ƒæ•´åˆ†æå¸ˆç±»å‹ã€æœç´¢æºã€æŠ¥å‘Šæ ¼å¼</li><li><strong>å¯æ‰©å±•</strong>ï¼šæ·»åŠ æ–°çš„èŠ‚ç‚¹å’ŒåŠŸèƒ½</li><li><strong>ç”Ÿäº§çº§</strong>ï¼šå®Œæ•´çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç®¡ç†</li></ul><hr><h2 id="ğŸš€-åç»­å­¦ä¹ å»ºè®®" tabindex="-1">ğŸš€ åç»­å­¦ä¹ å»ºè®® <a class="header-anchor" href="#ğŸš€-åç»­å­¦ä¹ å»ºè®®" aria-label="Permalink to &quot;ğŸš€ åç»­å­¦ä¹ å»ºè®®&quot;">â€‹</a></h2><ol><li><p><strong>ä¿®æ”¹æ¡ˆä¾‹</strong></p><ul><li>æ”¹å˜ç ”ç©¶ä¸»é¢˜</li><li>è°ƒæ•´åˆ†æå¸ˆæ•°é‡å’Œç±»å‹</li><li>ä½¿ç”¨ä¸åŒçš„ LLM æ¨¡å‹</li></ul></li><li><p><strong>æ‰©å±•åŠŸèƒ½</strong></p><ul><li>æ·»åŠ å›¾è¡¨ç”Ÿæˆ</li><li>é›†æˆæ›´å¤šæ•°æ®æº</li><li>å®ç°å¤šè¯­è¨€æ”¯æŒ</li></ul></li><li><p><strong>ä¼˜åŒ–æ€§èƒ½</strong></p><ul><li>å®ç°ç»“æœç¼“å­˜</li><li>ä½¿ç”¨æµå¼è¾“å‡º</li><li>æ·»åŠ é€Ÿç‡é™åˆ¶</li></ul></li><li><p><strong>æ·±å…¥åŸç†</strong></p><ul><li>ç ”ç©¶ LangGraph çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶</li><li>ç†è§£çŠ¶æ€æ›´æ–°çš„åŸå­æ€§</li><li>å­¦ä¹ é«˜çº§è·¯ç”±ç­–ç•¥</li></ul></li></ol><hr><h2 id="ğŸ¤-æ·±å…¥ç†è§£-interview-å­å›¾åœ¨ç³»ç»Ÿä¸­çš„æ ¸å¿ƒä½œç”¨" tabindex="-1">ğŸ¤ æ·±å…¥ç†è§£ï¼šInterview å­å›¾åœ¨ç³»ç»Ÿä¸­çš„æ ¸å¿ƒä½œç”¨ <a class="header-anchor" href="#ğŸ¤-æ·±å…¥ç†è§£-interview-å­å›¾åœ¨ç³»ç»Ÿä¸­çš„æ ¸å¿ƒä½œç”¨" aria-label="Permalink to &quot;ğŸ¤ æ·±å…¥ç†è§£ï¼šInterview å­å›¾åœ¨ç³»ç»Ÿä¸­çš„æ ¸å¿ƒä½œç”¨&quot;">â€‹</a></h2><p><strong>Interview å­å›¾</strong>æ˜¯æ•´ä¸ªç ”ç©¶åŠ©æ‰‹ç³»ç»Ÿçš„&quot;å¿ƒè„&quot;ï¼Œå®ƒæ‰¿æ‹…ç€æœ€å…³é”®çš„çŸ¥è¯†è·å–ä»»åŠ¡ã€‚ä»ç³»ç»Ÿæ¶æ„çš„è§’åº¦çœ‹ï¼Œå®ƒæ‰®æ¼”ç€ä¸‰é‡è§’è‰²ï¼š</p><p>é¦–å…ˆï¼Œå®ƒæ˜¯<strong>çŸ¥è¯†ç”Ÿäº§çš„å¼•æ“</strong>ã€‚é€šè¿‡æ¨¡æ‹Ÿ&quot;åˆ†æå¸ˆ-ä¸“å®¶&quot;çš„å¯¹è¯æ¨¡å¼ï¼ŒInterview å­å›¾å°†æŠ½è±¡çš„ç ”ç©¶ä¸»é¢˜è½¬åŒ–ä¸ºå…·ä½“çš„ã€æœ‰æ·±åº¦çš„çŸ¥è¯†å†…å®¹ã€‚è¿™ç§å¤šè½®å¯¹è¯æœºåˆ¶ï¼ˆask_question â†’ search â†’ answer â†’ ask_questionï¼‰å®ç°äº†æ¸è¿›å¼çš„çŸ¥è¯†æŒ–æ˜ï¼Œæ¯ä¸€è½®å¯¹è¯éƒ½åœ¨å‰ä¸€è½®çš„åŸºç¡€ä¸Šæ·±å…¥ï¼Œæœ€ç»ˆå½¢æˆæœ‰ä»·å€¼çš„ç ”ç©¶ç« èŠ‚ã€‚</p><p>å…¶æ¬¡ï¼Œå®ƒæ˜¯<strong>å¹¶è¡ŒåŒ–æ¶æ„çš„åŸºæœ¬å•å…ƒ</strong>ã€‚é€šè¿‡ <code>Send()</code> APIï¼Œç³»ç»Ÿå¯ä»¥åŒæ—¶å¯åŠ¨å¤šä¸ª Interview å®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹ç‹¬ç«‹è¿è¡Œï¼Œäº’ä¸å¹²æ‰°ã€‚è¿™ç§è®¾è®¡ä½¿å¾— 3 ä¸ªåˆ†æå¸ˆçš„è®¿è°ˆå¯ä»¥åœ¨ç›¸åŒæ—¶é—´å†…å®Œæˆï¼Œè€Œä¸æ˜¯ä¸²è¡Œæ‰§è¡Œã€‚å­å›¾çš„çŠ¶æ€éš”ç¦»ç‰¹æ€§ç¡®ä¿äº†æ¯ä¸ªåˆ†æå¸ˆéƒ½æœ‰ç‹¬ç«‹çš„å¯¹è¯å†å²å’Œä¸Šä¸‹æ–‡ï¼Œé¿å…äº†ä¿¡æ¯æ··æ·†ã€‚</p><p>æœ€åï¼Œå®ƒæ˜¯<strong>Map-Reduce æ¨¡å¼çš„ Map é˜¶æ®µå®ç°</strong>ã€‚æ¯ä¸ª Interview å­å›¾æ¥æ”¶ä¸€ä¸ªåˆ†æå¸ˆä½œä¸ºè¾“å…¥ï¼Œè¾“å‡ºä¸€ä¸ªç»“æ„åŒ–çš„ç ”ç©¶ç« èŠ‚ï¼ˆsectionï¼‰ã€‚è¿™äº›ç« èŠ‚é€šè¿‡ <code>Annotated[list, operator.add]</code> è‡ªåŠ¨èšåˆåˆ°ä¸»å›¾çŠ¶æ€ä¸­ï¼Œä¸ºåç»­çš„ Reduce é˜¶æ®µï¼ˆwrite_reportã€write_introductionã€write_conclusionï¼‰æä¾›åŸææ–™ã€‚è¿™ç§æ¸…æ™°çš„è¾“å…¥è¾“å‡ºæ¥å£ä½¿å¾—å­å›¾å¯ä»¥æ— ç¼é›†æˆåˆ°æ›´å¤§çš„ç³»ç»Ÿä¸­ã€‚</p><p>ä»æŠ€æœ¯å®ç°ä¸Šçœ‹ï¼ŒInterview å­å›¾è¿˜å±•ç¤ºäº† LangGraph çš„å‡ ä¸ªé‡è¦æ¨¡å¼ï¼š<strong>RAG æ£€ç´¢å¢å¼º</strong>ï¼ˆé€šè¿‡ search_web å’Œ search_wikipedia ä¸ºå›ç­”æä¾›äº‹å®ä¾æ®ï¼‰ã€<strong>å¾ªç¯æ§åˆ¶</strong>ï¼ˆé€šè¿‡ route_messages é˜²æ­¢æ— é™å¯¹è¯ï¼‰ã€<strong>æ¶ˆæ¯è§’è‰²ç®¡ç†</strong>ï¼ˆåŒºåˆ† analyst å’Œ expert çš„å‘è¨€ï¼‰ã€‚è¿™äº›æ¨¡å¼çš„ç»„åˆä½¿å¾— Interview ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„é—®ç­”æµç¨‹ï¼Œè€Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„ã€å¯æ§çš„ã€é«˜è´¨é‡çš„çŸ¥è¯†ç”Ÿäº§æµæ°´çº¿ã€‚</p><hr><p><strong>æœ€åçš„è¯</strong>ï¼šLangGraph çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒè®©ä½ åƒæ­ç§¯æœ¨ä¸€æ ·æ„å»ºå¤æ‚çš„ AI ç³»ç»Ÿã€‚è¿™ä¸ªç ”ç©¶åŠ©æ‰‹æ¡ˆä¾‹è™½ç„¶å¤æ‚ï¼Œä½†æ¯ä¸ªç»„ä»¶éƒ½å¾ˆç®€å•ã€‚æŒæ¡äº†è¿™äº›åŸºç¡€æ„å»ºå—ï¼Œä½ å°±å¯ä»¥åˆ›é€ å‡ºæ— é™å¯èƒ½çš„åº”ç”¨ï¼</p>`,190)])])}const g=i(p,[["render",e]]);export{c as __pageData,g as default};
