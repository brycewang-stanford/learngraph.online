import{_ as a,c as n,o as i,ag as l}from"./chunks/framework.Cf3FQAeg.js";const c=JSON.parse('{"title":"LangGraph Agent è¯¦ç»†è§£è¯»","description":"","frontmatter":{},"headers":[],"relativePath":"module-1/1.4-agent-è¯¦ç»†è§£è¯».md","filePath":"module-1/1.4-agent-è¯¦ç»†è§£è¯».md","lastUpdated":1760223716000}'),p={name:"module-1/1.4-agent-è¯¦ç»†è§£è¯».md"};function e(t,s,h,r,k,d){return i(),n("div",null,[...s[0]||(s[0]=[l(`<h1 id="langgraph-agent-è¯¦ç»†è§£è¯»" tabindex="-1">LangGraph Agent è¯¦ç»†è§£è¯» <a class="header-anchor" href="#langgraph-agent-è¯¦ç»†è§£è¯»" aria-label="Permalink to &quot;LangGraph Agent è¯¦ç»†è§£è¯»&quot;">â€‹</a></h1><h2 id="ğŸ“š-æ¦‚è¿°" tabindex="-1">ğŸ“š æ¦‚è¿° <a class="header-anchor" href="#ğŸ“š-æ¦‚è¿°" aria-label="Permalink to &quot;ğŸ“š æ¦‚è¿°&quot;">â€‹</a></h2><p>æœ¬æ–‡æ¡£è¯¦ç»†è§£è¯» LangGraph ä¸­çš„ <strong>Agentï¼ˆæ™ºèƒ½ä½“ï¼‰</strong> æ¶æ„ã€‚è¿™æ˜¯æ„å»ºæ™ºèƒ½ AI åº”ç”¨çš„æ ¸å¿ƒæ¨¡å¼ï¼Œé€šè¿‡è®© AI æ¨¡å‹è‡ªä¸»å†³ç­–ã€è°ƒç”¨å·¥å…·ã€å¹¶åŸºäºç»“æœç»§ç»­æ¨ç†ï¼Œå®ç°å¤æ‚ä»»åŠ¡çš„è‡ªåŠ¨åŒ–å¤„ç†ã€‚</p><h2 id="ğŸ¯-æ ¸å¿ƒæ¦‚å¿µ" tabindex="-1">ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ <a class="header-anchor" href="#ğŸ¯-æ ¸å¿ƒæ¦‚å¿µ" aria-label="Permalink to &quot;ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ&quot;">â€‹</a></h2><h3 id="ä»€ä¹ˆæ˜¯-agent" tabindex="-1">ä»€ä¹ˆæ˜¯ Agentï¼Ÿ <a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-agent" aria-label="Permalink to &quot;ä»€ä¹ˆæ˜¯ Agentï¼Ÿ&quot;">â€‹</a></h3><p>Agentï¼ˆæ™ºèƒ½ä½“ï¼‰æ˜¯ä¸€ç§èƒ½å¤Ÿè‡ªä¸»å†³ç­–å’Œè¡ŒåŠ¨çš„ AI ç³»ç»Ÿã€‚åœ¨ LangGraph ä¸­ï¼ŒAgent å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li><p><strong>è‡ªä¸»å†³ç­–</strong></p><ul><li>AI æ¨¡å‹è‡ªå·±å†³å®šæ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·</li><li>æ ¹æ®å·¥å…·è¿”å›çš„ç»“æœå†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨</li><li>å¯ä»¥è¿ç»­è°ƒç”¨å¤šä¸ªå·¥å…·å®Œæˆå¤æ‚ä»»åŠ¡</li></ul></li><li><p><strong>å·¥å…·è°ƒç”¨</strong></p><ul><li>è°ƒç”¨å¤–éƒ¨å‡½æ•°è·å–ä¿¡æ¯æˆ–æ‰§è¡Œæ“ä½œ</li><li>å°†å·¥å…·ç»“æœä¼ å›æ¨¡å‹ç»§ç»­å¤„ç†</li><li>æ”¯æŒå¤šè½®å·¥å…·è°ƒç”¨</li></ul></li><li><p><strong>å¾ªç¯æ¨ç†</strong></p><ul><li>æ¨¡å‹å¯ä»¥åŸºäºå·¥å…·ç»“æœç»§ç»­æ€è€ƒ</li><li>å†³å®šæ˜¯ç»§ç»­è°ƒç”¨å·¥å…·è¿˜æ˜¯ç›´æ¥å›ç­”</li><li>å½¢æˆ &quot;æ€è€ƒ-è¡ŒåŠ¨-è§‚å¯Ÿ&quot; çš„å¾ªç¯</li></ul></li></ol><h3 id="react-æ¶æ„" tabindex="-1">ReAct æ¶æ„ <a class="header-anchor" href="#react-æ¶æ„" aria-label="Permalink to &quot;ReAct æ¶æ„&quot;">â€‹</a></h3><p>ReActï¼ˆReasoning + Actingï¼‰æ˜¯ä¸€ç§ç»å…¸çš„ Agent æ¶æ„æ¨¡å¼ï¼š</p><ul><li><strong>Reasonï¼ˆæ¨ç†ï¼‰</strong>ï¼šæ¨¡å‹åˆ†æé—®é¢˜ï¼Œå†³å®šéœ€è¦è°ƒç”¨ä»€ä¹ˆå·¥å…·</li><li><strong>Actï¼ˆè¡ŒåŠ¨ï¼‰</strong>ï¼šè°ƒç”¨é€‰å®šçš„å·¥å…·</li><li><strong>Observeï¼ˆè§‚å¯Ÿï¼‰</strong>ï¼šè·å–å·¥å…·è¿”å›ç»“æœ</li><li><strong>å¾ªç¯</strong>ï¼šåŸºäºè§‚å¯Ÿç»“æœï¼Œå†³å®šç»§ç»­è¡ŒåŠ¨è¿˜æ˜¯ç»™å‡ºæœ€ç»ˆç­”æ¡ˆ</li></ul><h3 id="ä¸-router-çš„åŒºåˆ«" tabindex="-1">ä¸ Router çš„åŒºåˆ« <a class="header-anchor" href="#ä¸-router-çš„åŒºåˆ«" aria-label="Permalink to &quot;ä¸ Router çš„åŒºåˆ«&quot;">â€‹</a></h3><p>åœ¨ä¹‹å‰çš„ Router æ¨¡å¼ä¸­ï¼š</p><ul><li>æ¨¡å‹è°ƒç”¨å·¥å…·åï¼Œç›´æ¥è¿”å› <code>ToolMessage</code> ç»™ç”¨æˆ·</li><li>è¿™æ˜¯ä¸€æ¬¡æ€§çš„å·¥å…·è°ƒç”¨ï¼Œæ²¡æœ‰å¾ªç¯</li></ul><p>åœ¨ Agent æ¨¡å¼ä¸­ï¼š</p><ul><li>æ¨¡å‹è°ƒç”¨å·¥å…·åï¼Œ<code>ToolMessage</code> è¢«ä¼ å›æ¨¡å‹</li><li>æ¨¡å‹å¯ä»¥åŸºäºç»“æœå†³å®šï¼š <ul><li>ç»§ç»­è°ƒç”¨å…¶ä»–å·¥å…·</li><li>æˆ–è€…ç›´æ¥å›ç­”ç”¨æˆ·</li></ul></li></ul><p><strong>å…³é”®å·®å¼‚ï¼šå·¥å…·ç»“æœçš„æµå‘</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Router:  ç”¨æˆ· â†’ æ¨¡å‹ â†’ å·¥å…· â†’ ç”¨æˆ·</span></span>
<span class="line"><span>Agent:   ç”¨æˆ· â†’ æ¨¡å‹ â†’ å·¥å…· â†’ æ¨¡å‹ â†’ ... â†’ ç”¨æˆ·</span></span>
<span class="line"><span>                    â†‘____________â†“</span></span>
<span class="line"><span>                      å¾ªç¯åé¦ˆ</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><hr><h2 id="ğŸ­-å®æˆ˜æ¡ˆä¾‹-æ•°å­¦è®¡ç®—-agent" tabindex="-1">ğŸ­ å®æˆ˜æ¡ˆä¾‹ï¼šæ•°å­¦è®¡ç®— Agent <a class="header-anchor" href="#ğŸ­-å®æˆ˜æ¡ˆä¾‹-æ•°å­¦è®¡ç®—-agent" aria-label="Permalink to &quot;ğŸ­ å®æˆ˜æ¡ˆä¾‹ï¼šæ•°å­¦è®¡ç®— Agent&quot;">â€‹</a></h2><p>æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªæ•°å­¦è®¡ç®—åŠ©æ‰‹ï¼Œæ¼”ç¤º Agent çš„å®Œæ•´å·¥ä½œæµç¨‹ã€‚</p><p><strong>éœ€æ±‚ï¼š</strong> ç»™å®šä¸€ä¸ªå¤šæ­¥éª¤æ•°å­¦é—®é¢˜ï¼ŒAgent éœ€è¦ï¼š</p><ol><li>ç†è§£é—®é¢˜éœ€è¦å“ªäº›è®¡ç®—æ­¥éª¤</li><li>ä¾æ¬¡è°ƒç”¨ç›¸åº”çš„å·¥å…·ï¼ˆåŠ æ³•ã€ä¹˜æ³•ã€é™¤æ³•ï¼‰</li><li>åŸºäºæ¯ä¸€æ­¥ç»“æœï¼Œå†³å®šä¸‹ä¸€æ­¥æ“ä½œ</li><li>æœ€ç»ˆç»™å‡ºç­”æ¡ˆ</li></ol><h3 id="ç³»ç»Ÿæ¶æ„å›¾" tabindex="-1">ç³»ç»Ÿæ¶æ„å›¾ <a class="header-anchor" href="#ç³»ç»Ÿæ¶æ„å›¾" aria-label="Permalink to &quot;ç³»ç»Ÿæ¶æ„å›¾&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç”¨æˆ·è¾“å…¥: &quot;Add 3 and 4. Multiply the output by 2. Divide the output by 5&quot;</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>   [assistant] åˆ†æï¼šéœ€è¦å…ˆåšåŠ æ³•</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>    (tools_condition åˆ¤æ–­ï¼šéœ€è¦è°ƒç”¨å·¥å…·)</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>    [tools] è°ƒç”¨ add(3, 4) â†’ è¿”å› 7</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>   [assistant] æ”¶åˆ°ç»“æœ 7ï¼Œåˆ†æï¼šéœ€è¦ä¹˜ä»¥ 2</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>    (tools_condition åˆ¤æ–­ï¼šéœ€è¦è°ƒç”¨å·¥å…·)</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>    [tools] è°ƒç”¨ multiply(7, 2) â†’ è¿”å› 14</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>   [assistant] æ”¶åˆ°ç»“æœ 14ï¼Œåˆ†æï¼šéœ€è¦é™¤ä»¥ 5</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>    (tools_condition åˆ¤æ–­ï¼šéœ€è¦è°ƒç”¨å·¥å…·)</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>    [tools] è°ƒç”¨ divide(14, 5) â†’ è¿”å› 2.8</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>   [assistant] æ”¶åˆ°ç»“æœ 2.8ï¼Œç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>    (tools_condition åˆ¤æ–­ï¼šä¸éœ€è¦å·¥å…·)</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>       END â†’ è¿”å›ç»“æœç»™ç”¨æˆ·</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><hr><h2 id="ğŸ”§-ä»£ç å®ç°è¯¦è§£" tabindex="-1">ğŸ”§ ä»£ç å®ç°è¯¦è§£ <a class="header-anchor" href="#ğŸ”§-ä»£ç å®ç°è¯¦è§£" aria-label="Permalink to &quot;ğŸ”§ ä»£ç å®ç°è¯¦è§£&quot;">â€‹</a></h2><h3 id="_1-å®šä¹‰å·¥å…·å‡½æ•°" tabindex="-1">1. å®šä¹‰å·¥å…·å‡½æ•° <a class="header-anchor" href="#_1-å®šä¹‰å·¥å…·å‡½æ•°" aria-label="Permalink to &quot;1. å®šä¹‰å·¥å…·å‡½æ•°&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> multiply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, b: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;Multiply a and b.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Args:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        a: first int</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        b: second int</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, b: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;Adds a and b.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Args:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        a: first int</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        b: second int</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> divide</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, b: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;Divide a and b.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Args:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        a: first int</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        b: second int</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [add, multiply, divide]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><strong>Python çŸ¥è¯†ç‚¹ï¼šå‡½æ•°æ–‡æ¡£å­—ç¬¦ä¸²ï¼ˆDocstringï¼‰</strong></p><p>å‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸²ä¸ä»…ä»…æ˜¯æ³¨é‡Šï¼Œå®ƒæ˜¯ Python çš„ä¸€ç­‰å…¬æ°‘ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, b: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;Adds a and b.    # â† ç®€çŸ­æè¿°</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Args:               # â† å‚æ•°è¯´æ˜</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        a: first int</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        b: second int</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¯ä»¥é€šè¿‡ __doc__ å±æ€§è®¿é—®</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(add.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__doc__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>LangChain çš„é­”æ³•ï¼š</strong> LangChain ä¼šè§£æè¿™äº›æ–‡æ¡£å­—ç¬¦ä¸²ï¼Œå¹¶å°†å®ƒä»¬ä½œä¸ºå·¥å…·æè¿°ä¼ é€’ç»™ LLMï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># LLM ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å·¥å…·æè¿°ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Tool: add</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Description: Adds a and b.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Parameters:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   - a: first int</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   - b: second int</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ LLM èƒ½å¤Ÿ&quot;ç†è§£&quot;å·¥å…·çš„ä½œç”¨ï¼</p><hr><h3 id="_2-ç»‘å®šå·¥å…·åˆ°æ¨¡å‹" tabindex="-1">2. ç»‘å®šå·¥å…·åˆ°æ¨¡å‹ <a class="header-anchor" href="#_2-ç»‘å®šå·¥å…·åˆ°æ¨¡å‹" aria-label="Permalink to &quot;2. ç»‘å®šå·¥å…·åˆ°æ¨¡å‹&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langchain_openai </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ChatOpenAI</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">llm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ChatOpenAI(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt-4o&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">llm_with_tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.bind_tools(tools, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">parallel_tool_calls</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>å…³é”®å‚æ•°ï¼š<code>parallel_tool_calls=False</code></strong></p><p>è¿™ä¸ªå‚æ•°æ§åˆ¶æ¨¡å‹æ˜¯å¦å¯ä»¥åŒæ—¶è°ƒç”¨å¤šä¸ªå·¥å…·ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># parallel_tool_calls=Trueï¼ˆé»˜è®¤ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¨¡å‹å¯èƒ½åŒæ—¶è°ƒç”¨ï¼šadd(3, 4) å’Œ multiply(7, 2)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é€‚åˆï¼šå¹¶è¡Œã€ç‹¬ç«‹çš„ä»»åŠ¡</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># parallel_tool_calls=False</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¨¡å‹å¿…é¡»ä¾æ¬¡è°ƒç”¨ï¼šå…ˆ add(3, 4)ï¼Œç­‰ç»“æœï¼Œå†è°ƒç”¨ multiply</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é€‚åˆï¼šæ•°å­¦è®¡ç®—ç­‰éœ€è¦é¡ºåºæ‰§è¡Œçš„ä»»åŠ¡</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆæ•°å­¦è®¡ç®—è¦è®¾ç½®ä¸º Falseï¼Ÿ</strong></p><p>æ•°å­¦è®¡ç®—é€šå¸¸æœ‰ä¾èµ–å…³ç³»ï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç¬¬ä¸€æ­¥ï¼š3 + 4 = 7</span></span>
<span class="line"><span>ç¬¬äºŒæ­¥ï¼š7 Ã— 2 = 14  â† ä¾èµ–ç¬¬ä¸€æ­¥çš„ç»“æœï¼</span></span>
<span class="line"><span>ç¬¬ä¸‰æ­¥ï¼š14 Ã· 5 = 2.8  â† ä¾èµ–ç¬¬äºŒæ­¥çš„ç»“æœï¼</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>å¦‚æœå…è®¸å¹¶è¡Œè°ƒç”¨ï¼Œæ¨¡å‹å¯èƒ½åœ¨ä¸çŸ¥é“ç¬¬ä¸€æ­¥ç»“æœçš„æƒ…å†µä¸‹å°±å°è¯•æ‰§è¡Œç¬¬äºŒæ­¥ï¼Œå¯¼è‡´é”™è¯¯ã€‚</p><hr><h3 id="_3-å®šä¹‰çŠ¶æ€" tabindex="-1">3. å®šä¹‰çŠ¶æ€ <a class="header-anchor" href="#_3-å®šä¹‰çŠ¶æ€" aria-label="Permalink to &quot;3. å®šä¹‰çŠ¶æ€&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langgraph.graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MessagesState</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langchain_core.messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HumanMessage, SystemMessage</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># System message</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sys_msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SystemMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You are a helpful assistant tasked with performing arithmetic on a set of inputs.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>LangGraph çŸ¥è¯†ç‚¹ï¼šMessagesState</strong></p><p><code>MessagesState</code> æ˜¯ LangGraph å†…ç½®çš„çŠ¶æ€ç±»ï¼Œä¸“é—¨ç”¨äºèŠå¤©åœºæ™¯ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MessagesState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages: Annotated[list[BaseMessage], add_messages]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>æ ¸å¿ƒç‰¹æ€§ï¼š</strong></p><ol><li><strong>è‡ªåŠ¨æ¶ˆæ¯ç®¡ç†</strong>ï¼šç»´æŠ¤å¯¹è¯å†å²</li><li><strong>æ¶ˆæ¯è¿½åŠ </strong>ï¼šä½¿ç”¨ <code>add_messages</code> reducer è‡ªåŠ¨è¿½åŠ æ–°æ¶ˆæ¯</li><li><strong>ç±»å‹å®‰å…¨</strong>ï¼šæ”¯æŒä¸åŒç±»å‹çš„æ¶ˆæ¯ï¼ˆHumanMessageã€AIMessageã€ToolMessage ç­‰ï¼‰</li></ol><p><strong>æ¶ˆæ¯ç±»å‹ï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langchain_core.messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    HumanMessage,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç”¨æˆ·æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AIMessage,       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AI å›å¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SystemMessage,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç³»ç»Ÿæç¤º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ToolMessage      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å·¥å…·è¿”å›ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><hr><h3 id="_4-å®šä¹‰-assistant-èŠ‚ç‚¹" tabindex="-1">4. å®šä¹‰ Assistant èŠ‚ç‚¹ <a class="header-anchor" href="#_4-å®šä¹‰-assistant-èŠ‚ç‚¹" aria-label="Permalink to &quot;4. å®šä¹‰ Assistant èŠ‚ç‚¹&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> assistant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesState):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [llm_with_tools.invoke([sys_msg] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ä»£ç è§£æï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[sys_msg] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ„å»ºå®Œæ•´çš„æ¶ˆæ¯åˆ—è¡¨ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   SystemMessage(&quot;You are a helpful assistant...&quot;),  # ç³»ç»Ÿæç¤º</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   HumanMessage(&quot;Add 3 and 4...&quot;),                   # ç”¨æˆ·é—®é¢˜</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   AIMessage(tool_calls=[...]),                       # AI çš„å·¥å…·è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   ToolMessage(content=&quot;7&quot;),                          # å·¥å…·è¿”å›ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   ...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>ä¸ºä»€ä¹ˆæ¯æ¬¡éƒ½åŠ ä¸Š sys_msgï¼Ÿ</strong></p><p>æ¯æ¬¡è°ƒç”¨ LLM æ—¶ï¼Œéƒ½éœ€è¦æä¾›å®Œæ•´çš„ä¸Šä¸‹æ–‡ï¼š</p><ul><li>ç³»ç»Ÿæç¤ºå®šä¹‰ AI çš„è§’è‰²å’Œè¡Œä¸º</li><li>å†å²æ¶ˆæ¯æä¾›å¯¹è¯ä¸Šä¸‹æ–‡</li><li>è¿™æ · AI æ‰èƒ½ç†è§£å½“å‰å¤„äºå¯¹è¯çš„å“ªä¸ªé˜¶æ®µ</li></ul><p><strong>è¿”å›æ ¼å¼ï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [new_message]}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¿”å›çš„æ¶ˆæ¯ä¼šè¢«è¿½åŠ åˆ° state[&quot;messages&quot;] ä¸­</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å› ä¸º MessagesState ä½¿ç”¨äº† add_messages reducer</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><hr><h3 id="_5-æ„å»º-agent-å›¾" tabindex="-1">5. æ„å»º Agent å›¾ <a class="header-anchor" href="#_5-æ„å»º-agent-å›¾" aria-label="Permalink to &quot;5. æ„å»º Agent å›¾&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langgraph.graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> START</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, StateGraph</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langgraph.prebuilt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tools_condition</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langgraph.prebuilt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ToolNode</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ›å»ºå›¾</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StateGraph(MessagesState)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ·»åŠ èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, assistant)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tools&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ToolNode(tools))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ·»åŠ è¾¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">START</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¡ä»¶è¾¹ï¼šæ ¹æ® assistant çš„è¾“å‡ºå†³å®šè·¯ç”±</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_conditional_edges(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tools_condition,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¡ä»¶å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å…³é”®ï¼šä» tools å›åˆ° assistant å½¢æˆå¾ªç¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tools&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¼–è¯‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">react_graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder.compile()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>LangGraph çŸ¥è¯†ç‚¹ï¼šToolNode</strong></p><p><code>ToolNode</code> æ˜¯ LangGraph æä¾›çš„é¢„æ„å»ºèŠ‚ç‚¹ï¼Œç”¨äºæ‰§è¡Œå·¥å…·è°ƒç”¨ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ToolNode(tools)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è‡ªåŠ¨å¤„ç†ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. è§£æ AIMessage ä¸­çš„ tool_calls</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. è°ƒç”¨å¯¹åº”çš„å·¥å…·å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. å°†ç»“æœåŒ…è£…æˆ ToolMessage</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. è¿”å›ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>ç­‰ä»·çš„æ‰‹åŠ¨å®ç°ï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tools_node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesState):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è·å–æœ€åä¸€æ¡æ¶ˆæ¯ï¼ˆAI çš„å·¥å…·è°ƒç”¨ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    last_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ‰§è¡Œæ‰€æœ‰å·¥å…·è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tool_messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tool_call </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> last_message.tool_calls:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æ‰¾åˆ°å¯¹åº”çš„å·¥å…·</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tool </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tool_call[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # è°ƒç”¨å·¥å…·</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tool.invoke(tool_call[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;args&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # åŒ…è£…æˆ ToolMessage</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tool_messages.append(ToolMessage(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result),</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            tool_call_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_call[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: tool_messages}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>LangGraph çŸ¥è¯†ç‚¹ï¼štools_condition</strong></p><p><code>tools_condition</code> æ˜¯é¢„æ„å»ºçš„æ¡ä»¶å‡½æ•°ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tools_condition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesState) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è·å–æœ€åä¸€æ¡æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    last_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å¦‚æœæ˜¯ AIMessage ä¸”åŒ…å« tool_calls</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> hasattr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(last_message, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tool_calls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> last_message.tool_calls:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;tools&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # è·¯ç”±åˆ° tools èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> END</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # ç»“æŸå›¾æ‰§è¡Œ</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>æ¡ä»¶è¾¹çš„å·¥ä½œæµç¨‹ï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_conditional_edges(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, tools_condition)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®Œæ•´æµç¨‹ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># assistant èŠ‚ç‚¹æ‰§è¡Œå®Œæ¯•</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#    â†“</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># tools_condition æ£€æŸ¥è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#    â†“</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¦‚æœæœ‰ tool_calls â†’ è·¯ç”±åˆ° &quot;tools&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¦‚æœæ²¡æœ‰ tool_calls â†’ è·¯ç”±åˆ° END</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>Agent å¾ªç¯çš„å…³é”®ï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tools&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># â† è¿™æ¡è¾¹åˆ›å»ºäº†å¾ªç¯ï¼</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®Œæ•´å¾ªç¯ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># assistant â†’ (æœ‰å·¥å…·è°ƒç”¨) â†’ tools â†’ assistant â†’ ...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#          â†’ (æ— å·¥å…·è°ƒç”¨) â†’ END</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr><h3 id="_6-æ‰§è¡Œ-agent" tabindex="-1">6. æ‰§è¡Œ Agent <a class="header-anchor" href="#_6-æ‰§è¡Œ-agent" aria-label="Permalink to &quot;6. æ‰§è¡Œ Agent&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Add 3 and 4. Multiply the output by 2. Divide the output by 5&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> react_graph.invoke({</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: messages})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>æ‰§è¡Œè¿‡ç¨‹è¯¦è§£ï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>æ­¥éª¤ 1ï¼šassistant èŠ‚ç‚¹</span></span>
<span class="line"><span>è¾“å…¥ï¼š[HumanMessage(&quot;Add 3 and 4. Multiply the output by 2. Divide the output by 5&quot;)]</span></span>
<span class="line"><span>è¾“å‡ºï¼šAIMessage(tool_calls=[ToolCall(name=&quot;add&quot;, args={&quot;a&quot;: 3, &quot;b&quot;: 4})])</span></span>
<span class="line"><span>tools_conditionï¼šæ£€æµ‹åˆ° tool_calls â†’ è·¯ç”±åˆ° &quot;tools&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ­¥éª¤ 2ï¼štools èŠ‚ç‚¹</span></span>
<span class="line"><span>è¾“å…¥ï¼š[HumanMessage(...), AIMessage(tool_calls=[...])]</span></span>
<span class="line"><span>æ‰§è¡Œï¼šadd(3, 4) = 7</span></span>
<span class="line"><span>è¾“å‡ºï¼šToolMessage(content=&quot;7&quot;, tool_call_id=&quot;...&quot;)</span></span>
<span class="line"><span>è‡ªåŠ¨è·¯ç”±ï¼šâ†’ &quot;assistant&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ­¥éª¤ 3ï¼šassistant èŠ‚ç‚¹</span></span>
<span class="line"><span>è¾“å…¥ï¼š[HumanMessage(...), AIMessage(...), ToolMessage(&quot;7&quot;)]</span></span>
<span class="line"><span>åˆ†æï¼šçœ‹åˆ°ç»“æœæ˜¯ 7ï¼Œéœ€è¦ä¹˜ä»¥ 2</span></span>
<span class="line"><span>è¾“å‡ºï¼šAIMessage(tool_calls=[ToolCall(name=&quot;multiply&quot;, args={&quot;a&quot;: 7, &quot;b&quot;: 2})])</span></span>
<span class="line"><span>tools_conditionï¼šæ£€æµ‹åˆ° tool_calls â†’ è·¯ç”±åˆ° &quot;tools&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ­¥éª¤ 4ï¼štools èŠ‚ç‚¹</span></span>
<span class="line"><span>æ‰§è¡Œï¼šmultiply(7, 2) = 14</span></span>
<span class="line"><span>è¾“å‡ºï¼šToolMessage(content=&quot;14&quot;)</span></span>
<span class="line"><span>è‡ªåŠ¨è·¯ç”±ï¼šâ†’ &quot;assistant&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ­¥éª¤ 5ï¼šassistant èŠ‚ç‚¹</span></span>
<span class="line"><span>è¾“å…¥ï¼šåŒ…å« ToolMessage(&quot;14&quot;) çš„å®Œæ•´å¯¹è¯å†å²</span></span>
<span class="line"><span>åˆ†æï¼šçœ‹åˆ°ç»“æœæ˜¯ 14ï¼Œéœ€è¦é™¤ä»¥ 5</span></span>
<span class="line"><span>è¾“å‡ºï¼šAIMessage(tool_calls=[ToolCall(name=&quot;divide&quot;, args={&quot;a&quot;: 14, &quot;b&quot;: 5})])</span></span>
<span class="line"><span>tools_conditionï¼šæ£€æµ‹åˆ° tool_calls â†’ è·¯ç”±åˆ° &quot;tools&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ­¥éª¤ 6ï¼štools èŠ‚ç‚¹</span></span>
<span class="line"><span>æ‰§è¡Œï¼šdivide(14, 5) = 2.8</span></span>
<span class="line"><span>è¾“å‡ºï¼šToolMessage(content=&quot;2.8&quot;)</span></span>
<span class="line"><span>è‡ªåŠ¨è·¯ç”±ï¼šâ†’ &quot;assistant&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ­¥éª¤ 7ï¼šassistant èŠ‚ç‚¹</span></span>
<span class="line"><span>è¾“å…¥ï¼šåŒ…å«æ‰€æœ‰å†å²æ¶ˆæ¯å’Œæœ€ç»ˆç»“æœ 2.8</span></span>
<span class="line"><span>åˆ†æï¼šæ‰€æœ‰è®¡ç®—å®Œæˆï¼Œå¯ä»¥ç»™å‡ºæœ€ç»ˆç­”æ¡ˆ</span></span>
<span class="line"><span>è¾“å‡ºï¼šAIMessage(content=&quot;The final result is 2.8&quot;)  # æ³¨æ„ï¼šæ²¡æœ‰ tool_calls</span></span>
<span class="line"><span>tools_conditionï¼šæ²¡æœ‰ tool_calls â†’ è·¯ç”±åˆ° END</span></span>
<span class="line"><span></span></span>
<span class="line"><span>å›¾æ‰§è¡Œç»“æŸ</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><hr><h3 id="_7-æŸ¥çœ‹è¾“å‡º" tabindex="-1">7. æŸ¥çœ‹è¾“å‡º <a class="header-anchor" href="#_7-æŸ¥çœ‹è¾“å‡º" aria-label="Permalink to &quot;7. æŸ¥çœ‹è¾“å‡º&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> messages[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;messages&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    m.pretty_print()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>è¾“å‡ºè§£æï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>================================ Human Message =================================</span></span>
<span class="line"><span>Add 3 and 4. Multiply the output by 2. Divide the output by 5</span></span>
<span class="line"><span></span></span>
<span class="line"><span>================================== Ai Message ==================================</span></span>
<span class="line"><span>Tool Calls:</span></span>
<span class="line"><span>  add (call_i8zDfMTdvmIG34w4VBA3m93Z)</span></span>
<span class="line"><span> Call ID: call_i8zDfMTdvmIG34w4VBA3m93Z</span></span>
<span class="line"><span>  Args:</span></span>
<span class="line"><span>    a: 3</span></span>
<span class="line"><span>    b: 4</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>è§£é‡Šï¼š</strong></p><ul><li>AI ç†è§£äº†ä»»åŠ¡ï¼Œå†³å®šå…ˆè°ƒç”¨ <code>add</code> å·¥å…·</li><li><code>Call ID</code> æ˜¯å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºè¿½è¸ªå·¥å…·è°ƒç”¨å’Œç»“æœçš„å¯¹åº”å…³ç³»</li><li><code>Args</code> æ˜¯ä¼ é€’ç»™å·¥å…·çš„å‚æ•°</li></ul><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>================================= Tool Message =================================</span></span>
<span class="line"><span>Name: add</span></span>
<span class="line"><span>7</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>è§£é‡Šï¼š</strong></p><ul><li>å·¥å…·æ‰§è¡Œç»“æœï¼š3 + 4 = 7</li><li>è¿™ä¸ªç»“æœä¼šè¢«ä¼ å› assistant èŠ‚ç‚¹</li></ul><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>================================== Ai Message ==================================</span></span>
<span class="line"><span>Tool Calls:</span></span>
<span class="line"><span>  multiply (call_nE62D40lrGQC7b67nVOzqGYY)</span></span>
<span class="line"><span> Call ID: call_nE62D40lrGQC7b67nVOzqGYY</span></span>
<span class="line"><span>  Args:</span></span>
<span class="line"><span>    a: 7</span></span>
<span class="line"><span>    b: 2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>è§£é‡Šï¼š</strong></p><ul><li>AI æ”¶åˆ°ç»“æœ 7ï¼Œå†³å®šä¸‹ä¸€æ­¥è°ƒç”¨ <code>multiply</code></li><li>æ³¨æ„å‚æ•° <code>a: 7</code> æ¥è‡ªä¸Šä¸€æ­¥çš„ç»“æœï¼</li></ul><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>================================= Tool Message =================================</span></span>
<span class="line"><span>Name: multiply</span></span>
<span class="line"><span>14</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>è§£é‡Šï¼š</strong> 7 Ã— 2 = 14</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>================================== Ai Message ==================================</span></span>
<span class="line"><span>Tool Calls:</span></span>
<span class="line"><span>  divide (call_6Q9SjxD2VnYJqEBXFt7O1moe)</span></span>
<span class="line"><span> Call ID: call_6Q9SjxD2VnYJqEBXFt7O1moe</span></span>
<span class="line"><span>  Args:</span></span>
<span class="line"><span>    a: 14</span></span>
<span class="line"><span>    b: 5</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>è§£é‡Šï¼š</strong></p><ul><li>AI ç»§ç»­æ¨ç†ï¼Œè°ƒç”¨ <code>divide</code></li><li>å‚æ•° <code>a: 14</code> æ¥è‡ªä¸Šä¸€æ­¥ç»“æœ</li></ul><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>================================= Tool Message =================================</span></span>
<span class="line"><span>Name: divide</span></span>
<span class="line"><span>2.8</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>è§£é‡Šï¼š</strong> 14 Ã· 5 = 2.8</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>================================== Ai Message ==================================</span></span>
<span class="line"><span>The final result after performing the operations (3 + 4) Ã— 2 Ã· 5 is 2.8.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>è§£é‡Šï¼š</strong></p><ul><li>æ‰€æœ‰è®¡ç®—å®Œæˆï¼ŒAI ç»™å‡ºæœ€ç»ˆç­”æ¡ˆ</li><li>è¿™æ¡æ¶ˆæ¯æ²¡æœ‰ <code>tool_calls</code>ï¼Œæ‰€ä»¥å›¾æ‰§è¡Œç»“æŸ</li></ul><p><strong>å…³é”®è§‚å¯Ÿç‚¹ï¼š</strong></p><ol><li>AI è‡ªä¸»å†³å®šäº†æ¯ä¸€æ­¥çš„å·¥å…·è°ƒç”¨</li><li>æ¯æ¬¡éƒ½åŸºäºå‰ä¸€æ­¥çš„ç»“æœè¿›è¡Œæ¨ç†</li><li>æœ€ç»ˆç»™å‡ºäº†è‡ªç„¶è¯­è¨€çš„å›ç­”</li><li>æ•´ä¸ªè¿‡ç¨‹æ˜¯è‡ªåŠ¨åŒ–çš„ï¼Œæ— éœ€äººå·¥å¹²é¢„</li></ol><hr><h2 id="ğŸ“-æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“" tabindex="-1">ğŸ“ æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“ <a class="header-anchor" href="#ğŸ“-æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“" aria-label="Permalink to &quot;ğŸ“ æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“&quot;">â€‹</a></h2><h3 id="langgraph-ç‰¹æœ‰æ¦‚å¿µ" tabindex="-1">LangGraph ç‰¹æœ‰æ¦‚å¿µ <a class="header-anchor" href="#langgraph-ç‰¹æœ‰æ¦‚å¿µ" aria-label="Permalink to &quot;LangGraph ç‰¹æœ‰æ¦‚å¿µ&quot;">â€‹</a></h3><h4 id="_1-agent-vs-router" tabindex="-1">1. Agent vs Router <a class="header-anchor" href="#_1-agent-vs-router" aria-label="Permalink to &quot;1. Agent vs Router&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>ç‰¹æ€§</th><th>Router</th><th>Agent</th></tr></thead><tbody><tr><td>å·¥å…·è°ƒç”¨æ¬¡æ•°</td><td>ä¸€æ¬¡</td><td>å¤šæ¬¡ï¼ˆå¾ªç¯ï¼‰</td></tr><tr><td>å·¥å…·ç»“æœæµå‘</td><td>ç›´æ¥è¿”å›ç”¨æˆ·</td><td>è¿”å›æ¨¡å‹ç»§ç»­å¤„ç†</td></tr><tr><td>å†³ç­–æ¬¡æ•°</td><td>ä¸€æ¬¡</td><td>å¤šæ¬¡ï¼ˆæ¯æ¬¡å¾ªç¯éƒ½å†³ç­–ï¼‰</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>ç®€å•åˆ†ç±»ã€å•æ¬¡æŸ¥è¯¢</td><td>å¤æ‚ä»»åŠ¡ã€å¤šæ­¥éª¤æ¨ç†</td></tr></tbody></table><h4 id="_2-react-å¾ªç¯" tabindex="-1">2. ReAct å¾ªç¯ <a class="header-anchor" href="#_2-react-å¾ªç¯" aria-label="Permalink to &quot;2. ReAct å¾ªç¯&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">while</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Reason: AI åˆ†æå½“å‰çŠ¶æ€ï¼Œå†³å®šè¡ŒåŠ¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ai_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> assistant(state)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # åˆ¤æ–­ï¼šéœ€è¦å·¥å…·å—ï¼Ÿ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> no_tool_calls(ai_message):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        break</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # ä¸éœ€è¦ï¼Œè¿”å›ç­”æ¡ˆ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Act: è°ƒç”¨å·¥å…·</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tool_result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tools(state)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Observe: æ›´æ–°çŠ¶æ€ï¼Œå°†ç»“æœä¼ å› AI</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> update_state(tool_result)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_3-æ¡ä»¶è¾¹ä¸å¾ªç¯" tabindex="-1">3. æ¡ä»¶è¾¹ä¸å¾ªç¯ <a class="header-anchor" href="#_3-æ¡ä»¶è¾¹ä¸å¾ªç¯" aria-label="Permalink to &quot;3. æ¡ä»¶è¾¹ä¸å¾ªç¯&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¡ä»¶è¾¹ï¼šæ ¹æ®è¾“å‡ºåŠ¨æ€è·¯ç”±</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_conditional_edges(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, tools_condition)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¿”å›è¾¹ï¼šåˆ›å»ºå¾ªç¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tools&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç»„åˆæ•ˆæœï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># assistant â†’ [æœ‰å·¥å…·è°ƒç”¨] â†’ tools â†’ assistant â†’ ...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#          â†’ [æ— å·¥å…·è°ƒç”¨] â†’ END</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_4-messagesstate" tabindex="-1">4. MessagesState <a class="header-anchor" href="#_4-messagesstate" aria-label="Permalink to &quot;4. MessagesState&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MessagesState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages: Annotated[list[BaseMessage], add_messages]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç‰¹ç‚¹ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. è‡ªåŠ¨ç»´æŠ¤å¯¹è¯å†å²</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. æ”¯æŒå¤šç§æ¶ˆæ¯ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. ä½¿ç”¨ add_messages reducer è¿½åŠ æ¶ˆæ¯</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_5-toolnode" tabindex="-1">5. ToolNode <a class="header-anchor" href="#_5-toolnode" aria-label="Permalink to &quot;5. ToolNode&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ToolNode(tools)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è‡ªåŠ¨å¤„ç†ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - è§£æ tool_calls</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - è°ƒç”¨å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - åŒ…è£…ç»“æœä¸º ToolMessage</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - è¿½è¸ª tool_call_id</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="python-ç‰¹æœ‰çŸ¥è¯†ç‚¹" tabindex="-1">Python ç‰¹æœ‰çŸ¥è¯†ç‚¹ <a class="header-anchor" href="#python-ç‰¹æœ‰çŸ¥è¯†ç‚¹" aria-label="Permalink to &quot;Python ç‰¹æœ‰çŸ¥è¯†ç‚¹&quot;">â€‹</a></h3><h4 id="_1-å‡½æ•°ç±»å‹æ³¨è§£" tabindex="-1">1. å‡½æ•°ç±»å‹æ³¨è§£ <a class="header-anchor" href="#_1-å‡½æ•°ç±»å‹æ³¨è§£" aria-label="Permalink to &quot;1. å‡½æ•°ç±»å‹æ³¨è§£&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, b: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;Adds a and b.&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># a: int        â† å‚æ•°ç±»å‹æ³¨è§£</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -&gt; int        â† è¿”å›ç±»å‹æ³¨è§£</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;&quot;&quot;...&quot;&quot;&quot;     â† æ–‡æ¡£å­—ç¬¦ä¸²</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>ä½œç”¨ï¼š</strong></p><ul><li>IDE æä¾›æ™ºèƒ½æç¤º</li><li>ç±»å‹æ£€æŸ¥å·¥å…·ï¼ˆmypyï¼‰éªŒè¯ä»£ç </li><li>LangChain è§£æç”¨äºå·¥å…·æè¿°</li></ul><h4 id="_2-docstring-è§„èŒƒ-google-é£æ ¼" tabindex="-1">2. Docstring è§„èŒƒï¼ˆGoogle é£æ ¼ï¼‰ <a class="header-anchor" href="#_2-docstring-è§„èŒƒ-google-é£æ ¼" aria-label="Permalink to &quot;2. Docstring è§„èŒƒï¼ˆGoogle é£æ ¼ï¼‰&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> multiply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, b: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;Multiply a and b.          # ç®€çŸ­æè¿°ï¼ˆå¿…é¡»ï¼‰</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Args:                          # å‚æ•°åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        a: first int</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        b: second int</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Returns:                       # è¿”å›å€¼ï¼ˆå¯é€‰ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        The product of a and b</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Raises:                        # å¼‚å¸¸ï¼ˆå¯é€‰ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        ValueError: If a or b is negative</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_3-åˆ—è¡¨æ‹¼æ¥" tabindex="-1">3. åˆ—è¡¨æ‹¼æ¥ <a class="header-anchor" href="#_3-åˆ—è¡¨æ‹¼æ¥" aria-label="Permalink to &quot;3. åˆ—è¡¨æ‹¼æ¥&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[sys_msg] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç­‰ä»·äºï¼š</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result.append(sys_msg)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result.extend(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_4-å¯¹è±¡å±æ€§æ£€æŸ¥" tabindex="-1">4. å¯¹è±¡å±æ€§æ£€æŸ¥ <a class="header-anchor" href="#_4-å¯¹è±¡å±æ€§æ£€æŸ¥" aria-label="Permalink to &quot;4. å¯¹è±¡å±æ€§æ£€æŸ¥&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">hasattr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(obj, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;attribute_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¤ºä¾‹ï¼š</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">hasattr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(last_message, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tool_calls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ£€æŸ¥ last_message å¯¹è±¡æ˜¯å¦æœ‰ tool_calls å±æ€§</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr><h2 id="ğŸ’¡-æœ€ä½³å®è·µ" tabindex="-1">ğŸ’¡ æœ€ä½³å®è·µ <a class="header-anchor" href="#ğŸ’¡-æœ€ä½³å®è·µ" aria-label="Permalink to &quot;ğŸ’¡ æœ€ä½³å®è·µ&quot;">â€‹</a></h2><h3 id="_1-ä½•æ—¶ä½¿ç”¨-agent" tabindex="-1">1. ä½•æ—¶ä½¿ç”¨ Agentï¼Ÿ <a class="header-anchor" href="#_1-ä½•æ—¶ä½¿ç”¨-agent" aria-label="Permalink to &quot;1. ä½•æ—¶ä½¿ç”¨ Agentï¼Ÿ&quot;">â€‹</a></h3><p>âœ… <strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p><ul><li>éœ€è¦å¤šæ­¥éª¤æ¨ç†çš„ä»»åŠ¡ï¼ˆå¦‚æ•°å­¦è®¡ç®—ã€æ•°æ®åˆ†æï¼‰</li><li>éœ€è¦æ ¹æ®ä¸­é—´ç»“æœåŠ¨æ€è°ƒæ•´ç­–ç•¥</li><li>å·¥å…·è°ƒç”¨é¡ºåºä¸å›ºå®šï¼Œéœ€è¦ AI è‡ªä¸»å†³ç­–</li><li>ä»»åŠ¡å¤æ‚åº¦é«˜ï¼Œéœ€è¦çµæ´»åº”å¯¹</li></ul><p>âŒ <strong>ä¸é€‚ç”¨åœºæ™¯ï¼š</strong></p><ul><li>ç®€å•çš„å•æ¬¡å·¥å…·è°ƒç”¨ï¼ˆç”¨ Router å³å¯ï¼‰</li><li>å›ºå®šæµç¨‹çš„ä»»åŠ¡ï¼ˆç”¨æ™®é€šå›¾å³å¯ï¼‰</li><li>ä¸éœ€è¦å¾ªç¯æ¨ç†çš„åœºæ™¯</li></ul><h3 id="_2-å¹¶è¡Œå·¥å…·è°ƒç”¨çš„é€‰æ‹©" tabindex="-1">2. å¹¶è¡Œå·¥å…·è°ƒç”¨çš„é€‰æ‹© <a class="header-anchor" href="#_2-å¹¶è¡Œå·¥å…·è°ƒç”¨çš„é€‰æ‹©" aria-label="Permalink to &quot;2. å¹¶è¡Œå·¥å…·è°ƒç”¨çš„é€‰æ‹©&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åœºæ™¯ 1ï¼šæ•°å­¦è®¡ç®— â†’ parallel_tool_calls=False</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">llm_with_tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.bind_tools([add, multiply, divide], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">parallel_tool_calls</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åŸå› ï¼šæ­¥éª¤æœ‰ä¾èµ–å…³ç³»ï¼Œå¿…é¡»é¡ºåºæ‰§è¡Œ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åœºæ™¯ 2ï¼šä¿¡æ¯æ”¶é›† â†’ parallel_tool_calls=Trueï¼ˆé»˜è®¤ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">llm_with_tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.bind_tools([search_web, query_db, call_api])</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åŸå› ï¼šä¸‰ä¸ªå·¥å…·å¯ä»¥åŒæ—¶è°ƒç”¨ï¼Œæé«˜æ•ˆç‡</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_3-ç³»ç»Ÿæç¤ºçš„é‡è¦æ€§" tabindex="-1">3. ç³»ç»Ÿæç¤ºçš„é‡è¦æ€§ <a class="header-anchor" href="#_3-ç³»ç»Ÿæç¤ºçš„é‡è¦æ€§" aria-label="Permalink to &quot;3. ç³»ç»Ÿæç¤ºçš„é‡è¦æ€§&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># âœ… å¥½çš„ç³»ç»Ÿæç¤º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sys_msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SystemMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">You are a helpful assistant tasked with performing arithmetic on a set of inputs.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">- Break down complex calculations into steps</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">- Use the appropriate tool for each operation</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">- Show your reasoning</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># âŒ ä¸å¥½çš„ç³»ç»Ÿæç¤º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sys_msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SystemMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You are helpful.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¤ªæ¨¡ç³Šï¼ŒAI å¯èƒ½ä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨å·¥å…·</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_4-é˜²æ­¢æ— é™å¾ªç¯" tabindex="-1">4. é˜²æ­¢æ— é™å¾ªç¯ <a class="header-anchor" href="#_4-é˜²æ­¢æ— é™å¾ªç¯" aria-label="Permalink to &quot;4. é˜²æ­¢æ— é™å¾ªç¯&quot;">â€‹</a></h3><p>Agent æœ‰å¯èƒ½é™·å…¥æ— é™å¾ªç¯ï¼Œéœ€è¦è®¾ç½®é™åˆ¶ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ–¹æ³• 1ï¼šä½¿ç”¨ recursion_limit</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">react_graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder.compile(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">recursion_limit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æœ€å¤šæ‰§è¡Œ 10 æ¬¡å¾ªç¯</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ–¹æ³• 2ï¼šåœ¨çŠ¶æ€ä¸­è®¡æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MessagesStateWithCount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages: Annotated[list[BaseMessage], add_messages]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    iterations: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> assistant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesStateWithCount):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;iterations&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [AIMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Reached maximum iterations&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ... æ­£å¸¸é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [llm_with_tools.invoke(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;iterations&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: state.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;iterations&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_5-å·¥å…·å‡½æ•°è®¾è®¡åŸåˆ™" tabindex="-1">5. å·¥å…·å‡½æ•°è®¾è®¡åŸåˆ™ <a class="header-anchor" href="#_5-å·¥å…·å‡½æ•°è®¾è®¡åŸåˆ™" aria-label="Permalink to &quot;5. å·¥å…·å‡½æ•°è®¾è®¡åŸåˆ™&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># âœ… å¥½çš„å·¥å…·è®¾è®¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> search_database</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, limit: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; list[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;Search the database for matching records.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Args:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        query: Search query string</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        limit: Maximum number of results (default: 10)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Returns:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        List of matching records</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å®ç°...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> results</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç‰¹ç‚¹ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - æ¸…æ™°çš„æ–‡æ¡£å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - ç±»å‹æ³¨è§£</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - é»˜è®¤å‚æ•°å€¼</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - è¿”å›ç»“æ„åŒ–æ•°æ®</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># âŒ ä¸å¥½çš„å·¥å…·è®¾è®¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> search</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(q):  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ²¡æœ‰ç±»å‹æ³¨è§£</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;æœç´¢&quot;&quot;&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # æ–‡æ¡£ä¸æ¸…æ¥š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # AI ä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå·¥å…·</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><hr><h2 id="ğŸš€-è¿›é˜¶æŠ€å·§" tabindex="-1">ğŸš€ è¿›é˜¶æŠ€å·§ <a class="header-anchor" href="#ğŸš€-è¿›é˜¶æŠ€å·§" aria-label="Permalink to &quot;ğŸš€ è¿›é˜¶æŠ€å·§&quot;">â€‹</a></h2><h3 id="_1-å¸¦è®°å¿†çš„-agent" tabindex="-1">1. å¸¦è®°å¿†çš„ Agent <a class="header-anchor" href="#_1-å¸¦è®°å¿†çš„-agent" aria-label="Permalink to &quot;1. å¸¦è®°å¿†çš„ Agent&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MessagesStateWithMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages: Annotated[list[BaseMessage], add_messages]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user_preferences: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # å­˜å‚¨ç”¨æˆ·åå¥½</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation_summary: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # å¯¹è¯æ‘˜è¦</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> assistant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesStateWithMemory):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å¯ä»¥è®¿é—®å†å²åå¥½</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    preferences </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user_preferences&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ„å»ºå¸¦ä¸Šä¸‹æ–‡çš„æç¤º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;User preferences: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">preferences</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.join([m.content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm_with_tools.invoke(prompt)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [response]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_2-åŠ¨æ€å·¥å…·é€‰æ‹©" tabindex="-1">2. åŠ¨æ€å·¥å…·é€‰æ‹© <a class="header-anchor" href="#_2-åŠ¨æ€å·¥å…·é€‰æ‹©" aria-label="Permalink to &quot;2. åŠ¨æ€å·¥å…·é€‰æ‹©&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> assistant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesState):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ ¹æ®å¯¹è¯å†…å®¹åŠ¨æ€é€‰æ‹©å¯ç”¨å·¥å…·</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    last_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].content</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;weather&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> last_message:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [get_weather, get_forecast]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    elif</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;database&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> last_message:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [query_db, insert_db, update_db]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> all_tools</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    llm_with_selected_tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.bind_tools(tools)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm_with_selected_tools.invoke(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [response]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_3-é”™è¯¯å¤„ç†" tabindex="-1">3. é”™è¯¯å¤„ç† <a class="header-anchor" href="#_3-é”™è¯¯å¤„ç†" aria-label="Permalink to &quot;3. é”™è¯¯å¤„ç†&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tools_node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    last_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tool_messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tool_call </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> last_message.tool_calls:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            tool </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> next</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tool_call[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tool.invoke(tool_call[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;args&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            tool_messages.append(ToolMessage(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result),</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                tool_call_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_call[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        except</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # è¿”å›é”™è¯¯ä¿¡æ¯ç»™ AI</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            tool_messages.append(ToolMessage(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Error: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                tool_call_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_call[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;error&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: tool_messages}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_4-æµå¼è¾“å‡º" tabindex="-1">4. æµå¼è¾“å‡º <a class="header-anchor" href="#_4-æµå¼è¾“å‡º" aria-label="Permalink to &quot;4. æµå¼è¾“å‡º&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨ stream æ–¹æ³•æŸ¥çœ‹å®æ—¶æ‰§è¡Œè¿‡ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> react_graph.stream({</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [HumanMessage(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Calculate...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]}):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunk)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¾“å‡ºï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># {&#39;assistant&#39;: {&#39;messages&#39;: [AIMessage(tool_calls=[...])]}}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># {&#39;tools&#39;: {&#39;messages&#39;: [ToolMessage(content=&quot;7&quot;)]}}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># {&#39;assistant&#39;: {&#39;messages&#39;: [AIMessage(tool_calls=[...])]}}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><hr><h2 id="ğŸ“Š-agent-å˜ä½“å¯¹æ¯”" tabindex="-1">ğŸ“Š Agent å˜ä½“å¯¹æ¯” <a class="header-anchor" href="#ğŸ“Š-agent-å˜ä½“å¯¹æ¯”" aria-label="Permalink to &quot;ğŸ“Š Agent å˜ä½“å¯¹æ¯”&quot;">â€‹</a></h2><h3 id="_1-åŸºç¡€-agent-æœ¬æ•™ç¨‹" tabindex="-1">1. åŸºç¡€ Agentï¼ˆæœ¬æ•™ç¨‹ï¼‰ <a class="header-anchor" href="#_1-åŸºç¡€-agent-æœ¬æ•™ç¨‹" aria-label="Permalink to &quot;1. åŸºç¡€ Agentï¼ˆæœ¬æ•™ç¨‹ï¼‰&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tools&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å·¥å…·ç»“æœæ€»æ˜¯å›åˆ° assistant</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>ç‰¹ç‚¹ï¼š</strong> ç®€å•ã€ç›´æ¥ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯</p><h3 id="_2-æ¡ä»¶æ€§è¿”å›-agent" tabindex="-1">2. æ¡ä»¶æ€§è¿”å› Agent <a class="header-anchor" href="#_2-æ¡ä»¶æ€§è¿”å›-agent" aria-label="Permalink to &quot;2. æ¡ä»¶æ€§è¿”å› Agent&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> should_continue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    last_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å¯ä»¥æ ¹æ®å·¥å…·ç»“æœå†³å®šæ˜¯å¦ç»§ç»­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;error&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> last_message.content:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> END</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;assistant&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_conditional_edges(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tools&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, should_continue, [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>ç‰¹ç‚¹ï¼š</strong> å¯ä»¥æå‰ç»ˆæ­¢ï¼Œå¤„ç†é”™è¯¯æƒ…å†µ</p><h3 id="_3-å¤šè·¯å¾„-agent" tabindex="-1">3. å¤šè·¯å¾„ Agent <a class="header-anchor" href="#_3-å¤šè·¯å¾„-agent" aria-label="Permalink to &quot;3. å¤šè·¯å¾„ Agent&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> route_after_tool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    last_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;final&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> last_message.content:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;summarize&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # å»æ€»ç»“èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    elif</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;error&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> last_message.content:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;error_handler&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # å»é”™è¯¯å¤„ç†èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;assistant&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # ç»§ç»­æ¨ç†</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_conditional_edges(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tools&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, route_after_tool,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                             [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;summarize&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;error_handler&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>ç‰¹ç‚¹ï¼š</strong> æ›´å¤æ‚çš„æ§åˆ¶æµï¼Œé€‚åˆå¤§å‹åº”ç”¨</p><hr><h2 id="ğŸ¯-å®é™…åº”ç”¨æ¡ˆä¾‹" tabindex="-1">ğŸ¯ å®é™…åº”ç”¨æ¡ˆä¾‹ <a class="header-anchor" href="#ğŸ¯-å®é™…åº”ç”¨æ¡ˆä¾‹" aria-label="Permalink to &quot;ğŸ¯ å®é™…åº”ç”¨æ¡ˆä¾‹&quot;">â€‹</a></h2><h3 id="æ¡ˆä¾‹-1-ç ”ç©¶åŠ©æ‰‹" tabindex="-1">æ¡ˆä¾‹ 1ï¼šç ”ç©¶åŠ©æ‰‹ <a class="header-anchor" href="#æ¡ˆä¾‹-1-ç ”ç©¶åŠ©æ‰‹" aria-label="Permalink to &quot;æ¡ˆä¾‹ 1ï¼šç ”ç©¶åŠ©æ‰‹&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    search_web,          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æœç´¢ç½‘ç»œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    read_paper,          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¯»å–è®ºæ–‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    summarize_text,      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ€»ç»“æ–‡æœ¬</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    save_notes           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä¿å­˜ç¬”è®°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç”¨æˆ·ï¼šResearch recent advances in quantum computing</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Agent å·¥ä½œæµï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. search_web(&quot;quantum computing 2024&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. read_paper(paper_url_1)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. summarize_text(paper_content_1)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. read_paper(paper_url_2)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 5. summarize_text(paper_content_2)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 6. save_notes(combined_summary)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 7. è¿”å›ç ”ç©¶æ€»ç»“</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="æ¡ˆä¾‹-2-æ•°æ®åˆ†æåŠ©æ‰‹" tabindex="-1">æ¡ˆä¾‹ 2ï¼šæ•°æ®åˆ†æåŠ©æ‰‹ <a class="header-anchor" href="#æ¡ˆä¾‹-2-æ•°æ®åˆ†æåŠ©æ‰‹" aria-label="Permalink to &quot;æ¡ˆä¾‹ 2ï¼šæ•°æ®åˆ†æåŠ©æ‰‹&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    query_database,      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŸ¥è¯¢æ•°æ®åº“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    calculate_stats,     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è®¡ç®—ç»Ÿè®¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    create_chart,        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç”Ÿæˆå›¾è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    export_report        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¯¼å‡ºæŠ¥å‘Š</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç”¨æˆ·ï¼šAnalyze sales data for Q4 and create a report</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Agent å·¥ä½œæµï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. query_database(&quot;SELECT * FROM sales WHERE quarter = &#39;Q4&#39;&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. calculate_stats(sales_data)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. create_chart(stats, type=&quot;bar&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. create_chart(stats, type=&quot;pie&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 5. export_report(charts, stats)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 6. è¿”å›æŠ¥å‘Šé“¾æ¥</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="æ¡ˆä¾‹-3-å®¢æˆ·æ”¯æŒåŠ©æ‰‹" tabindex="-1">æ¡ˆä¾‹ 3ï¼šå®¢æˆ·æ”¯æŒåŠ©æ‰‹ <a class="header-anchor" href="#æ¡ˆä¾‹-3-å®¢æˆ·æ”¯æŒåŠ©æ‰‹" aria-label="Permalink to &quot;æ¡ˆä¾‹ 3ï¼šå®¢æˆ·æ”¯æŒåŠ©æ‰‹&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    search_knowledge_base,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æœç´¢çŸ¥è¯†åº“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    check_order_status,     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŸ¥è¯¢è®¢å•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    create_ticket,          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ›å»ºå·¥å•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    send_email              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å‘é€é‚®ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç”¨æˆ·ï¼šI haven&#39;t received my order #12345</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Agent å·¥ä½œæµï¼š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. check_order_status(&quot;12345&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. search_knowledge_base(&quot;delayed shipping&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. å‘ç°é—®é¢˜ï¼šç‰©æµå»¶è¯¯</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. create_ticket(order_id=&quot;12345&quot;, issue=&quot;shipping_delay&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 5. send_email(user, &quot;Your order is delayed, ticket created&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 6. è¿”å›è§£å†³æ–¹æ¡ˆå’Œå·¥å•å·</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><hr><h2 id="ğŸ”-å¸¸è§é—®é¢˜" tabindex="-1">ğŸ” å¸¸è§é—®é¢˜ <a class="header-anchor" href="#ğŸ”-å¸¸è§é—®é¢˜" aria-label="Permalink to &quot;ğŸ” å¸¸è§é—®é¢˜&quot;">â€‹</a></h2><h3 id="q1-agent-ä»€ä¹ˆæ—¶å€™ä¼šåœæ­¢å¾ªç¯" tabindex="-1">Q1: Agent ä»€ä¹ˆæ—¶å€™ä¼šåœæ­¢å¾ªç¯ï¼Ÿ <a class="header-anchor" href="#q1-agent-ä»€ä¹ˆæ—¶å€™ä¼šåœæ­¢å¾ªç¯" aria-label="Permalink to &quot;Q1: Agent ä»€ä¹ˆæ—¶å€™ä¼šåœæ­¢å¾ªç¯ï¼Ÿ&quot;">â€‹</a></h3><p><strong>ç­”ï¼š</strong> å½“ <code>assistant</code> èŠ‚ç‚¹è¿”å›çš„ <code>AIMessage</code> ä¸åŒ…å« <code>tool_calls</code> æ—¶ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä¼šç»§ç»­å¾ªç¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AIMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tool_calls</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ToolCall(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;add&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä¼šåœæ­¢ï¼ˆè¿›å…¥ ENDï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AIMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;The answer is 42&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="q2-å¦‚ä½•è®©-agent-è°ƒç”¨ç‰¹å®šå·¥å…·" tabindex="-1">Q2: å¦‚ä½•è®© Agent è°ƒç”¨ç‰¹å®šå·¥å…·ï¼Ÿ <a class="header-anchor" href="#q2-å¦‚ä½•è®©-agent-è°ƒç”¨ç‰¹å®šå·¥å…·" aria-label="Permalink to &quot;Q2: å¦‚ä½•è®© Agent è°ƒç”¨ç‰¹å®šå·¥å…·ï¼Ÿ&quot;">â€‹</a></h3><p><strong>ç­”ï¼š</strong> é€šè¿‡ç³»ç»Ÿæç¤ºå¼•å¯¼ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sys_msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SystemMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">You are a helpful assistant.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">When the user asks about weather, ALWAYS use the get_weather tool.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">When the user asks about time, ALWAYS use the get_time tool.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>æˆ–è€…ä½¿ç”¨ <code>tool_choice</code> å‚æ•°ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šå·¥å…·</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">llm_with_tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.bind_tools(tools, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tool_choice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;get_weather&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¼ºåˆ¶è°ƒç”¨ä»»æ„å·¥å…·ï¼ˆä¸èƒ½ç›´æ¥å›ç­”ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">llm_with_tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.bind_tools(tools, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tool_choice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;any&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¦æ­¢è°ƒç”¨å·¥å…·</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">llm_with_tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.bind_tools(tools, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tool_choice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;none&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="q3-å¦‚ä½•æŸ¥çœ‹-agent-çš„æ‰§è¡Œè¿‡ç¨‹" tabindex="-1">Q3: å¦‚ä½•æŸ¥çœ‹ Agent çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ <a class="header-anchor" href="#q3-å¦‚ä½•æŸ¥çœ‹-agent-çš„æ‰§è¡Œè¿‡ç¨‹" aria-label="Permalink to &quot;Q3: å¦‚ä½•æŸ¥çœ‹ Agent çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ&quot;">â€‹</a></h3><p><strong>æ–¹æ³• 1ï¼šä½¿ç”¨ stream</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.stream(input_data):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunk)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>æ–¹æ³• 2ï¼šä½¿ç”¨ LangSmith</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">os.environ[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;LANGSMITH_TRACING&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;true&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">os.environ[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;LANGSMITH_PROJECT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;my-agent&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åœ¨ LangSmith ç½‘ç«™æŸ¥çœ‹è¯¦ç»† trace</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>æ–¹æ³• 3ï¼šè‡ªå®šä¹‰æ—¥å¿—</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> assistant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesState):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[Assistant] Processing </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;messages&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm_with_tools.invoke(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[Assistant] Response: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [response]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="q4-å·¥å…·è°ƒç”¨å¤±è´¥æ€ä¹ˆåŠ" tabindex="-1">Q4: å·¥å…·è°ƒç”¨å¤±è´¥æ€ä¹ˆåŠï¼Ÿ <a class="header-anchor" href="#q4-å·¥å…·è°ƒç”¨å¤±è´¥æ€ä¹ˆåŠ" aria-label="Permalink to &quot;Q4: å·¥å…·è°ƒç”¨å¤±è´¥æ€ä¹ˆåŠï¼Ÿ&quot;">â€‹</a></h3><p><strong>ç­”ï¼š</strong> åœ¨ ToolNode ä¸­å¤„ç†å¼‚å¸¸ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> custom_tools_node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    last_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tool_messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tool_call </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> last_message.tool_calls:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> execute_tool(tool_call)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            tool_messages.append(ToolMessage(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result),</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                tool_call_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_call[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        except</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # å°†é”™è¯¯è¿”å›ç»™ AIï¼Œè®©å®ƒé‡è¯•æˆ–æ¢æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            tool_messages.append(ToolMessage(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Error: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">. Please try a different approach.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">                tool_call_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_call[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: tool_messages}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="q5-å¦‚ä½•é™åˆ¶-agent-çš„æ‰§è¡Œæˆæœ¬" tabindex="-1">Q5: å¦‚ä½•é™åˆ¶ Agent çš„æ‰§è¡Œæˆæœ¬ï¼Ÿ <a class="header-anchor" href="#q5-å¦‚ä½•é™åˆ¶-agent-çš„æ‰§è¡Œæˆæœ¬" aria-label="Permalink to &quot;Q5: å¦‚ä½•é™åˆ¶ Agent çš„æ‰§è¡Œæˆæœ¬ï¼Ÿ&quot;">â€‹</a></h3><p><strong>æ–¹æ³• 1ï¼šé™åˆ¶å¾ªç¯æ¬¡æ•°</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder.compile(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">recursion_limit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>æ–¹æ³• 2ï¼šé™åˆ¶ token ä½¿ç”¨</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TokenTrackingState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MessagesState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    total_tokens: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> assistant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: TokenTrackingState):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;total_tokens&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [AIMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Token limit reached&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # è°ƒç”¨ LLM å¹¶è®°å½• token</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm_with_tools.invoke(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tokens_used </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.response_metadata.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;token_usage&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {}).get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;total_tokens&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [response],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;total_tokens&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: state.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;total_tokens&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tokens_used</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><hr><h2 id="ğŸ“–-æ‰©å±•é˜…è¯»" tabindex="-1">ğŸ“– æ‰©å±•é˜…è¯» <a class="header-anchor" href="#ğŸ“–-æ‰©å±•é˜…è¯»" aria-label="Permalink to &quot;ğŸ“– æ‰©å±•é˜…è¯»&quot;">â€‹</a></h2><ul><li><a href="https://langchain-ai.github.io/langgraph/tutorials/introduction/" target="_blank" rel="noreferrer">LangGraph Agent å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://react-lm.github.io/" target="_blank" rel="noreferrer">ReAct è®ºæ–‡</a></li><li><a href="https://docs.smith.langchain.com/concepts/tracing" target="_blank" rel="noreferrer">LangSmith Tracing æŒ‡å—</a></li><li><a href="https://python.langchain.com/docs/how_to/tool_calling/" target="_blank" rel="noreferrer">Tool Calling æœ€ä½³å®è·µ</a></li></ul><hr><p><strong>æ€»ç»“</strong>ï¼šAgent æ˜¯ LangGraph çš„æ ¸å¿ƒæ¨¡å¼ï¼Œé€šè¿‡ &quot;æ¨ç†-è¡ŒåŠ¨-è§‚å¯Ÿ&quot; çš„å¾ªç¯ï¼Œè®© AI èƒ½å¤Ÿè‡ªä¸»å®Œæˆå¤æ‚ä»»åŠ¡ã€‚æŒæ¡ Agent çš„æ„å»ºæ–¹æ³•ï¼Œæ˜¯å¼€å‘å¼ºå¤§ AI åº”ç”¨çš„åŸºç¡€ï¼</p>`,209)])])}const g=a(p,[["render",e]]);export{c as __pageData,g as default};
