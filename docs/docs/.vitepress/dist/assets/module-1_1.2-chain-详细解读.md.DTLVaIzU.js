import{_ as a,c as i,o as n,ag as l}from"./chunks/framework.Cf3FQAeg.js";const g=JSON.parse('{"title":"LangGraph Chain è¯¦ç»†è§£è¯»","description":"","frontmatter":{},"headers":[],"relativePath":"module-1/1.2-chain-è¯¦ç»†è§£è¯».md","filePath":"module-1/1.2-chain-è¯¦ç»†è§£è¯».md","lastUpdated":1760223716000}'),e={name:"module-1/1.2-chain-è¯¦ç»†è§£è¯».md"};function p(t,s,h,k,r,d){return n(),i("div",null,[...s[0]||(s[0]=[l(`<h1 id="langgraph-chain-è¯¦ç»†è§£è¯»" tabindex="-1">LangGraph Chain è¯¦ç»†è§£è¯» <a class="header-anchor" href="#langgraph-chain-è¯¦ç»†è§£è¯»" aria-label="Permalink to &quot;LangGraph Chain è¯¦ç»†è§£è¯»&quot;">â€‹</a></h1><h2 id="ğŸ“š-æ¦‚è¿°" tabindex="-1">ğŸ“š æ¦‚è¿° <a class="header-anchor" href="#ğŸ“š-æ¦‚è¿°" aria-label="Permalink to &quot;ğŸ“š æ¦‚è¿°&quot;">â€‹</a></h2><p>æœ¬æ–‡æ¡£è¯¦ç»†è§£è¯» LangGraph çš„ <strong>Chainï¼ˆé“¾å¼è°ƒç”¨ï¼‰</strong> åŸºç¡€æ¦‚å¿µã€‚è¿™æ˜¯ LangGraph å¼€å‘çš„ç¬¬ä¸€è¯¾ï¼Œæ¶µç›–äº†æ„å»ºæ™ºèƒ½å¯¹è¯ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼šæ¶ˆæ¯ç³»ç»Ÿã€èŠå¤©æ¨¡å‹ã€å·¥å…·ç»‘å®šå’Œå·¥å…·æ‰§è¡Œã€‚é€šè¿‡æœ¬æ•™ç¨‹ï¼Œä½ å°†æŒæ¡å¦‚ä½•ä½¿ç”¨ LangChain çš„åŸºç¡€æ¦‚å¿µæ„å»ºä¸€ä¸ªç®€å•ä½†åŠŸèƒ½å®Œæ•´çš„ AI é“¾ã€‚</p><h2 id="ğŸ¯-æ ¸å¿ƒæ¦‚å¿µ" tabindex="-1">ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ <a class="header-anchor" href="#ğŸ¯-æ ¸å¿ƒæ¦‚å¿µ" aria-label="Permalink to &quot;ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ&quot;">â€‹</a></h2><h3 id="ä»€ä¹ˆæ˜¯-chain" tabindex="-1">ä»€ä¹ˆæ˜¯ Chainï¼Ÿ <a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-chain" aria-label="Permalink to &quot;ä»€ä¹ˆæ˜¯ Chainï¼Ÿ&quot;">â€‹</a></h3><p>åœ¨ LangChain/LangGraph ä¸­ï¼Œ<strong>Chain</strong> æ˜¯ä¸€ç³»åˆ—æŒ‰é¡ºåºæ‰§è¡Œçš„æ“ä½œç»„åˆã€‚ä¸€ä¸ªç®€å•çš„ Chain é€šå¸¸åŒ…å«ï¼š</p><ol><li><strong>è¾“å…¥å¤„ç†</strong>ï¼šæ¥æ”¶ç”¨æˆ·æ¶ˆæ¯</li><li><strong>æ¨¡å‹è°ƒç”¨</strong>ï¼šä½¿ç”¨ LLM ç”Ÿæˆå“åº”</li><li><strong>å·¥å…·æ‰§è¡Œ</strong>ï¼ˆå¯é€‰ï¼‰ï¼šè°ƒç”¨å¤–éƒ¨å·¥å…·/å‡½æ•°</li><li><strong>è¾“å‡ºè¿”å›</strong>ï¼šè¿”å›æœ€ç»ˆç»“æœ</li></ol><h3 id="æœ¬æ•™ç¨‹çš„å››å¤§æ ¸å¿ƒæ¦‚å¿µ" tabindex="-1">æœ¬æ•™ç¨‹çš„å››å¤§æ ¸å¿ƒæ¦‚å¿µ <a class="header-anchor" href="#æœ¬æ•™ç¨‹çš„å››å¤§æ ¸å¿ƒæ¦‚å¿µ" aria-label="Permalink to &quot;æœ¬æ•™ç¨‹çš„å››å¤§æ ¸å¿ƒæ¦‚å¿µ&quot;">â€‹</a></h3><ol><li><strong>æ¶ˆæ¯ï¼ˆMessagesï¼‰</strong>ï¼šä½¿ç”¨èŠå¤©æ¶ˆæ¯ä½œä¸ºå›¾çŠ¶æ€</li><li><strong>èŠå¤©æ¨¡å‹ï¼ˆChat Modelsï¼‰</strong>ï¼šåœ¨å›¾èŠ‚ç‚¹ä¸­ä½¿ç”¨ LLM</li><li><strong>å·¥å…·ç»‘å®šï¼ˆTool Bindingï¼‰</strong>ï¼šä¸ºèŠå¤©æ¨¡å‹ç»‘å®šå·¥å…·</li><li><strong>å·¥å…·æ‰§è¡Œï¼ˆTool Callingï¼‰</strong>ï¼šåœ¨å›¾èŠ‚ç‚¹ä¸­æ‰§è¡Œå·¥å…·è°ƒç”¨</li></ol><h3 id="ç³»ç»Ÿæ¶æ„å›¾" tabindex="-1">ç³»ç»Ÿæ¶æ„å›¾ <a class="header-anchor" href="#ç³»ç»Ÿæ¶æ„å›¾" aria-label="Permalink to &quot;ç³»ç»Ÿæ¶æ„å›¾&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç”¨æˆ·è¾“å…¥ &quot;Multiply 2 and 3&quot;</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>   [tool_calling_llm]</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>   æ£€æµ‹åˆ°éœ€è¦è°ƒç”¨å·¥å…·</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>   è¿”å›å·¥å…·è°ƒç”¨ä¿¡æ¯</span></span>
<span class="line"><span>   (å·¥å…·å: multiply, å‚æ•°: {a:2, b:3})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><hr><h2 id="ğŸ”§-ä»£ç å®ç°è¯¦è§£" tabindex="-1">ğŸ”§ ä»£ç å®ç°è¯¦è§£ <a class="header-anchor" href="#ğŸ”§-ä»£ç å®ç°è¯¦è§£" aria-label="Permalink to &quot;ğŸ”§ ä»£ç å®ç°è¯¦è§£&quot;">â€‹</a></h2><h3 id="_1-æ¶ˆæ¯ç³»ç»Ÿ-messages" tabindex="-1">1. æ¶ˆæ¯ç³»ç»Ÿï¼ˆMessagesï¼‰ <a class="header-anchor" href="#_1-æ¶ˆæ¯ç³»ç»Ÿ-messages" aria-label="Permalink to &quot;1. æ¶ˆæ¯ç³»ç»Ÿï¼ˆMessagesï¼‰&quot;">â€‹</a></h3><h4 id="ä»€ä¹ˆæ˜¯æ¶ˆæ¯" tabindex="-1">ä»€ä¹ˆæ˜¯æ¶ˆæ¯ï¼Ÿ <a class="header-anchor" href="#ä»€ä¹ˆæ˜¯æ¶ˆæ¯" aria-label="Permalink to &quot;ä»€ä¹ˆæ˜¯æ¶ˆæ¯ï¼Ÿ&quot;">â€‹</a></h4><p>èŠå¤©æ¨¡å‹ä½¿ç”¨ <strong>æ¶ˆæ¯ï¼ˆMessagesï¼‰</strong> æ¥è¡¨ç¤ºå¯¹è¯ä¸­çš„ä¸åŒè§’è‰²ã€‚LangChain æ”¯æŒå¤šç§æ¶ˆæ¯ç±»å‹ï¼š</p><table tabindex="0"><thead><tr><th>æ¶ˆæ¯ç±»å‹</th><th>è§’è‰²</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><code>HumanMessage</code></td><td>ç”¨æˆ·</td><td>è¡¨ç¤ºç”¨æˆ·è¾“å…¥</td></tr><tr><td><code>AIMessage</code></td><td>AI æ¨¡å‹</td><td>è¡¨ç¤ºæ¨¡å‹å“åº”</td></tr><tr><td><code>SystemMessage</code></td><td>ç³»ç»Ÿ</td><td>æŒ‡å¯¼æ¨¡å‹è¡Œä¸º</td></tr><tr><td><code>ToolMessage</code></td><td>å·¥å…·</td><td>å·¥å…·è°ƒç”¨çš„ç»“æœ</td></tr></tbody></table><h4 id="æ¶ˆæ¯çš„ç»„æˆéƒ¨åˆ†" tabindex="-1">æ¶ˆæ¯çš„ç»„æˆéƒ¨åˆ† <a class="header-anchor" href="#æ¶ˆæ¯çš„ç»„æˆéƒ¨åˆ†" aria-label="Permalink to &quot;æ¶ˆæ¯çš„ç»„æˆéƒ¨åˆ†&quot;">â€‹</a></h4><p>æ¯ä¸ªæ¶ˆæ¯å¯ä»¥åŒ…å«ï¼š</p><ul><li><strong><code>content</code></strong>ï¼ˆå¿…éœ€ï¼‰ï¼šæ¶ˆæ¯å†…å®¹</li><li><strong><code>name</code></strong>ï¼ˆå¯é€‰ï¼‰ï¼šæ¶ˆæ¯å‘é€è€…çš„åå­—</li><li><strong><code>response_metadata</code></strong>ï¼ˆå¯é€‰ï¼‰ï¼šå…ƒæ•°æ®å­—å…¸ï¼ˆå¦‚æ¨¡å‹å“åº”ä¿¡æ¯ï¼‰</li></ul><h4 id="ä»£ç ç¤ºä¾‹" tabindex="-1">ä»£ç ç¤ºä¾‹ <a class="header-anchor" href="#ä»£ç ç¤ºä¾‹" aria-label="Permalink to &quot;ä»£ç ç¤ºä¾‹&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langchain_core.messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AIMessage, HumanMessage</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆ›å»ºæ¶ˆæ¯åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AIMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;So you said you were researching ocean mammals?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Model&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Yes, that&#39;s right.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Lance&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AIMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Great, what would you like to learn about.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Model&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I want to learn about the best place to see Orcas in the US.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Lance&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ‰“å°æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> messages:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    m.pretty_print()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>è¾“å‡ºï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>================================== Ai Message ==================================</span></span>
<span class="line"><span>Name: Model</span></span>
<span class="line"><span>So you said you were researching ocean mammals?</span></span>
<span class="line"><span></span></span>
<span class="line"><span>================================ Human Message =================================</span></span>
<span class="line"><span>Name: Lance</span></span>
<span class="line"><span>Yes, that&#39;s right.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>Python çŸ¥è¯†ç‚¹ï¼šfor å¾ªç¯ä¸æ–¹æ³•è°ƒç”¨</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> messages:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    m.pretty_print()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>for m in messages</code>ï¼šéå† <code>messages</code> åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ </li><li><code>m.pretty_print()</code>ï¼šè°ƒç”¨æ¯ä¸ªæ¶ˆæ¯å¯¹è±¡çš„ <code>pretty_print()</code> æ–¹æ³•</li><li>è¿™æ˜¯ Python é¢å‘å¯¹è±¡ç¼–ç¨‹çš„å…¸å‹ç”¨æ³•</li></ul><hr><h3 id="_2-èŠå¤©æ¨¡å‹-chat-models" tabindex="-1">2. èŠå¤©æ¨¡å‹ï¼ˆChat Modelsï¼‰ <a class="header-anchor" href="#_2-èŠå¤©æ¨¡å‹-chat-models" aria-label="Permalink to &quot;2. èŠå¤©æ¨¡å‹ï¼ˆChat Modelsï¼‰&quot;">â€‹</a></h3><h4 id="ä»€ä¹ˆæ˜¯èŠå¤©æ¨¡å‹" tabindex="-1">ä»€ä¹ˆæ˜¯èŠå¤©æ¨¡å‹ï¼Ÿ <a class="header-anchor" href="#ä»€ä¹ˆæ˜¯èŠå¤©æ¨¡å‹" aria-label="Permalink to &quot;ä»€ä¹ˆæ˜¯èŠå¤©æ¨¡å‹ï¼Ÿ&quot;">â€‹</a></h4><p><strong>èŠå¤©æ¨¡å‹</strong> æ˜¯æ”¯æŒå¯¹è¯å¼äº¤äº’çš„ LLMï¼Œå¯ä»¥ï¼š</p><ul><li>æ¥æ”¶æ¶ˆæ¯åˆ—è¡¨ä½œä¸ºè¾“å…¥</li><li>ç†è§£å¯¹è¯ä¸Šä¸‹æ–‡</li><li>ç”Ÿæˆç¬¦åˆè§’è‰²çš„å›å¤</li></ul><p>LangChain æ”¯æŒå¤šç§èŠå¤©æ¨¡å‹æä¾›å•†ï¼šOpenAIã€Anthropicã€Googleã€Ollama ç­‰ã€‚</p><h4 id="è®¾ç½®-api-key" tabindex="-1">è®¾ç½® API Key <a class="header-anchor" href="#è®¾ç½®-api-key" aria-label="Permalink to &quot;è®¾ç½® API Key&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os, getpass</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _set_env</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(var: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os.environ.get(var):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        os.environ[var] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> getpass.getpass(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">var</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_set_env(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;OPENAI_API_KEY&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>Python çŸ¥è¯†ç‚¹ï¼šç¯å¢ƒå˜é‡ä¸å®‰å…¨æ€§</strong></p><ul><li><code>os.environ.get(var)</code>ï¼šè·å–ç¯å¢ƒå˜é‡</li><li><code>getpass.getpass()</code>ï¼šå®‰å…¨åœ°è¾“å…¥å¯†ç ï¼ˆè¾“å…¥ä¸ä¼šæ˜¾ç¤ºï¼‰</li><li>è¿™æ˜¯ä¿æŠ¤ API Key çš„æœ€ä½³å®è·µ</li></ul><h4 id="ä½¿ç”¨èŠå¤©æ¨¡å‹" tabindex="-1">ä½¿ç”¨èŠå¤©æ¨¡å‹ <a class="header-anchor" href="#ä½¿ç”¨èŠå¤©æ¨¡å‹" aria-label="Permalink to &quot;ä½¿ç”¨èŠå¤©æ¨¡å‹&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langchain_openai </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ChatOpenAI</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆå§‹åŒ–æ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">llm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ChatOpenAI(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt-4o&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è°ƒç”¨æ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.invoke(messages)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>è¾“å‡ºç±»å‹ï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># langchain_core.messages.ai.AIMessage</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>result</code> æ˜¯ä¸€ä¸ª <code>AIMessage</code> å¯¹è±¡ï¼ŒåŒ…å«ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result.content  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AI ç”Ÿæˆçš„æ–‡æœ¬å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result.response_metadata  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å“åº”å…ƒæ•°æ®</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="å“åº”å…ƒæ•°æ®è¯¦è§£" tabindex="-1">å“åº”å…ƒæ•°æ®è¯¦è§£ <a class="header-anchor" href="#å“åº”å…ƒæ•°æ®è¯¦è§£" aria-label="Permalink to &quot;å“åº”å…ƒæ•°æ®è¯¦è§£&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result.response_metadata</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>è¾“å‡ºç¤ºä¾‹ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;token_usage&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;completion_tokens&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">228</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¾“å‡ºçš„ token æ•°</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;prompt_tokens&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">67</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¾“å…¥çš„ token æ•°</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;total_tokens&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">295</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æ€» token æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;model_name&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;gpt-4o-2024-08-06&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;finish_reason&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;stop&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åœæ­¢åŸå› ï¼ˆæ­£å¸¸ç»“æŸï¼‰</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;logprobs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">None</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>é‡è¦æ€§ï¼š</strong></p><ul><li>å¯ä»¥è·Ÿè¸ª API ä½¿ç”¨æˆæœ¬</li><li>äº†è§£æ¨¡å‹ç”Ÿæˆçš„è¯¦ç»†ä¿¡æ¯</li><li>è°ƒè¯•å’Œä¼˜åŒ–æ€§èƒ½</li></ul><hr><h3 id="_3-å·¥å…·-tools" tabindex="-1">3. å·¥å…·ï¼ˆToolsï¼‰ <a class="header-anchor" href="#_3-å·¥å…·-tools" aria-label="Permalink to &quot;3. å·¥å…·ï¼ˆToolsï¼‰&quot;">â€‹</a></h3><h4 id="ä»€ä¹ˆæ˜¯å·¥å…·" tabindex="-1">ä»€ä¹ˆæ˜¯å·¥å…·ï¼Ÿ <a class="header-anchor" href="#ä»€ä¹ˆæ˜¯å·¥å…·" aria-label="Permalink to &quot;ä»€ä¹ˆæ˜¯å·¥å…·ï¼Ÿ&quot;">â€‹</a></h4><p><strong>å·¥å…·ï¼ˆToolsï¼‰</strong> å…è®¸ LLM ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’ã€‚å½“ä½ éœ€è¦ï¼š</p><ul><li>è°ƒç”¨ API</li><li>æ‰§è¡Œè®¡ç®—</li><li>æŸ¥è¯¢æ•°æ®åº“</li><li>è®¿é—®å¤–éƒ¨æœåŠ¡</li></ul><p>ä½ å¯ä»¥å°†è¿™äº›åŠŸèƒ½å®šä¹‰ä¸º&quot;å·¥å…·&quot;ï¼Œè®©æ¨¡å‹çŸ¥é“ä½•æ—¶ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚</p><h4 id="å·¥å…·çš„å·¥ä½œåŸç†" tabindex="-1">å·¥å…·çš„å·¥ä½œåŸç† <a class="header-anchor" href="#å·¥å…·çš„å·¥ä½œåŸç†" aria-label="Permalink to &quot;å·¥å…·çš„å·¥ä½œåŸç†&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ç”¨æˆ·è¾“å…¥ï¼ˆè‡ªç„¶è¯­è¨€ï¼‰</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>   LLM åˆ†æè¾“å…¥</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>   å†³å®šæ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>   è¿”å›ç¬¦åˆå·¥å…· schema çš„è°ƒç”¨ä¿¡æ¯</span></span>
<span class="line"><span>   (åŒ…å«å·¥å…·åç§°å’Œå‚æ•°)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="å®šä¹‰å·¥å…·" tabindex="-1">å®šä¹‰å·¥å…· <a class="header-anchor" href="#å®šä¹‰å·¥å…·" aria-label="Permalink to &quot;å®šä¹‰å·¥å…·&quot;">â€‹</a></h4><p>åœ¨ LangChain ä¸­ï¼Œ<strong>ä»»ä½• Python å‡½æ•°éƒ½å¯ä»¥ä½œä¸ºå·¥å…·</strong>ï¼</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> multiply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, b: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;Multiply a and b.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Args:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        a: first int</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        b: second int</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>å…³é”®è¦ç‚¹ï¼š</strong></p><ol><li><strong>ç±»å‹æ³¨è§£</strong>ï¼š<code>a: int, b: int -&gt; int</code> è®©æ¨¡å‹çŸ¥é“å‚æ•°ç±»å‹</li><li><strong>æ–‡æ¡£å­—ç¬¦ä¸²</strong>ï¼šæè¿°å‡½æ•°çš„åŠŸèƒ½ï¼Œå¸®åŠ©æ¨¡å‹ç†è§£ä½•æ—¶ä½¿ç”¨</li></ol><p><strong>Python çŸ¥è¯†ç‚¹ï¼šç±»å‹æ³¨è§£ï¼ˆType Hintsï¼‰</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> multiply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, b: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #          ^^^^^^  ^^^^^^    ^^^</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #          å‚æ•°a   å‚æ•°b     è¿”å›å€¼</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #          æ˜¯int   æ˜¯int     æ˜¯int</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ç±»å‹æ³¨è§£çš„ä½œç”¨ï¼š</p><ul><li>æä¾› IDE ä»£ç æç¤º</li><li>å¸®åŠ© LangChain ç”Ÿæˆå·¥å…· schema</li><li>æé«˜ä»£ç å¯è¯»æ€§</li><li><strong>ä¸å¼ºåˆ¶æ‰§è¡Œ</strong>ï¼ˆPython ä»ç„¶æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ï¼‰</li></ul><h4 id="ç»‘å®šå·¥å…·åˆ°æ¨¡å‹" tabindex="-1">ç»‘å®šå·¥å…·åˆ°æ¨¡å‹ <a class="header-anchor" href="#ç»‘å®šå·¥å…·åˆ°æ¨¡å‹" aria-label="Permalink to &quot;ç»‘å®šå·¥å…·åˆ°æ¨¡å‹&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">llm_with_tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.bind_tools([multiply])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</strong></p><ul><li><code>bind_tools()</code> å‘Šè¯‰æ¨¡å‹ï¼š&quot;ä½ å¯ä»¥è°ƒç”¨è¿™äº›å·¥å…·&quot;</li><li>LangChain è‡ªåŠ¨ä»å‡½æ•°ç­¾åç”Ÿæˆå·¥å…· schema</li><li>æ¨¡å‹ç°åœ¨çŸ¥é“ <code>multiply</code> å·¥å…·çš„å­˜åœ¨ã€å‚æ•°å’Œç”¨é€”</li></ul><h4 id="å·¥å…·è°ƒç”¨ç¤ºä¾‹" tabindex="-1">å·¥å…·è°ƒç”¨ç¤ºä¾‹ <a class="header-anchor" href="#å·¥å…·è°ƒç”¨ç¤ºä¾‹" aria-label="Permalink to &quot;å·¥å…·è°ƒç”¨ç¤ºä¾‹&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_call </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm_with_tools.invoke([</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is 2 multiplied by 3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Lance&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_call.tool_calls</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>è¾“å‡ºï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;name&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;multiply&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å·¥å…·åç§°</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;args&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;a&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;b&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å·¥å…·å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;call_lBBBNo5oYpHGRqwxNaNRbsiT&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è°ƒç”¨ ID</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;tool_call&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             # ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>é‡è¦ç†è§£ï¼š</strong></p><ul><li>LLM <strong>å¹¶æ²¡æœ‰çœŸæ­£æ‰§è¡Œ</strong> <code>multiply(2, 3)</code></li><li>å®ƒåªæ˜¯ <strong>è¿”å›äº†è°ƒç”¨ä¿¡æ¯</strong></li><li>å®é™…æ‰§è¡Œéœ€è¦åœ¨åç»­æ­¥éª¤ä¸­å¤„ç†</li></ul><hr><h3 id="_4-ä½¿ç”¨æ¶ˆæ¯ä½œä¸ºçŠ¶æ€-messages-as-state" tabindex="-1">4. ä½¿ç”¨æ¶ˆæ¯ä½œä¸ºçŠ¶æ€ï¼ˆMessages as Stateï¼‰ <a class="header-anchor" href="#_4-ä½¿ç”¨æ¶ˆæ¯ä½œä¸ºçŠ¶æ€-messages-as-state" aria-label="Permalink to &quot;4. ä½¿ç”¨æ¶ˆæ¯ä½œä¸ºçŠ¶æ€ï¼ˆMessages as Stateï¼‰&quot;">â€‹</a></h3><h4 id="ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯ä½œä¸ºçŠ¶æ€" tabindex="-1">ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯ä½œä¸ºçŠ¶æ€ï¼Ÿ <a class="header-anchor" href="#ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯ä½œä¸ºçŠ¶æ€" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯ä½œä¸ºçŠ¶æ€ï¼Ÿ&quot;">â€‹</a></h4><p>åœ¨å¯¹è¯ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p><ul><li>ä¿å­˜å¯¹è¯å†å²</li><li>è¿½è¸ªå¤šè½®äº¤äº’</li><li>ä¼ é€’ä¸Šä¸‹æ–‡ä¿¡æ¯</li></ul><p>ä½¿ç”¨ <strong>æ¶ˆæ¯åˆ—è¡¨</strong> ä½œä¸ºå›¾çŠ¶æ€æ˜¯æœ€è‡ªç„¶çš„æ–¹å¼ã€‚</p><h4 id="å®šä¹‰çŠ¶æ€" tabindex="-1">å®šä¹‰çŠ¶æ€ <a class="header-anchor" href="#å®šä¹‰çŠ¶æ€" aria-label="Permalink to &quot;å®šä¹‰çŠ¶æ€&quot;">â€‹</a></h4><p><strong>æ–¹æ³• 1ï¼šæ‰‹åŠ¨å®šä¹‰</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> typing_extensions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TypedDict</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langchain_core.messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AnyMessage</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MessagesState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages: list[AnyMessage]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>Python çŸ¥è¯†ç‚¹ï¼šTypedDict</strong></p><p><code>TypedDict</code> æ˜¯ Python çš„ç±»å‹æ³¨è§£å·¥å…·ï¼Œç”¨äºå®šä¹‰å­—å…¸çš„ç»“æ„ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MessagesState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages: list[AnyMessage]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #         ^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #         å€¼çš„ç±»å‹ï¼šAnyMessage å¯¹è±¡çš„åˆ—è¡¨</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>ä¼˜åŠ¿ï¼š</strong></p><ul><li>æä¾› IDE ç±»å‹æ£€æŸ¥å’Œè‡ªåŠ¨è¡¥å…¨</li><li>æ¸…æ™°åœ°å®šä¹‰æ•°æ®ç»“æ„</li><li>ä¸å½±å“è¿è¡Œæ—¶æ€§èƒ½ï¼ˆä»…ç”¨äºé™æ€åˆ†æï¼‰</li></ul><hr><h3 id="_5-reducers-å½’çº¦å™¨-â­" tabindex="-1">5. Reducersï¼ˆå½’çº¦å™¨ï¼‰â­ <a class="header-anchor" href="#_5-reducers-å½’çº¦å™¨-â­" aria-label="Permalink to &quot;5. Reducersï¼ˆå½’çº¦å™¨ï¼‰â­&quot;">â€‹</a></h3><h4 id="é—®é¢˜-çŠ¶æ€è¦†ç›–" tabindex="-1">é—®é¢˜ï¼šçŠ¶æ€è¦†ç›– <a class="header-anchor" href="#é—®é¢˜-çŠ¶æ€è¦†ç›–" aria-label="Permalink to &quot;é—®é¢˜ï¼šçŠ¶æ€è¦†ç›–&quot;">â€‹</a></h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒèŠ‚ç‚¹è¿”å›çš„æ–°å€¼ä¼š <strong>è¦†ç›–</strong> æ—§å€¼ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆå§‹çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [message1, message2]}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># èŠ‚ç‚¹è¿”å›</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">node_output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [message3]}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç»“æœï¼šmessage1 å’Œ message2 è¢«ä¸¢å¼ƒï¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">new_state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [message3]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼</strong> æˆ‘ä»¬å¸Œæœ› <strong>è¿½åŠ </strong> æ¶ˆæ¯ï¼Œè€Œä¸æ˜¯è¦†ç›–ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-add-messages-reducer" tabindex="-1">è§£å†³æ–¹æ¡ˆï¼šadd_messages Reducer <a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ-add-messages-reducer" aria-label="Permalink to &quot;è§£å†³æ–¹æ¡ˆï¼šadd_messages Reducer&quot;">â€‹</a></h4><p><strong>Reducer</strong> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ŒæŒ‡å®šå¦‚ä½•æ›´æ–°çŠ¶æ€ã€‚</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> typing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Annotated</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langgraph.graph.message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> add_messages</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MessagesState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages: Annotated[list[AnyMessage], add_messages]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #         ^^^^^^^^^                   ^^^^^^^^^^^^^</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #         åŸºç¡€ç±»å‹                    Reducer å‡½æ•°</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>Python çŸ¥è¯†ç‚¹ï¼šAnnotated</strong></p><p><code>Annotated</code> æ˜¯ Python 3.9+ å¼•å…¥çš„ç±»å‹æ³¨è§£å¢å¼ºå·¥å…·ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> typing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Annotated</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Annotated[ç±»å‹, å…ƒæ•°æ®1, å…ƒæ•°æ®2, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#         ^^^^  ^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#         åŸºç¡€  é¢å¤–ä¿¡æ¯ï¼ˆä¸å½±å“ç±»å‹æ£€æŸ¥ï¼‰</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>åœ¨ LangGraph ä¸­ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">messages: Annotated[list[AnyMessage], add_messages]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#                   ^^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#                   ç±»å‹ï¼šæ¶ˆæ¯åˆ—è¡¨      å…ƒæ•°æ®ï¼šreducer å‡½æ•°</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>LangGraph ä¼šè¯»å–è¿™ä¸ªå…ƒæ•°æ®ï¼ŒçŸ¥é“åº”è¯¥ä½¿ç”¨ <code>add_messages</code> æ¥æ›´æ–°çŠ¶æ€ã€‚</p><h4 id="add-messages-çš„å·¥ä½œåŸç†" tabindex="-1">add_messages çš„å·¥ä½œåŸç† <a class="header-anchor" href="#add-messages-çš„å·¥ä½œåŸç†" aria-label="Permalink to &quot;add_messages çš„å·¥ä½œåŸç†&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langgraph.graph.message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> add_messages</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆå§‹æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">initial </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AIMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello! How can I assist you?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Model&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I&#39;m looking for information on marine biology.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Lance&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ–°æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">new_message </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AIMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Sure, I can help with that.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Model&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨ add_messages</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> add_messages(initial, new_message)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç»“æœï¼š[message1, message2, message3]  â† è¿½åŠ ï¼Œä¸è¦†ç›–ï¼</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>add_messages çš„ç‰¹æ€§ï¼š</strong></p><ol><li>è‡ªåŠ¨è¿½åŠ æ–°æ¶ˆæ¯åˆ°åˆ—è¡¨æœ«å°¾</li><li>æ”¯æŒå•ä¸ªæ¶ˆæ¯æˆ–æ¶ˆæ¯åˆ—è¡¨</li><li>å¤„ç†æ¶ˆæ¯å»é‡ï¼ˆåŸºäº IDï¼‰</li><li>æ˜¯ LangGraph å†…ç½®çš„ reducer</li></ol><hr><h3 id="_6-ä½¿ç”¨-messagesstate-æ¨èæ–¹å¼" tabindex="-1">6. ä½¿ç”¨ MessagesStateï¼ˆæ¨èæ–¹å¼ï¼‰ <a class="header-anchor" href="#_6-ä½¿ç”¨-messagesstate-æ¨èæ–¹å¼" aria-label="Permalink to &quot;6. ä½¿ç”¨ MessagesStateï¼ˆæ¨èæ–¹å¼ï¼‰&quot;">â€‹</a></h3><p>ç”±äº&quot;æ¶ˆæ¯åˆ—è¡¨&quot;æ˜¯å¦‚æ­¤å¸¸è§çš„çŠ¶æ€ç»“æ„ï¼ŒLangGraph æä¾›äº†é¢„æ„å»ºçš„ <code>MessagesState</code>ï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langgraph.graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MessagesState</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MessagesState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MessagesState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å¦‚æœéœ€è¦é¢å¤–å­—æ®µï¼Œåœ¨è¿™é‡Œæ·»åŠ </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    pass</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>é¢„æ„å»ºçš„ MessagesState åŒ…å«ï¼š</strong></p><ul><li><code>messages</code> å­—æ®µï¼š<code>list[AnyMessage]</code></li><li>è‡ªåŠ¨ä½¿ç”¨ <code>add_messages</code> reducer</li><li>æ— éœ€æ‰‹åŠ¨å®šä¹‰</li></ul><p><strong>å¦‚æœéœ€è¦é¢å¤–å­—æ®µï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ExtendedState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MessagesState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user_id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    session_id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # messages å­—æ®µå·²ç»è‡ªåŠ¨åŒ…å«</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><hr><h3 id="_7-æ„å»ºå›¾" tabindex="-1">7. æ„å»ºå›¾ <a class="header-anchor" href="#_7-æ„å»ºå›¾" aria-label="Permalink to &quot;7. æ„å»ºå›¾&quot;">â€‹</a></h3><p>ç°åœ¨æˆ‘ä»¬æœ‰äº†æ‰€æœ‰ç»„ä»¶ï¼Œå¯ä»¥æ„å»ºå›¾äº†ï¼</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langgraph.graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StateGraph, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">START</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">END</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®šä¹‰èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tool_calling_llm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesState):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [llm_with_tools.invoke(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])]}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ„å»ºå›¾</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StateGraph(MessagesState)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tool_calling_llm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, tool_calling_llm)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">START</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tool_calling_llm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tool_calling_llm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder.compile()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="ä»£ç è¯¦è§£" tabindex="-1">ä»£ç è¯¦è§£ <a class="header-anchor" href="#ä»£ç è¯¦è§£" aria-label="Permalink to &quot;ä»£ç è¯¦è§£&quot;">â€‹</a></h4><p><strong>1. å®šä¹‰èŠ‚ç‚¹å‡½æ•°</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tool_calling_llm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesState):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #                  ^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #                  è¾“å…¥ï¼šå½“å‰å›¾çŠ¶æ€</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm_with_tools.invoke(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #        è°ƒç”¨ LLMï¼Œä¼ å…¥å¯¹è¯å†å²</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [result]}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #      ^^^^^^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #      è¿”å›æ–°æ¶ˆæ¯ï¼ˆä¼šè¢« add_messages è¿½åŠ ï¼‰</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>2. åˆ›å»ºå›¾</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StateGraph(MessagesState)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#                    ^^^^^^^^^^^^^^</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#                    æŒ‡å®šçŠ¶æ€ç±»å‹</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>3. æ·»åŠ èŠ‚ç‚¹</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tool_calling_llm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, tool_calling_llm)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#                ^^^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#                èŠ‚ç‚¹åç§°            èŠ‚ç‚¹å‡½æ•°</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>4. æ·»åŠ è¾¹</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">START</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tool_calling_llm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#                ^^^^^  ^^^^^^^^^^^^^^^^^^</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#                èµ·ç‚¹    ç›®æ ‡èŠ‚ç‚¹</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tool_calling_llm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#                ^^^^^^^^^^^^^^^^^^  ^^^</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#                æºèŠ‚ç‚¹              ç»ˆç‚¹</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>LangGraph çŸ¥è¯†ç‚¹ï¼šSTART å’Œ END</strong></p><ul><li><code>START</code>ï¼šç‰¹æ®ŠèŠ‚ç‚¹ï¼Œè¡¨ç¤ºå›¾çš„å…¥å£</li><li><code>END</code>ï¼šç‰¹æ®ŠèŠ‚ç‚¹ï¼Œè¡¨ç¤ºå›¾çš„å‡ºå£</li><li>ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯å¸¸é‡æ ‡è¯†ç¬¦</li></ul><p><strong>5. ç¼–è¯‘å›¾</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder.compile()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>ç¼–è¯‘åçš„å›¾å¯ä»¥æ‰§è¡Œï¼ˆinvokeã€stream ç­‰ï¼‰ã€‚</p><h4 id="å›¾çš„å¯è§†åŒ–" tabindex="-1">å›¾çš„å¯è§†åŒ– <a class="header-anchor" href="#å›¾çš„å¯è§†åŒ–" aria-label="Permalink to &quot;å›¾çš„å¯è§†åŒ–&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IPython.display </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Image, display</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">display(Image(graph.get_graph().draw_mermaid_png()))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¾“å‡ºï¼š</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>    â”‚ __start__ â”‚</span></span>
<span class="line"><span>    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>          â”‚</span></span>
<span class="line"><span>          â†“</span></span>
<span class="line"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>â”‚ tool_calling_llm â”‚</span></span>
<span class="line"><span>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span>
<span class="line"><span>          â”‚</span></span>
<span class="line"><span>          â†“</span></span>
<span class="line"><span>    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span>
<span class="line"><span>    â”‚ __end__  â”‚</span></span>
<span class="line"><span>    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><hr><h3 id="_8-æ‰§è¡Œå›¾" tabindex="-1">8. æ‰§è¡Œå›¾ <a class="header-anchor" href="#_8-æ‰§è¡Œå›¾" aria-label="Permalink to &quot;8. æ‰§è¡Œå›¾&quot;">â€‹</a></h3><h4 id="åœºæ™¯-1-æ™®é€šå¯¹è¯" tabindex="-1">åœºæ™¯ 1ï¼šæ™®é€šå¯¹è¯ <a class="header-anchor" href="#åœºæ™¯-1-æ™®é€šå¯¹è¯" aria-label="Permalink to &quot;åœºæ™¯ 1ï¼šæ™®é€šå¯¹è¯&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.invoke({</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> messages[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;messages&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    m.pretty_print()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>è¾“å‡ºï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>================================ Human Message =================================</span></span>
<span class="line"><span>Hello!</span></span>
<span class="line"><span></span></span>
<span class="line"><span>================================== Ai Message ==================================</span></span>
<span class="line"><span>Hi there! How can I assist you today?</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>åˆ†æï¼š</strong></p><ul><li>è¾“å…¥ä¸éœ€è¦å·¥å…·ï¼ŒLLM ç›´æ¥å›å¤</li><li>æ²¡æœ‰å·¥å…·è°ƒç”¨ä¿¡æ¯</li></ul><h4 id="åœºæ™¯-2-å·¥å…·è°ƒç”¨" tabindex="-1">åœºæ™¯ 2ï¼šå·¥å…·è°ƒç”¨ <a class="header-anchor" href="#åœºæ™¯-2-å·¥å…·è°ƒç”¨" aria-label="Permalink to &quot;åœºæ™¯ 2ï¼šå·¥å…·è°ƒç”¨&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.invoke({</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Multiply 2 and 3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> messages[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;messages&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    m.pretty_print()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>è¾“å‡ºï¼š</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>================================ Human Message =================================</span></span>
<span class="line"><span>Multiply 2 and 3</span></span>
<span class="line"><span></span></span>
<span class="line"><span>================================== Ai Message ==================================</span></span>
<span class="line"><span>Tool Calls:</span></span>
<span class="line"><span>  multiply (call_Er4gChFoSGzU7lsuaGzfSGTQ)</span></span>
<span class="line"><span> Call ID: call_Er4gChFoSGzU7lsuaGzfSGTQ</span></span>
<span class="line"><span>  Args:</span></span>
<span class="line"><span>    a: 2</span></span>
<span class="line"><span>    b: 3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>åˆ†æï¼š</strong></p><ul><li>LLM è¯†åˆ«å‡ºéœ€è¦ä½¿ç”¨ <code>multiply</code> å·¥å…·</li><li>è¿”å›å·¥å…·è°ƒç”¨ä¿¡æ¯ï¼Œä½† <strong>å°šæœªæ‰§è¡Œ</strong></li><li>å‚æ•° <code>a=2, b=3</code> ä»è‡ªç„¶è¯­è¨€ä¸­æå–</li></ul><hr><h2 id="ğŸ“-æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“" tabindex="-1">ğŸ“ æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“ <a class="header-anchor" href="#ğŸ“-æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“" aria-label="Permalink to &quot;ğŸ“ æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“&quot;">â€‹</a></h2><h3 id="langgraph-langchain-ç‰¹æœ‰æ¦‚å¿µ" tabindex="-1">LangGraph/LangChain ç‰¹æœ‰æ¦‚å¿µ <a class="header-anchor" href="#langgraph-langchain-ç‰¹æœ‰æ¦‚å¿µ" aria-label="Permalink to &quot;LangGraph/LangChain ç‰¹æœ‰æ¦‚å¿µ&quot;">â€‹</a></h3><h4 id="_1-æ¶ˆæ¯ç³»ç»Ÿ" tabindex="-1">1. æ¶ˆæ¯ç³»ç»Ÿ <a class="header-anchor" href="#_1-æ¶ˆæ¯ç³»ç»Ÿ" aria-label="Permalink to &quot;1. æ¶ˆæ¯ç³»ç»Ÿ&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>æ¶ˆæ¯ç±»å‹</th><th>ç”¨é€”</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>HumanMessage</code></td><td>ç”¨æˆ·è¾“å…¥</td><td><code>HumanMessage(content=&quot;Hi&quot;)</code></td></tr><tr><td><code>AIMessage</code></td><td>æ¨¡å‹è¾“å‡º</td><td><code>AIMessage(content=&quot;Hello!&quot;)</code></td></tr><tr><td><code>SystemMessage</code></td><td>ç³»ç»ŸæŒ‡ä»¤</td><td><code>SystemMessage(content=&quot;You are helpful&quot;)</code></td></tr><tr><td><code>ToolMessage</code></td><td>å·¥å…·ç»“æœ</td><td><code>ToolMessage(content=&quot;6&quot;, tool_call_id=&quot;...&quot;)</code></td></tr></tbody></table><h4 id="_2-å·¥å…·ç»‘å®š" tabindex="-1">2. å·¥å…·ç»‘å®š <a class="header-anchor" href="#_2-å·¥å…·ç»‘å®š" aria-label="Permalink to &quot;2. å·¥å…·ç»‘å®š&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®šä¹‰å·¥å…·ï¼ˆæ™®é€š Python å‡½æ•°ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> multiply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(a: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, b: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;Multiply two numbers&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç»‘å®šåˆ°æ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">llm_with_tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.bind_tools([multiply])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>å…³é”®ç‚¹ï¼š</strong></p><ul><li>å‡½æ•°ç­¾å â†’ è‡ªåŠ¨ç”Ÿæˆå·¥å…· schema</li><li>æ–‡æ¡£å­—ç¬¦ä¸² â†’ å¸®åŠ©æ¨¡å‹ç†è§£ç”¨é€”</li><li>ç±»å‹æ³¨è§£ â†’ å®šä¹‰å‚æ•°å’Œè¿”å›å€¼ç±»å‹</li></ul><h4 id="_3-reducers" tabindex="-1">3. Reducers <a class="header-anchor" href="#_3-reducers" aria-label="Permalink to &quot;3. Reducers&quot;">â€‹</a></h4><p><strong>ä½œç”¨ï¼š</strong> æ§åˆ¶çŠ¶æ€æ›´æ–°æ–¹å¼</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é»˜è®¤è¡Œä¸ºï¼šè¦†ç›–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">messages: list[AnyMessage]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨ reducerï¼šè¿½åŠ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">messages: Annotated[list[AnyMessage], add_messages]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>å¸¸ç”¨ reducersï¼š</strong></p><ul><li><code>add_messages</code>ï¼šè¿½åŠ æ¶ˆæ¯ï¼ˆå»é‡ï¼‰</li><li><code>operator.add</code>ï¼šåˆ—è¡¨æ‹¼æ¥</li><li>è‡ªå®šä¹‰å‡½æ•°ï¼šå®Œå…¨æ§åˆ¶æ›´æ–°é€»è¾‘</li></ul><h4 id="_4-å›¾çš„æ„å»ºæ¨¡å¼" tabindex="-1">4. å›¾çš„æ„å»ºæ¨¡å¼ <a class="header-anchor" href="#_4-å›¾çš„æ„å»ºæ¨¡å¼" aria-label="Permalink to &quot;4. å›¾çš„æ„å»ºæ¨¡å¼&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. åˆ›å»ºå›¾</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StateGraph(StateClass)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. æ·»åŠ èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, node_function)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. æ·»åŠ è¾¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">START</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. ç¼–è¯‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder.compile()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 5. æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.invoke(initial_state)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="python-ç‰¹æœ‰çŸ¥è¯†ç‚¹" tabindex="-1">Python ç‰¹æœ‰çŸ¥è¯†ç‚¹ <a class="header-anchor" href="#python-ç‰¹æœ‰çŸ¥è¯†ç‚¹" aria-label="Permalink to &quot;Python ç‰¹æœ‰çŸ¥è¯†ç‚¹&quot;">â€‹</a></h3><h4 id="_1-typeddict" tabindex="-1">1. TypedDict <a class="header-anchor" href="#_1-typeddict" aria-label="Permalink to &quot;1. TypedDict&quot;">â€‹</a></h4><p><strong>ä½œç”¨ï¼š</strong> å®šä¹‰å­—å…¸çš„ç»“æ„å’Œç±»å‹</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> typing_extensions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TypedDict</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    age: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state: MyState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Alice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li>ä»…ç”¨äºç±»å‹æ£€æŸ¥ï¼ˆé™æ€åˆ†æï¼‰</li><li>è¿è¡Œæ—¶ä»æ˜¯æ™®é€šå­—å…¸</li><li>æä¾› IDE è‡ªåŠ¨è¡¥å…¨</li></ul><h4 id="_2-type-hints-ç±»å‹æ³¨è§£" tabindex="-1">2. Type Hintsï¼ˆç±»å‹æ³¨è§£ï¼‰ <a class="header-anchor" href="#_2-type-hints-ç±»å‹æ³¨è§£" aria-label="Permalink to &quot;2. Type Hintsï¼ˆç±»å‹æ³¨è§£ï¼‰&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> greet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(name: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #         ^^^^^    ^^^^^</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #         å‚æ•°ç±»å‹  è¿”å›å€¼ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>ç”¨é€”ï¼š</strong></p><ul><li>æ–‡æ¡£åŒ–ä»£ç </li><li>IDE æ”¯æŒ</li><li>é™æ€ç±»å‹æ£€æŸ¥ï¼ˆmypyï¼‰</li><li>LangChain å·¥å…· schema ç”Ÿæˆ</li></ul><h4 id="_3-annotated" tabindex="-1">3. Annotated <a class="header-anchor" href="#_3-annotated" aria-label="Permalink to &quot;3. Annotated&quot;">â€‹</a></h4><p><strong>ä½œç”¨ï¼š</strong> ä¸ºç±»å‹æ·»åŠ å…ƒæ•°æ®</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> typing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Annotated</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åŸºç¡€ç±»å‹ + å…ƒæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Age </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Annotated[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Must be positive&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åœ¨ LangGraph ä¸­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">messages: Annotated[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, add_messages]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#                   ^^^^  ^^^^^^^^^^^^^</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#                   ç±»å‹  å…ƒæ•°æ®ï¼ˆreducerï¼‰</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>LangGraph ä½¿ç”¨åœºæ™¯ï¼š</strong></p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> State</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ä¼šè¢«è¦†ç›–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    count: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ä¼šè¢«ç´¯åŠ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    scores: Annotated[list[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], operator.add]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ä¼šè¢«è¿½åŠ ï¼ˆå»é‡ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages: Annotated[list[AnyMessage], add_messages]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_4-ç¯å¢ƒå˜é‡" tabindex="-1">4. ç¯å¢ƒå˜é‡ <a class="header-anchor" href="#_4-ç¯å¢ƒå˜é‡" aria-label="Permalink to &quot;4. ç¯å¢ƒå˜é‡&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è®¾ç½®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">os.environ[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;KEY&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;value&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è·å–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> os.environ.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;KEY&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®‰å…¨è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> getpass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">api_key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> getpass.getpass(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;API Key: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><hr><h2 id="ğŸ’¡-æœ€ä½³å®è·µ" tabindex="-1">ğŸ’¡ æœ€ä½³å®è·µ <a class="header-anchor" href="#ğŸ’¡-æœ€ä½³å®è·µ" aria-label="Permalink to &quot;ğŸ’¡ æœ€ä½³å®è·µ&quot;">â€‹</a></h2><h3 id="_1-æ¶ˆæ¯ç®¡ç†" tabindex="-1">1. æ¶ˆæ¯ç®¡ç† <a class="header-anchor" href="#_1-æ¶ˆæ¯ç®¡ç†" aria-label="Permalink to &quot;1. æ¶ˆæ¯ç®¡ç†&quot;">â€‹</a></h3><h4 id="âœ…-å¥½çš„åšæ³•" tabindex="-1">âœ… å¥½çš„åšæ³• <a class="header-anchor" href="#âœ…-å¥½çš„åšæ³•" aria-label="Permalink to &quot;âœ… å¥½çš„åšæ³•&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ˜ç¡®æŒ‡å®šæ¶ˆæ¯è§’è‰²å’Œåç§°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    SystemMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You are a helpful assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What&#39;s the weather?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;User&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AIMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I&#39;ll check that for you&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="âŒ-é¿å…çš„åšæ³•" tabindex="-1">âŒ é¿å…çš„åšæ³• <a class="header-anchor" href="#âŒ-é¿å…çš„åšæ³•" aria-label="Permalink to &quot;âŒ é¿å…çš„åšæ³•&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä¸è¦æ··ç”¨å­—ç¬¦ä¸²å’Œæ¶ˆæ¯å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é”™è¯¯ï¼</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-å·¥å…·å®šä¹‰" tabindex="-1">2. å·¥å…·å®šä¹‰ <a class="header-anchor" href="#_2-å·¥å…·å®šä¹‰" aria-label="Permalink to &quot;2. å·¥å…·å®šä¹‰&quot;">â€‹</a></h3><h4 id="âœ…-å¥½çš„åšæ³•-1" tabindex="-1">âœ… å¥½çš„åšæ³• <a class="header-anchor" href="#âœ…-å¥½çš„åšæ³•-1" aria-label="Permalink to &quot;âœ… å¥½çš„åšæ³•&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> calculate_discount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(price: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, discount_percent: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;Calculate the discounted price.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Args:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        price: Original price in dollars</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        discount_percent: Discount percentage (0-100)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Returns:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        Final price after discount</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> price </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> discount_percent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li>å®Œæ•´çš„ç±»å‹æ³¨è§£</li><li>è¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²</li><li>æ¸…æ™°çš„å‚æ•°è¯´æ˜</li></ul><h4 id="âŒ-é¿å…çš„åšæ³•-1" tabindex="-1">âŒ é¿å…çš„åšæ³• <a class="header-anchor" href="#âŒ-é¿å…çš„åšæ³•-1" aria-label="Permalink to &quot;âŒ é¿å…çš„åšæ³•&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> calc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p, d):  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ— ç±»å‹æ³¨è§£ï¼Œæ— æ–‡æ¡£</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> d </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-çŠ¶æ€è®¾è®¡" tabindex="-1">3. çŠ¶æ€è®¾è®¡ <a class="header-anchor" href="#_3-çŠ¶æ€è®¾è®¡" aria-label="Permalink to &quot;3. çŠ¶æ€è®¾è®¡&quot;">â€‹</a></h3><h4 id="âœ…-å¥½çš„åšæ³•-2" tabindex="-1">âœ… å¥½çš„åšæ³• <a class="header-anchor" href="#âœ…-å¥½çš„åšæ³•-2" aria-label="Permalink to &quot;âœ… å¥½çš„åšæ³•&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ChatState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MessagesState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user_id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    session_started_at: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # messages è‡ªåŠ¨ç»§æ‰¿ï¼Œå¸¦ add_messages reducer</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="âŒ-é¿å…çš„åšæ³•-2" tabindex="-1">âŒ é¿å…çš„åšæ³• <a class="header-anchor" href="#âŒ-é¿å…çš„åšæ³•-2" aria-label="Permalink to &quot;âŒ é¿å…çš„åšæ³•&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä¸è¦æ‰‹åŠ¨ç®¡ç†æ¶ˆæ¯åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ChatState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    all_messages: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # æ— ç±»å‹ï¼Œæ—  reducer</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_4-èŠ‚ç‚¹å‡½æ•°" tabindex="-1">4. èŠ‚ç‚¹å‡½æ•° <a class="header-anchor" href="#_4-èŠ‚ç‚¹å‡½æ•°" aria-label="Permalink to &quot;4. èŠ‚ç‚¹å‡½æ•°&quot;">â€‹</a></h3><h4 id="âœ…-å¥½çš„åšæ³•-3" tabindex="-1">âœ… å¥½çš„åšæ³• <a class="header-anchor" href="#âœ…-å¥½çš„åšæ³•-3" aria-label="Permalink to &quot;âœ… å¥½çš„åšæ³•&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> process_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesState) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;Process user message and generate response.&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.invoke(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [response]}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    except</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        logger.error(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;LLM error: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">e</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [AIMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Sorry, an error occurred&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li>æ˜ç¡®çš„ç±»å‹æ³¨è§£</li><li>é”™è¯¯å¤„ç†</li><li>è¿”å›æ­£ç¡®çš„çŠ¶æ€æ ¼å¼</li></ul><h4 id="âŒ-é¿å…çš„åšæ³•-3" tabindex="-1">âŒ é¿å…çš„åšæ³• <a class="header-anchor" href="#âŒ-é¿å…çš„åšæ³•-3" aria-label="Permalink to &quot;âŒ é¿å…çš„åšæ³•&quot;">â€‹</a></h4><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(s):  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ— ç±»å‹ï¼Œæ— é”™è¯¯å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.invoke(s[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¿”å›æ ¼å¼é”™è¯¯</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><hr><h2 id="ğŸš€-è¿›é˜¶æŠ€å·§" tabindex="-1">ğŸš€ è¿›é˜¶æŠ€å·§ <a class="header-anchor" href="#ğŸš€-è¿›é˜¶æŠ€å·§" aria-label="Permalink to &quot;ğŸš€ è¿›é˜¶æŠ€å·§&quot;">â€‹</a></h2><h3 id="_1-è‡ªå®šä¹‰-reducer" tabindex="-1">1. è‡ªå®šä¹‰ Reducer <a class="header-anchor" href="#_1-è‡ªå®šä¹‰-reducer" aria-label="Permalink to &quot;1. è‡ªå®šä¹‰ Reducer&quot;">â€‹</a></h3><p>é™¤äº† <code>add_messages</code>ï¼Œä½ å¯ä»¥å®šä¹‰è‡ªå®šä¹‰ reducerï¼š</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> keep_last_n_messages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(existing: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, new: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, n: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;åªä¿ç•™æœ€è¿‘ N æ¡æ¶ˆæ¯&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    combined </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> existing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> new</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> combined[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">n:]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> State</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages: Annotated[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">lambda</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x, y: keep_last_n_messages(x, y, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_2-æ¡ä»¶å·¥å…·è°ƒç”¨" tabindex="-1">2. æ¡ä»¶å·¥å…·è°ƒç”¨ <a class="header-anchor" href="#_2-æ¡ä»¶å·¥å…·è°ƒç”¨" aria-label="Permalink to &quot;2. æ¡ä»¶å·¥å…·è°ƒç”¨&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> smart_node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm_with_tools.invoke(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.tool_calls:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æœ‰å·¥å…·è°ƒç”¨ â†’ æ‰§è¡Œå·¥å…·</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tool_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.tool_calls[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tool_args </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.tool_calls[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;args&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tool_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;multiply&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> multiply(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_args)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                response,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                ToolMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result), </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tool_call_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response.tool_calls[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ]}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ— å·¥å…·è°ƒç”¨ â†’ ç›´æ¥è¿”å›</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [response]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_3-å¤šæ¨¡å‹æ”¯æŒ" tabindex="-1">3. å¤šæ¨¡å‹æ”¯æŒ <a class="header-anchor" href="#_3-å¤šæ¨¡å‹æ”¯æŒ" aria-label="Permalink to &quot;3. å¤šæ¨¡å‹æ”¯æŒ&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ModelState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MessagesState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    current_model: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> adaptive_node</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: ModelState):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # æ ¹æ®çŠ¶æ€é€‰æ‹©ä¸åŒæ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;current_model&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;fast&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        llm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ChatOpenAI(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt-3.5-turbo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        llm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ChatOpenAI(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt-4o&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.invoke(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [response]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><hr><h2 id="ğŸ”-å¸¸è§é—®é¢˜" tabindex="-1">ğŸ” å¸¸è§é—®é¢˜ <a class="header-anchor" href="#ğŸ”-å¸¸è§é—®é¢˜" aria-label="Permalink to &quot;ğŸ” å¸¸è§é—®é¢˜&quot;">â€‹</a></h2><h3 id="q1-ä¸ºä»€ä¹ˆéœ€è¦-add-messages-reducer" tabindex="-1">Q1: ä¸ºä»€ä¹ˆéœ€è¦ <code>add_messages</code> reducerï¼Ÿ <a class="header-anchor" href="#q1-ä¸ºä»€ä¹ˆéœ€è¦-add-messages-reducer" aria-label="Permalink to &quot;Q1: ä¸ºä»€ä¹ˆéœ€è¦ \`add_messages\` reducerï¼Ÿ&quot;">â€‹</a></h3><p><strong>ç­”ï¼š</strong> å› ä¸ºå¯¹è¯éœ€è¦ä¿ç•™å†å²è®°å½•ã€‚</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ²¡æœ‰ reducerï¼ˆé”™è¯¯ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [msg1, msg2]}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">node_output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [msg3]}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç»“æœï¼šmsg1, msg2 ä¸¢å¤±ï¼</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æœ‰ add_messagesï¼ˆæ­£ç¡®ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [msg1, msg2]}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">node_output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [msg3]}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç»“æœï¼š[msg1, msg2, msg3]  â† ä¿ç•™å†å²</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="q2-invoke-å’Œ-stream-æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1">Q2: <code>invoke()</code> å’Œ <code>stream()</code> æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ <a class="header-anchor" href="#q2-invoke-å’Œ-stream-æœ‰ä»€ä¹ˆåŒºåˆ«" aria-label="Permalink to &quot;Q2: \`invoke()\` å’Œ \`stream()\` æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># invokeï¼šç­‰å¾…å…¨éƒ¨å®Œæˆï¼Œè¿”å›æœ€ç»ˆç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.invoke({</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># streamï¼šæµå¼è¿”å›ä¸­é—´ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> graph.stream({</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]}):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunk)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p><ul><li><code>invoke</code>ï¼šéœ€è¦å®Œæ•´ç»“æœæ—¶</li><li><code>stream</code>ï¼šéœ€è¦å®æ—¶åé¦ˆæ—¶ï¼ˆå¦‚èŠå¤©ç•Œé¢ï¼‰</li></ul><h3 id="q3-å·¥å…·è°ƒç”¨åå¦‚ä½•æ‰§è¡Œå·¥å…·" tabindex="-1">Q3: å·¥å…·è°ƒç”¨åå¦‚ä½•æ‰§è¡Œå·¥å…·ï¼Ÿ <a class="header-anchor" href="#q3-å·¥å…·è°ƒç”¨åå¦‚ä½•æ‰§è¡Œå·¥å…·" aria-label="Permalink to &quot;Q3: å·¥å…·è°ƒç”¨åå¦‚ä½•æ‰§è¡Œå·¥å…·ï¼Ÿ&quot;">â€‹</a></h3><p>æœ¬æ•™ç¨‹ä¸­ï¼ŒLLM åªè¿”å›å·¥å…·è°ƒç”¨ä¿¡æ¯ï¼Œä¸æ‰§è¡Œã€‚å®Œæ•´çš„å·¥å…·æ‰§è¡Œæµç¨‹éœ€è¦ï¼š</p><ol><li>æ£€æµ‹ <code>response.tool_calls</code></li><li>è°ƒç”¨å®é™…å‡½æ•°</li><li>å°†ç»“æœä½œä¸º <code>ToolMessage</code> è¿”å›</li><li>å†æ¬¡è°ƒç”¨ LLM ç”Ÿæˆæœ€ç»ˆå›ç­”</li></ol><p>è¿™å°†åœ¨åç»­æ•™ç¨‹ä¸­è¯¦ç»†ä»‹ç»ã€‚</p><h3 id="q4-typeddict-å’Œ-pydantic-basemodel-å¦‚ä½•é€‰æ‹©" tabindex="-1">Q4: TypedDict å’Œ Pydantic BaseModel å¦‚ä½•é€‰æ‹©ï¼Ÿ <a class="header-anchor" href="#q4-typeddict-å’Œ-pydantic-basemodel-å¦‚ä½•é€‰æ‹©" aria-label="Permalink to &quot;Q4: TypedDict å’Œ Pydantic BaseModel å¦‚ä½•é€‰æ‹©ï¼Ÿ&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>åœºæ™¯</th><th>ä½¿ç”¨</th></tr></thead><tbody><tr><td>å®šä¹‰å›¾çŠ¶æ€</td><td><code>TypedDict</code></td></tr><tr><td>LLM ç»“æ„åŒ–è¾“å‡º</td><td><code>BaseModel</code></td></tr><tr><td>API è¯·æ±‚/å“åº”</td><td><code>BaseModel</code></td></tr><tr><td>éœ€è¦æ•°æ®éªŒè¯</td><td><code>BaseModel</code></td></tr><tr><td>ä»…éœ€ç±»å‹æç¤º</td><td><code>TypedDict</code></td></tr></tbody></table><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å›¾çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> State</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypedDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å·¥å…·è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ToolOutput</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BaseModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    result: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    status: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><hr><h2 id="ğŸ“Š-æ¦‚å¿µå¯¹æ¯”" tabindex="-1">ğŸ“Š æ¦‚å¿µå¯¹æ¯” <a class="header-anchor" href="#ğŸ“Š-æ¦‚å¿µå¯¹æ¯”" aria-label="Permalink to &quot;ğŸ“Š æ¦‚å¿µå¯¹æ¯”&quot;">â€‹</a></h2><h3 id="chain-vs-graph" tabindex="-1">Chain vs Graph <a class="header-anchor" href="#chain-vs-graph" aria-label="Permalink to &quot;Chain vs Graph&quot;">â€‹</a></h3><table tabindex="0"><thead><tr><th>ç‰¹æ€§</th><th>Chain</th><th>Graph</th></tr></thead><tbody><tr><td>ç»“æ„</td><td>çº¿æ€§ï¼ˆAâ†’Bâ†’Cï¼‰</td><td>ä»»æ„ï¼ˆå¯å¾ªç¯ã€åˆ†æ”¯ï¼‰</td></tr><tr><td>å¤æ‚åº¦</td><td>ç®€å•</td><td>å¤æ‚</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>ç®€å•æµç¨‹</td><td>å¤æ‚å·¥ä½œæµ</td></tr><tr><td>æœ¬æ•™ç¨‹</td><td>âœ…</td><td>âœ…ï¼ˆç®€å•å›¾ï¼‰</td></tr></tbody></table><p>æœ¬æ•™ç¨‹ä½¿ç”¨äº†ç®€å•çš„çº¿æ€§å›¾ï¼ˆchainï¼‰ï¼Œä½†ä½¿ç”¨äº† StateGraph æ„å»ºï¼Œä¸ºåç»­å¤æ‚å›¾æ‰“åŸºç¡€ã€‚</p><h3 id="messages-vs-state" tabindex="-1">Messages vs State <a class="header-anchor" href="#messages-vs-state" aria-label="Permalink to &quot;Messages vs State&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä»…æ¶ˆæ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> node1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(messages: list[AnyMessage]) -&gt; list[AnyMessage]:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm.invoke(messages)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨çŠ¶æ€ï¼ˆæ¨èï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> node2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesState) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [llm.invoke(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])]}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>ä½¿ç”¨çŠ¶æ€çš„ä¼˜åŠ¿ï¼š</strong></p><ul><li>å¯ä»¥æ·»åŠ é¢å¤–ä¿¡æ¯ï¼ˆuser_idã€metadata ç­‰ï¼‰</li><li>ç»Ÿä¸€çš„æ›´æ–°æœºåˆ¶ï¼ˆreducersï¼‰</li><li>æ›´å¥½çš„æ‰©å±•æ€§</li></ul><hr><h2 id="ğŸ¯-å®é™…åº”ç”¨æ¡ˆä¾‹" tabindex="-1">ğŸ¯ å®é™…åº”ç”¨æ¡ˆä¾‹ <a class="header-anchor" href="#ğŸ¯-å®é™…åº”ç”¨æ¡ˆä¾‹" aria-label="Permalink to &quot;ğŸ¯ å®é™…åº”ç”¨æ¡ˆä¾‹&quot;">â€‹</a></h2><h3 id="æ¡ˆä¾‹-1-ç®€å•å®¢æœæœºå™¨äºº" tabindex="-1">æ¡ˆä¾‹ 1ï¼šç®€å•å®¢æœæœºå™¨äºº <a class="header-anchor" href="#æ¡ˆä¾‹-1-ç®€å•å®¢æœæœºå™¨äºº" aria-label="Permalink to &quot;æ¡ˆä¾‹ 1ï¼šç®€å•å®¢æœæœºå™¨äºº&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> langgraph.graph </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StateGraph, MessagesState, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">START</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">END</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å·¥å…·ï¼šæŸ¥è¯¢è®¢å•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> check_order</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(order_id: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;Check order status&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Order </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">order_id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is being processed&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> customer_service</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    llm_with_tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ChatOpenAI(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt-4o&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).bind_tools([check_order])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm_with_tools.invoke(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [response]}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ„å»ºå›¾</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StateGraph(MessagesState)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_node(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;service&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, customer_service)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">START</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;service&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.add_edge(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;service&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">app </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> builder.compile()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> app.invoke({</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Check order #12345&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="æ¡ˆä¾‹-2-å¤šè¯­è¨€ç¿»è¯‘åŠ©æ‰‹" tabindex="-1">æ¡ˆä¾‹ 2ï¼šå¤šè¯­è¨€ç¿»è¯‘åŠ©æ‰‹ <a class="header-anchor" href="#æ¡ˆä¾‹-2-å¤šè¯­è¨€ç¿»è¯‘åŠ©æ‰‹" aria-label="Permalink to &quot;æ¡ˆä¾‹ 2ï¼šå¤šè¯­è¨€ç¿»è¯‘åŠ©æ‰‹&quot;">â€‹</a></h3><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> translate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, target_language: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;Translate text to target language&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å®é™…è°ƒç”¨ç¿»è¯‘ API</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">target_language</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">] </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> translator_bot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(state: MessagesState):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    llm_with_tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ChatOpenAI(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt-4o&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).bind_tools([translate])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> llm_with_tools.invoke(state[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [response]}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> app.invoke({</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [HumanMessage(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Translate &#39;Hello&#39; to Spanish&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><hr><h2 id="ğŸ“–-ä¸‹ä¸€æ­¥å­¦ä¹ " tabindex="-1">ğŸ“– ä¸‹ä¸€æ­¥å­¦ä¹  <a class="header-anchor" href="#ğŸ“–-ä¸‹ä¸€æ­¥å­¦ä¹ " aria-label="Permalink to &quot;ğŸ“– ä¸‹ä¸€æ­¥å­¦ä¹ &quot;">â€‹</a></h2><p>æœ¬æ•™ç¨‹ä»‹ç»äº† Chain çš„åŸºç¡€æ¦‚å¿µï¼Œä¸‹ä¸€æ­¥ä½ å°†å­¦ä¹ ï¼š</p><ol><li><strong>Tool Executionï¼ˆå·¥å…·æ‰§è¡Œï¼‰</strong>ï¼šå®é™…æ‰§è¡Œå·¥å…·è°ƒç”¨å¹¶è¿”å›ç»“æœ</li><li><strong>Conditional Edgesï¼ˆæ¡ä»¶è¾¹ï¼‰</strong>ï¼šæ ¹æ®çŠ¶æ€åŠ¨æ€è·¯ç”±</li><li><strong>Cyclesï¼ˆå¾ªç¯ï¼‰</strong>ï¼šæ„å»ºå¯ä»¥å¤šè½®äº¤äº’çš„å›¾</li><li><strong>Memoryï¼ˆè®°å¿†ï¼‰</strong>ï¼šæŒä¹…åŒ–å¯¹è¯å†å²</li></ol><hr><h2 id="ğŸ”—-æ‰©å±•é˜…è¯»" tabindex="-1">ğŸ”— æ‰©å±•é˜…è¯» <a class="header-anchor" href="#ğŸ”—-æ‰©å±•é˜…è¯»" aria-label="Permalink to &quot;ğŸ”— æ‰©å±•é˜…è¯»&quot;">â€‹</a></h2><ul><li><a href="https://python.langchain.com/docs/concepts/#messages" target="_blank" rel="noreferrer">LangChain Messages æ–‡æ¡£</a></li><li><a href="https://python.langchain.com/docs/concepts/#chat-models" target="_blank" rel="noreferrer">LangChain Chat Models æ–‡æ¡£</a></li><li><a href="https://python.langchain.com/docs/concepts/#tools" target="_blank" rel="noreferrer">LangChain Tools æ–‡æ¡£</a></li><li><a href="https://langchain-ai.github.io/langgraph/concepts/low_level/#reducers" target="_blank" rel="noreferrer">LangGraph Reducers æ–‡æ¡£</a></li><li><a href="https://docs.python.org/3/library/typing.html" target="_blank" rel="noreferrer">Python Type Hints æŒ‡å—</a></li></ul><hr><p><strong>æ€»ç»“</strong>ï¼šæœ¬æ•™ç¨‹ä»‹ç»äº†æ„å»º LangGraph Chain çš„å››å¤§æ ¸å¿ƒæ¦‚å¿µï¼šæ¶ˆæ¯ç³»ç»Ÿã€èŠå¤©æ¨¡å‹ã€å·¥å…·ç»‘å®šå’ŒçŠ¶æ€ç®¡ç†ã€‚è¿™äº›æ˜¯æ„å»ºå¤æ‚ AI ç³»ç»Ÿçš„åŸºç¡€ï¼ŒæŒæ¡è¿™äº›æ¦‚å¿µåï¼Œä½ å°±å¯ä»¥å¼€å§‹æ„å»ºæ›´å¼ºå¤§çš„ LangGraph åº”ç”¨äº†ï¼</p>`,261)])])}const o=a(e,[["render",p]]);export{g as __pageData,o as default};
