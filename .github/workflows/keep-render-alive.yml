name: Keep Render Backend Alive

# 每 10 分钟 Ping 一次后端，防止 Render 免费套餐休眠
on:
  schedule:
    # 每 10 分钟执行一次（UTC 时间）
    - cron: '*/10 * * * *'

  # 允许手动触发
  workflow_dispatch:

jobs:
  ping-backend:
    runs-on: ubuntu-latest

    steps:
      - name: Ping Render Backend Health Endpoint
        run: |
          echo "🔄 Pinging Render backend at $(date)"

          # 替换为你的 Render 后端地址
          BACKEND_URL="${{ secrets.RENDER_BACKEND_URL }}/health"

          # 发送 GET 请求
          response=$(curl -s -o /dev/null -w "%{http_code}" "$BACKEND_URL")

          if [ "$response" -eq 200 ]; then
            echo "✅ Backend is alive! Status: $response"
          else
            echo "⚠️ Backend returned status: $response"
            exit 1
          fi

      - name: Ping Root Endpoint
        run: |
          echo "🔄 Pinging root endpoint"

          # 同时 Ping 根路径
          BACKEND_URL="${{ secrets.RENDER_BACKEND_URL }}"

          response=$(curl -s -o /dev/null -w "%{http_code}" "$BACKEND_URL")

          if [ "$response" -eq 200 ]; then
            echo "✅ Root endpoint is alive! Status: $response"
          else
            echo "⚠️ Root endpoint returned status: $response"
          fi
