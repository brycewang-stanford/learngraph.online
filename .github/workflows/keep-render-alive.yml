name: Keep Render Backend Alive

# æ¯ 10 åˆ†é’Ÿ Ping ä¸€æ¬¡åç«¯ï¼Œé˜²æ­¢ Render å…è´¹å¥—é¤ä¼‘çœ 
on:
  schedule:
    # æ¯ 10 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼ˆUTC æ—¶é—´ï¼‰
    - cron: '*/10 * * * *'

  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  ping-backend:
    runs-on: ubuntu-latest

    steps:
      - name: Ping Render Backend Health Endpoint
        run: |
          echo "ğŸ”„ Pinging Render backend at $(date)"

          # æ›¿æ¢ä¸ºä½ çš„ Render åç«¯åœ°å€
          BACKEND_URL="${{ secrets.RENDER_BACKEND_URL }}/health"

          # å‘é€ GET è¯·æ±‚
          response=$(curl -s -o /dev/null -w "%{http_code}" "$BACKEND_URL")

          if [ "$response" -eq 200 ]; then
            echo "âœ… Backend is alive! Status: $response"
          else
            echo "âš ï¸ Backend returned status: $response"
            exit 1
          fi

      - name: Ping Root Endpoint
        run: |
          echo "ğŸ”„ Pinging root endpoint"

          # åŒæ—¶ Ping æ ¹è·¯å¾„
          BACKEND_URL="${{ secrets.RENDER_BACKEND_URL }}"

          response=$(curl -s -o /dev/null -w "%{http_code}" "$BACKEND_URL")

          if [ "$response" -eq 200 ]; then
            echo "âœ… Root endpoint is alive! Status: $response"
          else
            echo "âš ï¸ Root endpoint returned status: $response"
          fi
